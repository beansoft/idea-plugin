<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:42.264875"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>1. Working with Text | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"creating-a-new-menu-action","level":0,"title":"Creating a New Menu Action","anchor":"#creating-a-new-menu-action"},{"id":"defining-the-menu-action-s-visibility","level":0,"title":"Defining the Menu Action\u0027s Visibility","anchor":"#defining-the-menu-action-s-visibility"},{"id":"safely-replacing-selected-text-in-the-document","level":0,"title":"Safely Replacing Selected Text in the Document","anchor":"#safely-replacing-selected-text-in-the-document"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="1. Working with Text | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/working-with-text.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="1. Working with Text | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/working-with-text.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/working-with-text.html", "name": "1. Working with Text | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="working_with_text.md" data-main-title="1. Working with Text" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///editors.md|Editors///editor_basics.md|Editor Basics"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/tutorials/editor_basics/working_with_text.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="working_with_text.md" id="working_with_text.md"  >1. Working with Text</h1><p id="d5231fe6_1" >This tutorial shows how to use actions to access a caret placed in a document open in an editor. Using information about the caret, replace selected text in a document with a string.</p><section class="chapter"  ><h2 id="introduction" data-toc="introduction"  >Introduction</h2><p id="d5231fe6_2" >The approach in this tutorial relies heavily on creating and registering actions. To review the fundamentals of creating and registering actions, refer to the <a href="action-system.html" id="d5231fe6_3" data-tooltip="This tutorial leads you through a series of steps which show how to create, register, and customize custom actions and action groups. By registering actions, you can add your own menu items, toolbar buttons and keyboard shortcuts to the IDE user interface."  >Actions Tutorial</a>.</p><p id="d5231fe6_4" >Multiple examples are used from the <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics" id="d5231fe6_5"   data-external="true" rel="noopener noreferrer" >editor_basics</a> plugin code sample from the IntelliJ Platform SDK. It may be helpful to open that project in an IntelliJ Platform-based IDE, build the project, run it, select some text in the editor, and invoke the <span class="control" id="d5231fe6_6" >Editor Replace Text</span> menu item on the editor context menu.</p><figure  id="d5231fe6_7"><img alt="Editor Basics Menu" title="Editor Basics Menu" src="images/basics.png"  class="" width="600" height="172"/></figure></section><section class="chapter"  ><h2 id="creating-a-new-menu-action" data-toc="creating-a-new-menu-action"  >Creating a New Menu Action</h2><p id="d5231fe6_8" >In this example, we access the <code class="code " id="d5231fe6_9"  >Editor</code> from an action. The source code for the Java class in this example is <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics/src/main/java/org/intellij/sdk/editor/EditorIllustrationAction.java" id="d5231fe6_10"   data-external="true" rel="noopener noreferrer" >EditorIllustrationAction</a>.</p><p id="d5231fe6_11" >To register the action, we must add the corresponding elements to the <a href="plugin-configuration-file.html#idea-plugin__actions" id="d5231fe6_12" data-tooltip="Defines the plugin actions."  ><code class="code " id="d5231fe6_13"  >&lt;actions&gt;</code></a> section of the plugin configuration file <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics/src/main/resources/META-INF/plugin.xml" id="d5231fe6_14"   data-external="true" rel="noopener noreferrer" >plugin.xml</a>. For more information, refer to the <a href="working-with-custom-actions.html#registering-a-custom-action" id="d5231fe6_15" data-tooltip="Actions are registered by declaring them in code or by declaring them in the <actions> section of a plugin configuration file. This section describes using IDE tooling - the New Action form - to add a declaration to the plugin.xml file, and then tuning registration attributes…"  >Registering Actions</a> section of the Actions Tutorial. The <code class="code " id="d5231fe6_16"  >EditorIllustrationAction</code> action is registered in the group <code class="code " id="d5231fe6_17"  >EditorPopupMenu</code> so it will be available from the context menu when focus is on the editor:</p><div class="code-block" data-lang="markup"         >
&lt;action
    id=&quot;EditorBasics.EditorIllustrationAction&quot;
    class=&quot;org.intellij.sdk.editor.EditorIllustrationAction&quot;
    text=&quot;Editor Replace Text&quot;
    description=&quot;Replaces selected text with 'Replacement'.&quot;
    icon=&quot;SdkIcons.Sdk_default_icon&quot;&gt;
  &lt;add-to-group group-id=&quot;EditorPopupMenu&quot; anchor=&quot;first&quot;/&gt;
&lt;/action&gt;
</div></section><section class="chapter"  ><h2 id="defining-the-menu-action-s-visibility" data-toc="defining-the-menu-action-s-visibility"  >Defining the Menu Action's Visibility</h2><p id="d5231fe6_19" >To determine conditions by which the action will be visible and available requires <code class="code " id="d5231fe6_20"  >EditorIllustrationAction</code> to override the <code class="code " id="d5231fe6_21"  >AnAction.update()</code> method. For more information, refer to <a href="working-with-custom-actions.html#extending-the-update-method" id="d5231fe6_22" data-tooltip="Adding code to PopupDialogAction.update() gives finer control of the action's visibility and availability. The action's state and(or) presentation can be dynamically changed depending on the context."  >Extending the Update Method</a> section of the Actions Tutorial.</p><p id="d5231fe6_23" >To work with a selected part of the text, it's reasonable to make the menu action available only when the following requirements are met:</p><ul class="list _ul" id="d5231fe6_24"    ><li class="list__item" id="d5231fe6_25" ><p>There is a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/project/Project.java" id="d5231fe6_26"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_27"  >Project</code></a> object,</p></li><li class="list__item" id="d5231fe6_28" ><p>There is an instance of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/Editor.java" id="d5231fe6_29"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_30"  >Editor</code></a> available,</p></li><li class="list__item" id="d5231fe6_31" ><p>There is a text selection in <code class="code " id="d5231fe6_32"  >Editor</code>.</p></li></ul><p id="d5231fe6_33" >Additional steps will show how to check these conditions through obtaining instances of <code class="code " id="d5231fe6_34"  >Project</code> and <code class="code " id="d5231fe6_35"  >Editor</code> objects, and how to show or hide the action's menu items based on them.</p><section class="chapter"  ><h3 id="getting-an-instance-of-the-active-editor-from-an-action-event" data-toc="getting-an-instance-of-the-active-editor-from-an-action-event"  >Getting an Instance of the Active Editor from an Action Event</h3><p id="d5231fe6_36" >Using the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/actionSystem/AnActionEvent.java" id="d5231fe6_37"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_38"  >AnActionEvent</code></a> event passed into the <code class="code " id="d5231fe6_39"  >update</code> method, a reference to an instance of the <code class="code " id="d5231fe6_40"  >Editor</code> can be obtained by calling <code class="code " id="d5231fe6_41"  >getData(CommonDataKeys.EDITOR)</code>. Similarly, to obtain a project reference, we use the <code class="code " id="d5231fe6_42"  >getProject()</code> method.</p><div class="code-block" data-lang="java"         >
public class EditorIllustrationAction extends AnAction {
  @Override
  public void update(@NotNull AnActionEvent event) {
    // Get required data keys
    Project project = event.getProject();
    Editor editor = event.getData(CommonDataKeys.EDITOR);
    // ...
  }
}
</div><p id="d5231fe6_44" ><span class="control" id="d5231fe6_45" >Note:</span> There are other ways to access an <code class="code " id="d5231fe6_46"  >Editor</code> instance:</p><ul class="list _ul" id="d5231fe6_47"    ><li class="list__item" id="d5231fe6_48" ><p>If a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-ui/src/openapi/actionSystem/DataContext.java" id="d5231fe6_49"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_50"  >DataContext</code></a> object is available: <code class="code " id="d5231fe6_51"  >CommonDataKeys.EDITOR.getData(context);</code></p></li><li class="list__item" id="d5231fe6_52" ><p>If only a <code class="code " id="d5231fe6_53"  >Project</code> object is available, use <code class="code " id="d5231fe6_54"  >FileEditorManager.getInstance(project).getSelectedTextEditor()</code></p></li></ul></section><section class="chapter"  ><h3 id="obtaining-a-caret-model-and-selection" data-toc="obtaining-a-caret-model-and-selection"  >Obtaining a Caret Model and Selection</h3><p id="d5231fe6_55" >After making sure a project is open, and an instance of the <code class="code " id="d5231fe6_56"  >Editor</code> is obtained, we need to check if any selection is available. The <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/SelectionModel.java" id="d5231fe6_57"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_58"  >SelectionModel</code></a> interface is accessed from the <code class="code " id="d5231fe6_59"  >Editor</code> object. Determining whether some text is selected is accomplished by calling the <code class="code " id="d5231fe6_60"  >SelectionModel.hasSelection()</code> method. Here's how the <code class="code " id="d5231fe6_61"  >EditorIllustrationAction.update(AnActionEvent event)</code> method should look:</p><div class="code-block" data-lang="java"         >
public class EditorIllustrationAction extends AnAction {
  @Override
  public void update(@NotNull AnActionEvent event) {
    // Get required data keys
    Project project = event.getProject();
    Editor editor = event.getData(CommonDataKeys.EDITOR);

    // Set visibility only in the case of
    // existing project editor, and selection
    event.getPresentation().setEnabledAndVisible(project != null
        &amp;&amp; editor != null &amp;&amp; editor.getSelectionModel().hasSelection());
  }
}
</div><p id="d5231fe6_63" ><span class="control" id="d5231fe6_64" >Note:</span> <code class="code " id="d5231fe6_65"  >Editor</code> also allows access to different models of text representation. The model classes are located in <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor" id="d5231fe6_66"   data-external="true" rel="noopener noreferrer" >editor</a>, and include:</p><ul class="list _ul" id="d5231fe6_67"    ><li class="list__item" id="d5231fe6_68" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/CaretModel.java" id="d5231fe6_69"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_70"  >CaretModel</code></a>,</p></li><li class="list__item" id="d5231fe6_71" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/FoldingModel.java" id="d5231fe6_72"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_73"  >FoldingModel</code></a>,</p></li><li class="list__item" id="d5231fe6_74" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/IndentsModel.java" id="d5231fe6_75"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_76"  >IndentsModel</code></a>,</p></li><li class="list__item" id="d5231fe6_77" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/ScrollingModel.java" id="d5231fe6_78"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_79"  >ScrollingModel</code></a>,</p></li><li class="list__item" id="d5231fe6_80" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/SoftWrapModel.java" id="d5231fe6_81"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_82"  >SoftWrapModel</code></a></p></li></ul></section></section><section class="chapter"  ><h2 id="safely-replacing-selected-text-in-the-document" data-toc="safely-replacing-selected-text-in-the-document"  >Safely Replacing Selected Text in the Document</h2><p id="d5231fe6_83" >Based on the evaluation of conditions by <code class="code " id="d5231fe6_84"  >EditorIllustrationAction.update()</code>, the <code class="code " id="d5231fe6_85"  >EditorIllustrationAction</code> action menu item is visible. To make the menu item do something, the <code class="code " id="d5231fe6_86"  >EditorIllustrationAction</code> class must override the <code class="code " id="d5231fe6_87"  >AnAction.actionPerformed()</code> method. As explained below, this will require the <code class="code " id="d5231fe6_88"  >EditorIllustrationAction.actionPerformed()</code> method to:</p><ul class="list _ul" id="d5231fe6_89"    ><li class="list__item" id="d5231fe6_90" ><p>Gain access to the document.</p></li><li class="list__item" id="d5231fe6_91" ><p>Get the character locations defining the selection.</p></li><li class="list__item" id="d5231fe6_92" ><p>Safely replace the contents of the selection.</p></li></ul><p id="d5231fe6_93" >Modifying the selected text requires an instance of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/editor/Document.java" id="d5231fe6_94"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_95"  >Document</code></a> object, which is accessed from the <code class="code " id="d5231fe6_96"  >Editor</code> object. The <a href="documents.html" id="d5231fe6_97" data-tooltip="A Document is an editable sequence of Unicode characters, typically corresponding to the text contents of a virtual file."  >Document</a> represents the contents of a text file loaded into memory and opened in an IntelliJ Platform-based IDE editor. An instance of the <code class="code " id="d5231fe6_98"  >Document</code> will be used later when a text replacement is performed.</p><p id="d5231fe6_99" >The text replacement will also require information about where the selection is in the document, which is provided by the primary <code class="code " id="d5231fe6_100"  >Caret</code> object, obtained from the <code class="code " id="d5231fe6_101"  >CaretModel</code>. Selection information is measured in terms of <a href="coordinates-system.html#caret-offset" id="d5231fe6_102" data-tooltip="The Offset of a caret is a character count from the beginning of a Document to the caret position. Caret offsets are always calculated in terms of Logical Position. The caret Offset includes:"  >Offset</a>, the count of characters from the beginning of the document to a caret location.</p><p id="d5231fe6_103" >Text replacement could be done by calling the <code class="code " id="d5231fe6_104"  >Document</code> object's <code class="code " id="d5231fe6_105"  >replaceString()</code> method. However, safely replacing the text requires the <code class="code " id="d5231fe6_106"  >Document</code> to be locked and any changes performed in a write action. See the <a href="general-threading-rules.html" id="d5231fe6_107" data-tooltip="Thread Access Info 插件在调试器中可视化显示读/写锁访问以及线程信息."  >Threading Issues</a> section to learn more about synchronization issues and changes safety on the IntelliJ Platform. This example changes the document within a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/command/WriteCommandAction.java" id="d5231fe6_108"   data-external="true" rel="noopener noreferrer" ><code class="code " id="d5231fe6_109"  >WriteCommandAction</code></a>.</p><p id="d5231fe6_110" >The complete <code class="code " id="d5231fe6_111"  >EditorIllustrationAction.actionPerformed()</code> method is shown below:</p><ul class="list _ul" id="d5231fe6_112"    ><li class="list__item" id="d5231fe6_113" ><p>Note the selection in the document is replaced by a string using a method on the <code class="code " id="d5231fe6_114"  >Document</code> object, but the method call is wrapped in a write action.</p></li><li class="list__item" id="d5231fe6_115" ><p>After the document change, the new text is de-selected by a call to the primary caret.</p></li></ul><div class="code-block" data-lang="java"         >
public class EditorIllustrationAction extends AnAction {
  @Override
  public void actionPerformed(@NotNull AnActionEvent event) {
    // Get all the required data from data keys
    Editor editor = event.getRequiredData(CommonDataKeys.EDITOR);
    Project project = event.getRequiredData(CommonDataKeys.PROJECT);
    Document document = editor.getDocument();

    // Work off of the primary caret to get the selection info
    Caret primaryCaret = editor.getCaretModel().getPrimaryCaret();
    int start = primaryCaret.getSelectionStart();
    int end = primaryCaret.getSelectionEnd();

    // Replace the selection with a fixed string.
    // Must do this document change in a write action context.
    WriteCommandAction.runWriteCommandAction(project, () -&gt;
        document.replaceString(start, end, &quot;editor_basics&quot;)
    );

    // De-select the text range that was just replaced
    primaryCaret.removeSelection();
  }
}
</div></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="editor-basics.html">Basics of Working with the Editor</a>   <a class="navigation-links__next" href="coordinates-system.html">2. Editor Coordinates System. Positions and Offsets</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>