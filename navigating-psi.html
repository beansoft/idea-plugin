<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.624267"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Navigating the PSI | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"top-down-navigation","level":0,"title":"Top-Down Navigation","anchor":"#top-down-navigation"},{"id":"bottom-up-navigation","level":0,"title":"Bottom-Up Navigation","anchor":"#bottom-up-navigation"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Navigating the PSI | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/navigating-psi.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Navigating the PSI | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/navigating-psi.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/navigating-psi.html", "name": "Navigating the PSI | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="navigating_psi.md" data-main-title="Navigating the PSI" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part IV — PSI"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/architectural_overview/navigating_psi.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="navigating_psi.md" id="navigating_psi.md"  >Navigating the PSI</h1><p id="60188de4_1" >There are three main ways to navigate the PSI: <span class="emphasis" id="60188de4_2" >top-down</span>, <span class="emphasis" id="60188de4_3" >bottom-up</span>, and <span class="emphasis" id="60188de4_4" >references</span>. In the first scenario, you have a PSI file or another higher-level element (for example, a method). You need to find all elements that match a specified condition (for example, all variable declarations). In the second scenario, you have a specific point in the PSI tree (for example, the element at caret) and need to find out something about its context (for example, the element in which it has been declared). Finally, <span class="emphasis" id="60188de4_5" >references</span> allow you to navigate from the usages of an element (e.g., a method call) to the declaration (the method being called) and back. References are described in a <a href="psi-references.html" id="60188de4_6" data-tooltip="A reference in a PSI tree is an object that represents a link from a usage of a particular element in the code to the corresponding declaration. Resolving a reference means locating the declaration to which a specific usage refers."  >separate topic</a>.</p><section class="chapter"  ><h2 id="top-down-navigation" data-toc="top-down-navigation"  >Top-Down Navigation</h2><p id="60188de4_7" >The most common way to perform top-down navigation is to use a <a href="https://en.wikipedia.org/wiki/Visitor_pattern" id="60188de4_8"   data-external="true" rel="noopener noreferrer" >Visitor</a>. To use a visitor, you create a class (usually an anonymous inner class) that extends the base visitor class, overrides the methods that handle the elements you're interested in, and passes the visitor instance to <code class="code " id="60188de4_9"  >PsiElement.accept()</code>.</p><p id="60188de4_10" >The base classes for visitors are language-specific. For example, if you need to process elements in a Java file, you extend <code class="code " id="60188de4_11"  >JavaRecursiveElementVisitor</code> and override the methods corresponding to the Java element types you're interested in.</p><p id="60188de4_12" >The following snippet shows the use of a visitor to find all Java local variable declarations:</p><div class="code-block" data-lang="java"         >
file.accept(new JavaRecursiveElementVisitor() {
  @Override
  public void visitLocalVariable(PsiLocalVariable variable) {
    super.visitLocalVariable(variable);
    System.out.println(&quot;Found a variable at offset &quot; + variable.getTextRange().getStartOffset());
  }
});
</div><p id="60188de4_14" >In many cases, you can also use more specific APIs for top-down navigation. For example, if you need to get a list of all methods in a Java class, you can use a visitor, but a much easier way to do that is calling <code class="code " id="60188de4_15"  >PsiClass.getMethods()</code>.</p><p id="60188de4_16" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/util/PsiTreeUtil.java" id="60188de4_17"   data-external="true" rel="noopener noreferrer" ><code class="code " id="60188de4_18"  >PsiTreeUtil</code></a> contains a number of general-purpose, language-independent functions for PSI tree navigation, some of which (for example, <code class="code " id="60188de4_19"  >findChildrenOfType()</code>) perform top-down navigation.</p></section><section class="chapter"  ><h2 id="bottom-up-navigation" data-toc="bottom-up-navigation"  >Bottom-Up Navigation</h2><p id="60188de4_20" >The starting point for bottom-up navigation is either a specific element in the PSI tree (for example, the result of resolving a reference) or an offset. If you have an offset, you can find the corresponding PSI element by calling <code class="code " id="60188de4_21"  >PsiFile.findElementAt()</code>. This method returns the element at the lowest level of the tree (for example, an identifier), and you need to navigate the tree up if you want to determine the broader context.</p><p id="60188de4_22" >In most cases, bottom-up navigation is performed by calling <code class="code " id="60188de4_23"  >PsiTreeUtil.getParentOfType()</code>. This method goes up the tree until it finds the element of the type you've specified. For example, to find the containing method, you call <code class="code " id="60188de4_24"  >PsiTreeUtil.getParentOfType(element, PsiMethod.class)</code>.</p><p id="60188de4_25" >In some cases, you can also use specific navigation methods. For example, to find the class where a method is contained, you call <code class="code " id="60188de4_26"  >PsiMethod.getContainingClass()</code>.</p><p id="60188de4_27" >The following snippet shows how these calls can be used together:</p><div class="code-block" data-lang="java"         >
PsiFile psiFile = anActionEvent.getData(CommonDataKeys.PSI_FILE);
PsiElement element = psiFile.findElementAt(offset);
PsiMethod containingMethod = PsiTreeUtil.getParentOfType(element, PsiMethod.class);
PsiClass containingClass = containingMethod.getContainingClass();
</div><p id="60188de4_29" >To see how the navigation works in practice, please refer to the <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/psi_demo/src/main/java/org/intellij/sdk/psi/PsiNavigationDemoAction.java" id="60188de4_30"   data-external="true" rel="noopener noreferrer" >code sample</a>.</p></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="psi-elements.html">PSI Elements</a>   <a class="navigation-links__next" href="psi-references.html">PSI References</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>