<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:41.4947019"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Version Control Systems | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"key-concepts","level":0,"title":"Key Concepts","anchor":"#key-concepts"},{"id":"plugin-components","level":0,"title":"Plugin Components","anchor":"#plugin-components"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Version Control Systems | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/vcs-integration-for-plugins.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Version Control Systems | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/vcs-integration-for-plugins.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/vcs-integration-for-plugins.html", "name": "Version Control Systems | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="vcs_integration_for_plugins.md" data-main-title="Version Control Systems" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/vcs_integration_for_plugins.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="vcs_integration_for_plugins.md" id="vcs_integration_for_plugins.md"  >Version Control Systems</h1><p id="2a3f9af2_1" >This page gives an overview of the Version Control Integration API.</p><p id="2a3f9af2_2" >Reference: <a href="https://jb.gg/ipe?extensions=com.intellij.vcs" id="2a3f9af2_3"   data-external="true" rel="noopener noreferrer" >OSS plugins providing VCS</a></p><section class="chapter"  ><h2 id="key-concepts" data-toc="key-concepts"  >Key Concepts</h2><section class="chapter"  ><h3 id="filepath" data-toc="filepath"  >FilePath</h3><p id="2a3f9af2_4" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/ide-core/src/com/intellij/openapi/vcs/FilePath.java" id="2a3f9af2_5"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_6"  >FilePath</code></a> represents a path to a file or directory on disk or in the VCS repository. Unlike a <a href="virtual-file.html" id="2a3f9af2_7" data-tooltip="A VirtualFile (VF) is the IntelliJ Platform's representation of a file in a Virtual File System (VFS)."  >virtual file</a>, a <code class="code " id="2a3f9af2_8"  >FilePath</code> can represent a path to a file which doesn't exist on disk. The main difference between a <code class="code " id="2a3f9af2_9"  >FilePath</code> and a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html" id="2a3f9af2_10"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_11"  >java.io.File</code></a> is that a <code class="code " id="2a3f9af2_12"  >FilePath</code> caches the <code class="code " id="2a3f9af2_13"  >VirtualFile</code> corresponding to the path, so it can be retrieved without doing a VFS search.</p><p id="2a3f9af2_14" >To create instances of <code class="code " id="2a3f9af2_15"  >FilePath</code>, the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/actions/VcsContextFactory.java" id="2a3f9af2_16"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_17"  >VcsContextFactory</code></a> API is used. It can be accessed as <code class="code " id="2a3f9af2_18"  >PeerFactory.getVcsContextFactory()</code>.</p><p id="2a3f9af2_19" ><code class="code " id="2a3f9af2_20"  >FilePath</code> representing paths in a VCS repository, rather than local paths, are created using <code class="code " id="2a3f9af2_21"  >VcsContextFactory.createFilePathOnNonLocal()</code>. The <code class="code " id="2a3f9af2_22"  >FilePath.isNonLocal()</code> method returns <code class="code " id="2a3f9af2_23"  >true</code> for such files.</p></section><section class="chapter"  ><h3 id="revision-number" data-toc="revision-number"  >Revision Number</h3><p id="2a3f9af2_24" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/vcs-api-core/src/com/intellij/openapi/vcs/history/VcsRevisionNumber.java" id="2a3f9af2_25"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_26"  >VcsRevisionNumber</code></a> represents a revision number of the file. If the VCS stores revision numbers as simple integers, the standard <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/vcs-api-core/src/com/intellij/openapi/vcs/history/VcsRevisionNumber.java" id="2a3f9af2_27"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_28"  >VcsRevisionNumber</code></a> <code class="code " id="2a3f9af2_29"  >Int</code> implementation can be used. If the VCS has a more complex format of revision numbers (like CVS, which uses a series of numbers delimited with dots), the plugin can provide a custom implementation.</p></section><section class="chapter"  ><h3 id="contentrevision" data-toc="contentrevision"  >ContentRevision</h3><p id="2a3f9af2_30" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/vcs-api-core/src/com/intellij/openapi/vcs/changes/ContentRevision.java" id="2a3f9af2_31"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_32"  >ContentRevision</code></a> represents a particular revision of a file, which exists either locally or in a VCS repository. It has three main attributes:</p><ul class="list _ul" id="2a3f9af2_33"    ><li class="list__item" id="2a3f9af2_34" ><p><code class="code " id="2a3f9af2_35"  >FilePath</code> specifying the file of which this is a revision. If some version of the file exists locally, this should be a local path.</p></li><li class="list__item" id="2a3f9af2_36" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/vcs-api-core/src/com/intellij/openapi/vcs/history/VcsRevisionNumber.java" id="2a3f9af2_37"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_38"  >VcsRevisionNumber</code></a> specifying the revision number of the revision, or <code class="code " id="2a3f9af2_39"  >VcsRevisionNumber.NULL</code> if the revision exists only locally.</p></li><li class="list__item" id="2a3f9af2_40" ><p>Content of the revision.</p></li></ul><p id="2a3f9af2_41" >The content is returned as string, and the VCS plugin is responsible for converting the binary file content to correct encoding. To detect the encoding automatically based on the IDE settings and the byte order mark, the method <code class="code " id="2a3f9af2_42"  >CharsetToolkit.bytesToString()</code> can be used (this API is new in IDEA 7.0.2). Revisions of binary files can also be represented as <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/BinaryContentRevision.java" id="2a3f9af2_43"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_44"  >BinaryContentRevision</code></a>. For binary revisions, the result of <code class="code " id="2a3f9af2_45"  >getContent()</code> is undefined, and <code class="code " id="2a3f9af2_46"  >getBinaryContent()</code> can be used to retrieve the contents as a byte array.</p><p id="2a3f9af2_47" >A useful class which can be used to represent the current on-disk version of a particular file is <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/CurrentContentRevision.java" id="2a3f9af2_48"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_49"  >CurrentContentRevision</code></a>.</p></section><section class="chapter"  ><h3 id="filestatus" data-toc="filestatus"  >FileStatus</h3><p id="2a3f9af2_50" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java" id="2a3f9af2_51"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_52"  >FileStatus</code></a> represents a status of a file in regard to VCS (unversioned, not changed, added, modified and so on). It determines the color used to render the name of the file in the UI.</p></section><section class="chapter"  ><h3 id="change" data-toc="change"  >Change</h3><p id="2a3f9af2_53" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/vcs-api-core/src/com/intellij/openapi/vcs/changes/Change.java" id="2a3f9af2_54"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_55"  >Change</code></a> represents a single file operation (creation, modification, move/rename or deletion) from a VCS point of view. A Change can represent either a modification which the user has performed locally and not yet committed, a committed modification, or some other type of modification (for example, a shelved change or a difference between two arbitrary revisions).</p><p id="2a3f9af2_56" >A <code class="code " id="2a3f9af2_57"  >Change</code> essentially consists of two content revisions:</p><ul class="list _ul" id="2a3f9af2_58"    ><li class="list__item" id="2a3f9af2_59" ><p>before revision (<code class="code " id="2a3f9af2_60"  >null</code> if the <code class="code " id="2a3f9af2_61"  >Change</code> represents file creation)</p></li><li class="list__item" id="2a3f9af2_62" ><p>after revision (<code class="code " id="2a3f9af2_63"  >null</code> if the <code class="code " id="2a3f9af2_64"  >Change</code> represents file deletion)</p></li></ul><p id="2a3f9af2_65" >A move or rename is represented by a <code class="code " id="2a3f9af2_66"  >Change</code> where the before revision and the after revision have different file paths. A custom file status can be specified for a <code class="code " id="2a3f9af2_67"  >Change</code> if it represents a non-standard modification of the file (for example, a file which has been merged with conflicts). If a custom file status has not been specified, the status is calculated automatically from the change type.</p></section><section class="chapter"  ><h3 id="changelist" data-toc="changelist"  >ChangeList</h3><p id="2a3f9af2_68" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/ChangeList.java" id="2a3f9af2_69"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_70"  >ChangeList</code></a> represents a named group of related changes. There are two main kinds of changelists:</p><ul class="list _ul" id="2a3f9af2_71"    ><li class="list__item" id="2a3f9af2_72" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/LocalChangeList.java" id="2a3f9af2_73"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_74"  >LocalChangeList</code></a> represents a group of modifications done by a user locally. If the VCS also supports the concept of changelists (like Perforce does), the VCS plugin can synchronize the IDE's local changelist structure with that of the VCS. Otherwise, a local changelist is simply a subset of the files checked out or modified by the user.</p></li><li class="list__item" id="2a3f9af2_75" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/versionBrowser/CommittedChangeList.java" id="2a3f9af2_76"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_77"  >CommittedChangeList</code></a> represents a set of modifications checked in to the VCS repository. For VCSes which support atomic commit, every committed revision is represented by a <code class="code " id="2a3f9af2_78"  >CommittedChangeList</code>. For VCSes which use per-file commit (like CVS), the plugin can use heuristics to group a sequence of individual file commits into a <code class="code " id="2a3f9af2_79"  >CommittedChangeList</code>.</p></li></ul><aside data-type="tip" class="prompt" data-title="" id="2a3f9af2_80" ><p id="2a3f9af2_81" >The <span class="control" id="2a3f9af2_82" >Unversioned Files</span>, <span class="control" id="2a3f9af2_83" >Locally Deleted Files</span>, etc., nodes in the <span class="control" id="2a3f9af2_84" >Changes</span> view are not actually change lists, and files under those nodes are not represented by <code class="code " id="2a3f9af2_85"  >ChangeList</code> objects.</p></aside></section></section><section class="chapter"  ><h2 id="plugin-components" data-toc="plugin-components"  >Plugin Components</h2><p id="2a3f9af2_86" >This section describes the different components which comprise a VCS integration plugin, roughly in the same order as they should be implemented.</p><section class="chapter"  ><h3 id="abstractvcs" data-toc="abstractvcs"  >AbstractVcs</h3><p id="2a3f9af2_87" >This is the main entry point for a VCS plugin, which is used by the IntelliJ Platform to retrieve all other services provided by the plugin. Register <code class="code " id="2a3f9af2_88"  >AbstractVcs</code> implementation in <code class="code " id="2a3f9af2_89"  >com.intellij.vcs</code> extension point in <span class="filepath" id="2a3f9af2_90" ><a href="plugin-configuration-file.html" id="2a3f9af2_91" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span>, as shown in the following example:</p><div class="code-block" data-lang="markup"         >
&lt;idea-plugin&gt;
  ...
  &lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
    &lt;vcs name=&quot;svn&quot; vcsClass=&quot;org.jetbrains.idea.svn.SvnVcs&quot;/&gt;
  &lt;/extensions&gt;
&lt;/idea-plugin&gt;
</div><p id="2a3f9af2_93" >Here <code class="code " id="2a3f9af2_94"  >name</code> is the unique name of the VCS (this must match the string returned by your implementation of <code class="code " id="2a3f9af2_95"  >AbstractVcs.getName()</code>), and <code class="code " id="2a3f9af2_96"  >vcsClass</code> is your implementation class.</p></section><section class="chapter"  ><h3 id="changeprovider" data-toc="changeprovider"  >ChangeProvider</h3><p id="2a3f9af2_97" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/ChangeProvider.java" id="2a3f9af2_98"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_99"  >ChangeProvider</code></a> is responsible for tracking user changes to the working copy, and reporting these changes to the IntelliJ Platform core. An implementation of this class is returned from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/AbstractVcs.java" id="2a3f9af2_100"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_101"  >AbstractVcs.getChangeProvider()</code></a>.</p><p id="2a3f9af2_102" >The ChangeProvider works in tandem with <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/VcsDirtyScopeManager.java" id="2a3f9af2_103"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_104"  >VcsDirtyScopeManager</code></a>. It keeps track of the 'dirty scope': the set of files for which the VCS file status may be out of date. Files are added to the dirty scope either when they are modified on disk, or when their VCS status is invalidated by an explicit call to <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/VcsDirtyScopeManager.java" id="2a3f9af2_105"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_106"  >VcsDirtyScopeManager.fileDirty()</code></a> or <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/VcsDirtyScopeManager.java" id="2a3f9af2_107"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_108"  >VcsDirtyScopeManager.dirDirtyRecursively()</code></a>.</p><p id="2a3f9af2_109" >After some files have been added to the dirty scope, the dirty scope is passed to <code class="code " id="2a3f9af2_110"  >ChangeProvider.getChanges()</code>, along with a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/ChangelistBuilder.java" id="2a3f9af2_111"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_112"  >ChangelistBuilder</code></a> instance, which serves as a sink to which the <code class="code " id="2a3f9af2_113"  >ChangeProvider</code> feeds the data about the changed files. This processing happens asynchronously in a background thread.</p><p id="2a3f9af2_114" >The <code class="code " id="2a3f9af2_115"  >ChangeProvider</code> can either iterate all files under the dirty scope using <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/vcs-api/src/com/intellij/openapi/vcs/changes/VcsDirtyScope.java" id="2a3f9af2_116"   data-external="true" rel="noopener noreferrer" ><code class="code " id="2a3f9af2_117"  >VcsDirtyScope.iterate()</code></a>, or retrieve information about its contents using the <code class="code " id="2a3f9af2_118"  >getDirtyFiles()</code> and <code class="code " id="2a3f9af2_119"  >getDirtyDirectoriesRecursively()</code> methods. If it is possible to retrieve the information about the local changes from the VCS in batch, it's strongly preferable to use the second method, as it scales much better for large working copies.</p><p id="2a3f9af2_120" >The <code class="code " id="2a3f9af2_121"  >ChangeProvider</code> reports data to <code class="code " id="2a3f9af2_122"  >ChangelistBuilder</code> using the following methods:</p><ul class="list _ul" id="2a3f9af2_123"    ><li class="list__item" id="2a3f9af2_124" ><p><code class="code " id="2a3f9af2_125"  >processChange()</code> is called for files which have been checked out (or modified if the VCS doesn't use an explicit checkout model), scheduled for addition or deletion, moved or renamed.</p></li><li class="list__item" id="2a3f9af2_126" ><p><code class="code " id="2a3f9af2_127"  >processUnversionedFile()</code> is called for files which exist on disk, but are not managed by the VCS, not scheduled for addition, and not ignored through <span class="filepath" id="2a3f9af2_128" >.cvsignore</span> or a similar mechanism.</p></li><li class="list__item" id="2a3f9af2_129" ><p><code class="code " id="2a3f9af2_130"  >processLocallyDeletedFile()</code> is called for files which exist in the VCS repository, but do not exist on disk and are not scheduled for deletion.</p></li><li class="list__item" id="2a3f9af2_131" ><p><code class="code " id="2a3f9af2_132"  >processIgnoredFile()</code> is called for files which are not managed by the VCS but are ignored through <span class="filepath" id="2a3f9af2_133" >.cvsignore</span> or a similar mechanism.</p></li><li class="list__item" id="2a3f9af2_134" ><p><code class="code " id="2a3f9af2_135"  >processSwitchedFile()</code> is called for files or directories for which the working copy corresponds to a different branch compared to the working copy of their parent directory. This can be called for the same files for which <code class="code " id="2a3f9af2_136"  >processSwitchedFile()</code> has already been called.</p></li></ul></section></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="run-configurations.html">Run Configurations Tutorial</a>   <a class="navigation-links__next" href="localization-guide.html">Localization Guide</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>