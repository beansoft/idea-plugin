<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:41.3836772"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Language Injection | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"intellilang","level":0,"title":"IntelliLang","anchor":"#intellilang"},{"id":"languageinjectioncontributor-and-languageinjectionperformer","level":0,"title":"LanguageInjectionContributor and LanguageInjectionPerformer","anchor":"#languageinjectioncontributor-and-languageinjectionperformer"},{"id":"multihostinjector","level":0,"title":"MultiHostInjector","anchor":"#multihostinjector"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Language Injection | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/language-injection.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Language Injection | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/language-injection.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/language-injection.html", "name": "Language Injection | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="language_injection.md" data-main-title="Language Injection" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/custom_language_support/language_injection.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="language_injection.md" id="language_injection.md"  >Language Injection</h1><p id="1be2f6c1_1" >Language injection is the way the IntelliJ Platform handles different languages within the same source file. Well-known examples are:</p><ul class="list _ul" id="1be2f6c1_2"    ><li class="list__item" id="1be2f6c1_3" ><p>Regular expressions in Java string literals</p></li><li class="list__item" id="1be2f6c1_4" ><p>SQL queries in Java string literals</p></li><li class="list__item" id="1be2f6c1_5" ><p>Fenced code blocks within Markdown files</p></li></ul><p id="1be2f6c1_6" >Injected code is always bound to a specific context that depends on the surrounding code, and the IntelliJ Platform treats injected fragments as separate small files that are in a different language. To ensure highlighting and code-insight features work correctly, these fragments must be a valid statement or expression in the injected language. The three examples from above would then be shown like this in IntelliJ IDEs:</p><div class="tabs" id="1be2f6c1_7"><div class="tabs__content" data-gtm="tab" id="1be2f6c1_8"   data-title="Regex" ><figure  id="1be2f6c1_9"><img alt="Regex Language Injection" title="Regex Language Injection" src="images/regex_language_injection.png"  class="article__bordered-element " width="460" height="88"/></figure></div><div class="tabs__content" data-gtm="tab" id="1be2f6c1_10"   data-title="SQL" ><figure  id="1be2f6c1_11"><img alt="SQL Language Injection" title="SQL Language Injection" src="images/sql_language_injection.png"  class="article__bordered-element " width="460" height="86"/></figure></div><div class="tabs__content" data-gtm="tab" id="1be2f6c1_12"   data-title="Markdown" ><figure  id="1be2f6c1_13"><img alt="Markdown Language Injection" title="Markdown Language Injection" src="images/markdown_code_language_injection.png"  class="article__bordered-element " width="460" height="135"/></figure></div></div><p id="1be2f6c1_14" >It's not unusual that injected fragments are distributed among, e.g., several strings that are concatenated like it is common for SQL queries. To solve this, the IntelliJ Platform allows injecting a language into several fragments at once. Multiple parts are then considered belonging together.</p><p id="1be2f6c1_15" >As a plugin author, you can provide language injection in different ways:</p><ul class="list _ul" id="1be2f6c1_16"    ><li class="list__item" id="1be2f6c1_17" ><p>For simple cases, the bundled <a href="https://plugins.jetbrains.com/plugin/1105-intellilang" id="1be2f6c1_18"   data-external="true" rel="noopener noreferrer" >IntelliLang plugin</a> can handle injections, and plugin authors need to provide a configuration with patterns that specify the context where languages should be injected. IntelliLang can also be extended to support unknown custom languages.</p></li><li class="list__item" id="1be2f6c1_19" ><p>Implementing the <code class="code " id="1be2f6c1_20"  >com.intellij.languageInjectionContributor</code> extension point (EP) provides a high-level API for the injection of other languages. For more control over how a language is injected, plugin authors use the <code class="code " id="1be2f6c1_21"  >com.intellij.languageInjectionPerformer</code> EP.</p></li><li class="list__item" id="1be2f6c1_22" ><p>Implementing the <code class="code " id="1be2f6c1_23"  >com.intellij.multiHostInjector</code> EP gives plugin authors the most control over where and how language injection will take place.</p></li></ul><p id="1be2f6c1_24" >In the following sections, we'll discuss these three options in more detail.</p><section class="chapter"  ><h2 id="intellilang" data-toc="intellilang"  >IntelliLang</h2><p id="1be2f6c1_25" >First, please read the available <a href="https://www.jetbrains.com/help/idea/language-injections-settings.html" id="1be2f6c1_26"   data-external="true" rel="noopener noreferrer" >documentation</a> on IntelliLang. A good point to start with is to inspect available language injections that you can find in the IntelliLang settings under . The injections shown are configured through XML files and loaded automatically.</p><section class="chapter"  ><h3 id="example" data-toc="example"  >Example</h3><p id="1be2f6c1_28" >Let's take a look at the Java <code class="code " id="1be2f6c1_29"  >String.matches()</code> method that injects the RegExp language into the string of the first argument. In the IntelliLang settings, it is defined as one possible injection in Java code.</p><figure  id="1be2f6c1_30"><img alt="Language Injection Settings" title="Language Injection Settings" src="images/language_injection_settings.png"  class="article__bordered-element " width="706" height="303"/></figure><p id="1be2f6c1_31" >Double-clicking on this entry shows the exact context where a RegExp can be injected, and <code class="code " id="1be2f6c1_32"  >String.matches()</code> is one of several possibilities. On the plugin side, these entries are defined in the file <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/java-support/resources/javaInjections.xml" id="1be2f6c1_33"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_34"  >javaInjections.xml</code></a>:</p><div class="code-block" data-lang="markup"         >
&lt;injection language=&quot;RegExp&quot; injector-id=&quot;java&quot;&gt;
  &lt;display-name&gt;String (java.lang)&lt;/display-name&gt;
  ...
  &lt;place&gt;&lt;![CDATA[
    psiParameter()
      .ofMethod(0, psiMethod().withName(&quot;matches&quot;)
      .withParameters(&quot;java.lang.String&quot;)
      .definedInClass(&quot;java.lang.String&quot;))
  ]]&gt;&lt;/place&gt;
&lt;/injection&gt;
</div><p id="1be2f6c1_36" >The XML file with the injection configurations is loaded through the <code class="code " id="1be2f6c1_37"  >org.intellij.intelliLang.injectionConfig</code> EP in the file <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/src/META-INF/intellilang-java-support.xml" id="1be2f6c1_38"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_39"  >intellilang-java-support.xml</code></a>.</p><div class="code-block" data-lang="markup"         >
&lt;extensions defaultExtensionNs=&quot;org.intellij.intelliLang&quot;&gt;
  &lt;languageSupport
      implementation=&quot;org.intellij.plugins.intelliLang.inject.java.JavaLanguageInjectionSupport&quot;/&gt;
  &lt;injectionConfig config=&quot;resources/javaInjections.xml&quot;/&gt;
&lt;/extensions&gt;
</div></section><section class="chapter"  ><h3 id="implementation" data-toc="implementation"  >Implementation</h3><p id="1be2f6c1_41" >It is important to make a distinction between plugin authors who want to provide injections into existing languages and plugin authors who want to provide support for IntelliLang injections in their custom language. Both define their injections by providing XML configurations and loading them through the <span class="filepath" id="1be2f6c1_42" ><a href="plugin-configuration-file.html" id="1be2f6c1_43" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span>. However, custom language authors need to implement the <code class="code " id="1be2f6c1_44"  >org.intellij.intelliLang.languageSupport</code> EP to make their language and PSI element patterns known to IntelliLang. Therefore, plugin authors who want to provide injections for known languages can skip the first step.</p><section class="chapter"  ><h4 id="implement-orgintellijintellilanglanguagesupport-ep" data-toc="implement-orgintellijintellilanglanguagesupport-ep"  >Implement org.intellij.intelliLang.languageSupport EP</h4><p id="1be2f6c1_45" >Implement the <code class="code " id="1be2f6c1_46"  >org.intellij.intelliLang.languageSupport</code> EP and use <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/src/org/intellij/plugins/intelliLang/inject/AbstractLanguageInjectionSupport.java" id="1be2f6c1_47"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_48"  >AbstractLanguageInjectionSupport</code></a> as a base class. Please refer to the API docs of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/src/org/intellij/plugins/intelliLang/inject/LanguageInjectionSupport.java" id="1be2f6c1_49"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_50"  >LanguageInjectionSupport</code></a> for information on methods to override and use <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/java-support/org/intellij/plugins/intelliLang/inject/java/JavaLanguageInjectionSupport.java" id="1be2f6c1_51"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_52"  >JavaLanguageInjectionSupport</code></a> as an example implementation.</p></section><section class="chapter"  ><h4 id="create-injection-configuration" data-toc="create-injection-configuration"  >Create Injection Configuration</h4><p id="1be2f6c1_53" >Create an XML file with the injection configuration. You can export existing injections from the IntelliLang settings to create a template and then edit it. <a href="https://plugins.jetbrains.com/docs/intellij/element-patterns.html" id="1be2f6c1_54"   data-external="true" rel="noopener noreferrer" >Element patterns</a> are used to specify the context where injections will take place. Custom language authors can use the specific patterns returned from their implementation of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/java-support/org/intellij/plugins/intelliLang/inject/java/JavaLanguageInjectionSupport.java" id="1be2f6c1_55"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_56"  >JavaLanguageInjectionSupport.getPatternClasses</code></a>.</p><p id="1be2f6c1_57" >The <code class="code " id="1be2f6c1_58"  >injection</code> tag requires the attributes <code class="code " id="1be2f6c1_59"  >language</code> and <code class="code " id="1be2f6c1_60"  >injector-id</code>. The first one specifies the <code class="code " id="1be2f6c1_61"  >language-id</code> (see <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lang/Language.java" id="1be2f6c1_62"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_63"  >Language.getID()</code></a>) of the language that is injected. The second one is the id of the host language (see <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/java-support/org/intellij/plugins/intelliLang/inject/java/JavaLanguageInjectionSupport.java" id="1be2f6c1_64"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_65"  >JavaLanguageInjectionSupport.getId()</code></a>). For instance, injecting SQLite into Python code is specified by the following opening tag:</p><div class="code-block" data-lang="markup"         >
&lt;injection language=&quot;SQLite&quot; injector-id=&quot;python&quot;&gt;
  ...
&lt;/injection&gt;
</div><p id="1be2f6c1_67" >Inside an injection, the following tags can be used:</p><div class="table-wrapper" ><table class=" wide" id="1be2f6c1_68"  ><thead><tr class=" ijRowHead" id="1be2f6c1_69" ><th id="1be2f6c1_70"    ><p>XML Tag</p></th><th id="1be2f6c1_71"    ><p>Description</p></th></tr></thead><tbody ><tr class="" id="1be2f6c1_72" ><td id="1be2f6c1_73"    ><p><code class="code " id="1be2f6c1_74"  >&lt;display-name&gt;</code></p></td><td id="1be2f6c1_75"    ><p>A short name for the injection.</p></td></tr><tr class="" id="1be2f6c1_76" ><td id="1be2f6c1_77"    ><p><code class="code " id="1be2f6c1_78"  >&lt;place&gt;</code></p></td><td id="1be2f6c1_79"    ><p>The element pattern that defines where an injection will take place. The content is wrapped in <code class="code " id="1be2f6c1_80"  >![CDATA[...]]</code>.</p></td></tr><tr class="" id="1be2f6c1_81" ><td id="1be2f6c1_82"    ><p><code class="code " id="1be2f6c1_83"  >&lt;prefix&gt;</code> and <code class="code " id="1be2f6c1_84"  >&lt;suffix&gt;</code></p></td><td id="1be2f6c1_85"    ><p>Static content that is wrapped around the injected code, e.g., to make it a valid expression. For example, to a CSS color specification inside a string, it can be wrapped with the prefix <code class="code " id="1be2f6c1_86"  >div { color:</code> and the suffix <code class="code " id="1be2f6c1_87"  >;}</code> to make it a valid CSS expression.</p></td></tr><tr class="" id="1be2f6c1_88" ><td id="1be2f6c1_89"    ><p><code class="code " id="1be2f6c1_90"  >&lt;value-pattern&gt;</code></p></td><td id="1be2f6c1_91"    ><p>A regex for the content that specifies when this injection should be applied. Regex groups can specify the text range of the injection (e.g. <code class="code " id="1be2f6c1_92"  >^javascript:(.+)</code>, see <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/xml-support/resources/xmlInjections-html.xml" id="1be2f6c1_93"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_94"  >xmlInjections-html.xml</code></a>).</p></td></tr><tr class="" id="1be2f6c1_95" ><td id="1be2f6c1_96"    ><p><code class="code " id="1be2f6c1_97"  >&lt;ignore-pattern&gt;</code></p></td><td id="1be2f6c1_98"    ><p>A regex for the content that specifies when this injection should not be applied.</p></td></tr></tbody ></table ></div></section><section class="chapter"  ><h4 id="create-an-xml-file-to-load-the-configuration" data-toc="create-an-xml-file-to-load-the-configuration"  >Create an XML File to Load the Configuration</h4><p id="1be2f6c1_99" >Create an XML file <span class="filepath" id="1be2f6c1_100" >myLanguageID-injections.xml</span> next to your <span class="filepath" id="1be2f6c1_101" >plugin.xml</span> that loads the above configuration. Custom language authors also register their implementation of the <code class="code " id="1be2f6c1_102"  >languageSupport</code> EP there.</p><div class="code-block" data-lang="markup"         >
&lt;idea-plugin&gt;
  &lt;extensions defaultExtensionNs=&quot;org.intellij.intelliLang&quot;&gt;
    &lt;injectionConfig config=&quot;path/to/your/injections.xml&quot;/&gt;
  &lt;/extensions&gt;
&lt;/idea-plugin&gt;
</div></section><section class="chapter"  ><h4 id="load-the-injection-configuration-in-pluginxml" data-toc="load-the-injection-configuration-in-pluginxml"  >Load the Injection Configuration in plugin.xml</h4><p id="1be2f6c1_104" >The injections are an optional dependency that only works when IntelliLang is enabled. Therefore, you load the configuration optionally in your main <span class="filepath" id="1be2f6c1_105" >plugin.xml</span>:</p><div class="code-block" data-lang="markup"         >
&lt;depends
    optional=&quot;true&quot;
    config-file=&quot;myLanguageID-injections.xml&quot;&gt;org.intellij.intelliLang&lt;/depends&gt;
</div></section></section></section><section class="chapter"  ><h2 id="languageinjectioncontributor-and-languageinjectionperformer" data-toc="languageinjectioncontributor-and-languageinjectionperformer"  >LanguageInjectionContributor and LanguageInjectionPerformer</h2><p id="1be2f6c1_107" >The <code class="code " id="1be2f6c1_108"  >com.intellij.languageInjectionContributor</code> EP provides injection information for the given context in terms of <span class="emphasis" id="1be2f6c1_109" >what</span> to inject. As a plugin author, implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lang/injection/general/LanguageInjectionContributor.java" id="1be2f6c1_110"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_111"  >LanguageInjectionContributor</code></a> to provide context-specific injections.</p><p id="1be2f6c1_112" >For instance, if you want to inject a YAML or JSON to a literal language depending on some conditions, you could implement this interface like this:</p><div class="code-block" data-lang="java"         >
public final class MyInjector implements LanguageInjectionContributor {

  @Override
  public @Nullable Injection getInjection(@NotNull PsiElement context) {
    if (!isConfigPlace(context)) return null;
    if (shouldInjectYaml(context)) {
      return new SimpleInjection(
          YAMLLanguage.INSTANCE, &quot;&quot;, &quot;&quot;, null
      );
    } else if (shouldInjectJSON(context)) {
      return new SimpleInjection(
          JsonLanguage.INSTANCE, &quot;&quot;, &quot;&quot;, null
      );
    }
    return null;
  }
}
</div><p id="1be2f6c1_114" >Register the implementation in your <span class="filepath" id="1be2f6c1_115" >plugin.xml</span>:</p><div class="code-block" data-lang="markup"         >
&lt;languageInjectionContributor
    implementationClass=&quot;MyInjector&quot;
    language=&quot;YourLanguage&quot;/&gt;
</div><p id="1be2f6c1_117" >If you want more control over how the injection should be done then implement the <code class="code " id="1be2f6c1_118"  >com.intellij.languageInjectionPerformer</code> EP which allows for complex language injections, e.g. for concatenation or interpolation of strings. If it is not implemented, then the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/IntelliLang/src/org/intellij/plugins/intelliLang/inject/DefaultLanguageInjectionPerformer.java" id="1be2f6c1_119"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_120"  >DefaultLanguageInjectionPerformer</code></a> will be used.</p><p id="1be2f6c1_121" >For the <code class="code " id="1be2f6c1_122"  >com.intellij.languageInjectionPerformer</code> EP, two methods need to be implemented in <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lang/injection/general/LanguageInjectionPerformer.java" id="1be2f6c1_123"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_124"  >LanguageInjectionPerformer</code></a>. First, <code class="code " id="1be2f6c1_125"  >isPrimary()</code> determines if this is the default <code class="code " id="1be2f6c1_126"  >LanguageInjectionPerformer</code> for the language and if it handles most of the injections. If there is no primary <code class="code " id="1be2f6c1_127"  >LanguageInjectionPerformer</code> found, then a fallback injection will be performed.</p><p id="1be2f6c1_128" >The method <code class="code " id="1be2f6c1_129"  >performInjection()</code> does the actual injection into the context PSI element and/or some elements around it if needed in case if they are semantically connected (concatenation injection for instance).</p><aside data-type="tip" class="prompt" data-title="" id="1be2f6c1_130" ><p id="1be2f6c1_131" >To use Language Injection API in your project, <a href="plugin-dependencies.html#2-project-setup" id="1be2f6c1_132" data-tooltip="Depending on the chosen development workflow (Gradle or DevKit), one of the two following steps is necessary."  >add dependency</a> on the <code class="code " id="1be2f6c1_133"  >org.intellij.intelliLang</code> plugin.</p></aside></section><section class="chapter"  ><h2 id="multihostinjector" data-toc="multihostinjector"  >MultiHostInjector</h2><p id="1be2f6c1_134" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lang/injection/MultiHostInjector.java" id="1be2f6c1_135"   data-external="true" rel="noopener noreferrer" ><code class="code " id="1be2f6c1_136"  >MultiHostInjector</code></a> registered in <code class="code " id="1be2f6c1_137"  >com.intellij.multiHostInjector</code> EP is a very low-level API, but it gives plugin authors the most freedom. It performs language injection inside other PSI elements, e.g. inject SQL inside an XML tag text or inject regular expressions into Java string literals.</p><p id="1be2f6c1_138" >Plugin authors need to implement <code class="code " id="1be2f6c1_139"  >getLanguagesToInject()</code> to provide a list of places to inject a language, and <code class="code " id="1be2f6c1_140"  >elementsToInjectIn()</code> to return a list of elements to inject.</p><p id="1be2f6c1_141" >For example, inject regular expressions into Java string literal:</p><div class="code-block" data-lang="java"         >
public class MyRegExpToJavaInjector implements MultiHostInjector {

  @Override
  public void getLanguagesToInject(@NotNull MultiHostRegistrar registrar,
                                   @NotNull PsiElement context) {
    if (context instanceof PsiLiteralExpression &amp;&amp; shouldInject(context)) {
      registrar
        .startInjecting(RegExpLanguage.INSTANCE)
        .addPlace(null, null, context, innerRangeStrippingQuotes(context))
        .doneInjecting();
    }
  }

  @Override
  public @NotNull List&lt;? extends Class&lt;? extends PsiElement&gt;&gt; elementsToInjectIn() {
    return List.of(PsiLiteralExpression.class);
  }
}
</div><p id="1be2f6c1_143" >Register the implementation in your <span class="filepath" id="1be2f6c1_144" >plugin.xml</span>:</p><div class="code-block" data-lang="markup"         >
&lt;multiHostInjector
    implementation=&quot;MyRegExpToJavaInjector&quot;/&gt;
</div><p id="1be2f6c1_146" >A more complex example is when you need to inject into several fragments at once. For example, if we have an XML-based DSL:</p><div class="code-block" data-lang="markup"         >
&lt;myDSL&gt;
  &lt;method&gt;
    &lt;name&gt;foo&lt;/name&gt;
    &lt;body&gt;System.out.println(42);&lt;/body&gt;
  &lt;/method&gt;
&lt;/myDSL&gt;
</div><p id="1be2f6c1_148" >which should be converted to the equivalent Java code:</p><div class="code-block" data-lang="java"         >
class MyDsl { void foo() { System.out.println(42); } }
</div><p id="1be2f6c1_150" >Here, we need to inject Java into several places at once, i.e. method name and its body:</p><div class="code-block" data-lang="java"         >
public class MyBizarreDSLInjector implements MultiHostInjector {

  @Override
  public void getLanguagesToInject(@NotNull MultiHostRegistrar registrar,
                                   @NotNull PsiElement context) {
    if (isMethodTag(context)) {
      registrar.startInjecting(JavaLanguage.INSTANCE);

      // construct class header, method header,
      // inject method name, append code block start
      registrar.addPlace(&quot;class MyDsl { void &quot;, &quot;() {&quot;,
          context, rangeForMethodName(context));

      // inject method body, append closing braces
      // to form a valid Java class structure
      registrar.addPlace(null, &quot;}}&quot;, context, rangeForBody(context));
      registrar.doneInjecting();
    }
  }
}
</div><p id="1be2f6c1_152" >Now, inside the editor the injected portion will work as expected where foo is the method name and <code class="code " id="1be2f6c1_153"  >System.out.println(42);</code> will look and feel like a method body with highlighting, completion, and goto definition working.</p></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="documentation-test.html">11. Documentation Test</a>   <a class="navigation-links__next" href="dev-alternate-products.html">Plugins Targeting IntelliJ Platform-Based IDEs</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>