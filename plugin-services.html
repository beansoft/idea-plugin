<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.3074177"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Services | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"types","level":0,"title":"Types","anchor":"#types"},{"id":"constructor","level":0,"title":"Constructor","anchor":"#constructor"},{"id":"light-services","level":0,"title":"Light Services","anchor":"#light-services"},{"id":"declaring-a-service","level":0,"title":"Declaring a Service","anchor":"#declaring-a-service"},{"id":"retrieving-a-service","level":0,"title":"Retrieving a Service","anchor":"#retrieving-a-service"},{"id":"project-service-sample","level":0,"title":"Project Service Sample","anchor":"#project-service-sample"},{"id":"sample-plugin","level":0,"title":"Sample Plugin","anchor":"#sample-plugin"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Services | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/plugin-services.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Services | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/plugin-services.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/plugin-services.html", "name": "Services | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="plugin_services.md" data-main-title="Services" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part I — 插件///plugin_structure.md|Plugin Structure"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/plugin_structure/plugin_services.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="plugin_services.md" id="plugin_services.md"  >Services</h1><p id="65b45491_1" >A <span class="emphasis" id="65b45491_2" >service</span> is a plugin component loaded on demand when your plugin calls the <code class="code " id="65b45491_3"  >getService()</code> method of corresponding <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/extensions/src/com/intellij/openapi/components/ComponentManager.java" id="65b45491_4"   data-external="true" rel="noopener noreferrer" ><code class="code " id="65b45491_5"  >ComponentManager</code></a> instance (see <a href="#types" id="65b45491_6" data-tooltip="The IntelliJ Platform offers three types of services: application-level services (global singleton), project-level services, and module-level services. For the latter two, a separate instance of the service is created for each instance of its corresponding scope, see Project Model…"  >Types</a>). The IntelliJ Platform ensures that only one instance of a service is loaded even though it is called several times.</p><p id="65b45491_7" >A service must have an implementation class that is used for service instantiation. A service may also have an interface class used to obtain the service instance and provide the service's API.</p><p id="65b45491_8" >A service needing a shutdown hook/cleanup routine can implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/openapi/Disposable.java" id="65b45491_9"   data-external="true" rel="noopener noreferrer" ><code class="code " id="65b45491_10"  >Disposable</code></a> and perform necessary work in <code class="code " id="65b45491_11"  >dispose()</code> (see <a href="disposers.html#automatically-disposed-objects" id="65b45491_12" data-tooltip="Many objects are disposed automatically by the platform if they implement the Disposable interface. The most important type of such objects is services. Application-level services are automatically disposed by the platform when the IDE is closed or the plugin providing the service…"  >Automatically Disposed Objects</a>).</p><p id="65b45491_13" >Services are used to encapsulate logic operating on a set of related classes or to provide some reusable functionality that can be used across the plugin project, and conceptually don't differ from the service classes in other languages or frameworks.</p><section class="chapter"  ><h2 id="types" data-toc="types"  >Types</h2><p id="65b45491_14" >The IntelliJ Platform offers three types of services: <span class="emphasis" id="65b45491_15" >application-level</span> services (global singleton), <span class="emphasis" id="65b45491_16" >project-level</span> services, and <span class="emphasis" id="65b45491_17" >module-level</span> services. For the latter two, a separate instance of the service is created for each instance of its corresponding scope, see <a href="project-structure.html" id="65b45491_18" data-tooltip="This topic considers the concept of projects based on the IntelliJ Platform and related subjects, such as modules, facets, libraries, and SDK. The project structure and Java classes available to manage projects and modules are discussed."  >Project Model Introduction</a>.</p><aside data-type="tip" class="prompt" data-title="" id="65b45491_19" ><p id="65b45491_20" >Please consider not using module-level services because it can increase memory usage for projects with many modules.</p></aside></section><section class="chapter"  ><h2 id="constructor" data-toc="constructor"  >Constructor</h2><p id="65b45491_21" >Project/Module-level service constructors can have a <code class="code " id="65b45491_22"  >Project</code>/<code class="code " id="65b45491_23"  >Module</code> argument. To improve startup performance, avoid any heavy initializations in the constructor.</p><aside data-type="tip" class="prompt" data-title="" id="65b45491_24" ><p id="65b45491_25" >Please note that using constructor injection is deprecated (and not supported in <a href="#light-services" id="65b45491_26" data-tooltip="Light Services are available since IntelliJ Platform 2019.3."  >Light Services</a>) for performance reasons. Other dependencies should be <a href="#retrieving-a-service" id="65b45491_27" data-tooltip="Do not acquire service instances eagerly or store them in fields, but obtain them in the place(s) where they will be used."  >acquired only when needed</a> in all corresponding methods (see <code class="code " id="65b45491_28"  >someServiceMethod()</code> in <a href="#project-service-sample" id="65b45491_29" data-tooltip="This minimal sample shows Light Service ProjectService interacting with another project-level service AnotherService (not shown here)."  >Project Service Sample</a>).</p></aside></section><section class="chapter"  ><h2 id="light-services" data-toc="light-services"  >Light Services</h2><aside data-type="tip" class="prompt" data-title="" id="65b45491_30" ><p id="65b45491_31" >Light Services are available since IntelliJ Platform 2019.3.</p></aside><p id="65b45491_32" >A service not going to be overridden does not need to be registered in <span class="filepath" id="65b45491_33" ><a href="plugin-configuration-file.html" id="65b45491_34" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span> (see <a href="#declaring-a-service" id="65b45491_35" data-tooltip="To register a non-Light Service, distinct extension points are provided for each type:"  >Declaring a Service</a>). Instead, annotate service class with <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/components/Service.java" id="65b45491_36"   data-external="true" rel="noopener noreferrer" ><code class="code " id="65b45491_37"  >@Service</code></a>. The service instance will be created in scope according to the caller (see <a href="#retrieving-a-service" id="65b45491_38" data-tooltip="Do not acquire service instances eagerly or store them in fields, but obtain them in the place(s) where they will be used."  >Retrieving a Service</a>).</p><p id="65b45491_39" >Restrictions:</p><ul class="list _ul" id="65b45491_40"    ><li class="list__item" id="65b45491_41" ><p>Service class must be <code class="code " id="65b45491_42"  >final</code>.</p></li><li class="list__item" id="65b45491_43" ><p>Constructor injection is not supported (since it is deprecated).</p></li><li class="list__item" id="65b45491_44" ><p>If service is a <a href="persisting-state-of-components.html" id="65b45491_45" data-tooltip="The IntelliJ Platform provides an API that allows components or services to persist their state between restarts of the IDE. You can use either a simple API to persist a few values or persist the state of more complicated components using the PersistentStateComponent interface."  >PersistentStateComponent</a>, roaming must be disabled (<code class="code " id="65b45491_46"  >roamingType = RoamingType.DISABLED</code>).</p></li></ul><p id="65b45491_47" >See <a href="#project-service-sample" id="65b45491_48" data-tooltip="This minimal sample shows Light Service ProjectService interacting with another project-level service AnotherService (not shown here)."  >Project-Level Service</a> below for a sample.</p></section><section class="chapter"  ><h2 id="declaring-a-service" data-toc="declaring-a-service"  >Declaring a Service</h2><p id="65b45491_49" >To register a non-<a href="#light-services" id="65b45491_50" data-tooltip="Light Services are available since IntelliJ Platform 2019.3."  >Light Service</a>, distinct extension points are provided for each type:</p><ul class="list _ul" id="65b45491_51"    ><li class="list__item" id="65b45491_52" ><p><code class="code " id="65b45491_53"  >com.intellij.applicationService</code> - application-level service</p></li><li class="list__item" id="65b45491_54" ><p><code class="code " id="65b45491_55"  >com.intellij.projectService</code> - project-level service</p></li><li class="list__item" id="65b45491_56" ><p><code class="code " id="65b45491_57"  >com.intellij.moduleService</code> - module-level service (not recommended, see Note above)</p></li></ul><p id="65b45491_58" >To expose service API, create separate class for <code class="code " id="65b45491_59"  >serviceInterface</code> and extend it in corresponding class registered in <code class="code " id="65b45491_60"  >serviceImplementation</code>. If <code class="code " id="65b45491_61"  >serviceInterface</code> isn't specified, it's supposed to have the same value as <code class="code " id="65b45491_62"  >serviceImplementation</code>.</p><p id="65b45491_63" >To provide custom implementation for test/headless environment, specify <code class="code " id="65b45491_64"  >testServiceImplementation</code>/<code class="code " id="65b45491_65"  >headlessImplementation</code> additionally.</p><p id="65b45491_66" ><span class="filepath" id="65b45491_67" >plugin.xml</span></p><div class="code-block" data-lang="markup"         >
&lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
  &lt;!-- Declare the application-level service --&gt;
  &lt;applicationService
      serviceInterface=&quot;mypackage.MyApplicationService&quot;
      serviceImplementation=&quot;mypackage.MyApplicationServiceImpl&quot;/&gt;

  &lt;!-- Declare the project-level service --&gt;
  &lt;projectService
      serviceInterface=&quot;mypackage.MyProjectService&quot;
      serviceImplementation=&quot;mypackage.MyProjectServiceImpl&quot;/&gt;
&lt;/extensions&gt;
</div><aside data-type="tip" class="prompt" data-title="" id="65b45491_69" ><p id="65b45491_70" >If declared services are intended to be used by other plugins depending on your plugin, consider <a href="bundling-plugin-openapi-sources.html" id="65b45491_71" data-tooltip="If a plugin exposes its own API that is meant to be used by other plugins, it is worth considering bundling the plugin's API sources in the ZIP distribution."  >bundling their sources</a> in the plugin distribution.</p></aside></section><section class="chapter"  ><h2 id="retrieving-a-service" data-toc="retrieving-a-service"  >Retrieving a Service</h2><p id="65b45491_72" >Do not acquire service instances eagerly or store them in fields, but obtain them in the place(s) where they will be used.</p><p id="65b45491_73" >Getting service doesn't need a read action and can be performed from any thread. If a service is requested from several threads, it will be initialized in the first thread, and other threads will be blocked until the service is fully initialized.</p><div class="tabs" id="65b45491_74"><div class="tabs__content" data-gtm="tab" id="65b45491_75"   data-title="Java" ><div class="code-block" data-lang="java"    data-title="Java"     >
MyApplicationService applicationService = ApplicationManager.getApplication()
  .getService(MyApplicationService.class);

MyProjectService projectService = project.getService(MyProjectService.class);
</div><p id="65b45491_77" >Service implementations can wrap these calls with convenient static <code class="code " id="65b45491_78"  >getInstance()</code> or <code class="code " id="65b45491_79"  >getInstance(Project)</code> method:</p><div class="code-block" data-lang="java"    data-title="Java"     >
MyApplicationService applicationService = MyApplicationService.getInstance();

MyProjectService projectService = MyProjectService.getInstance(project);
</div></div><div class="tabs__content" data-gtm="tab" id="65b45491_81"   data-title="Kotlin" ><div class="code-block" data-lang="kotlin"    data-title="Kotlin"     >
val applicationService = service&lt;MyApplicationService&gt;()

val projectService = project.service&lt;MyProjectService&gt;()
</div></div></div><section class="procedure-steps"   ><h3 id="65b45491_83" data-toc="65b45491_83">Getting Service Flow</h3 ><figure  id="65b45491_84"><a class="lightbox" href="images/getting_service.svg"><img alt="Getting Service" title="Getting Service" src="images/getting_service.svg"  class="" width="1166" height="962"/></a></figure><ol class="list _decimal"></ol></section></section><section class="chapter"  ><h2 id="project-service-sample" data-toc="project-service-sample"  >Project Service Sample</h2><p id="65b45491_85" >This minimal sample shows <a href="#light-services" id="65b45491_86" data-tooltip="Light Services are available since IntelliJ Platform 2019.3."  >Light Service</a> <code class="code " id="65b45491_87"  >ProjectService</code> interacting with another project-level service <code class="code " id="65b45491_88"  >AnotherService</code> (not shown here).</p><p id="65b45491_89" ><span class="filepath" id="65b45491_90" >ProjectService.java</span></p><div class="code-block" data-lang="java"         >
@Service
public final class ProjectService {

  private final Project myProject;

  public ProjectService(Project project) {
    myProject = project;
  }

  public void someServiceMethod(String parameter) {
    AnotherService anotherService = myProject.getService(AnotherService.class);
    String result = anotherService.anotherServiceMethod(parameter, false);
    // do some more stuff
  }
}
</div></section><section class="chapter"  ><h2 id="sample-plugin" data-toc="sample-plugin"  >Sample Plugin</h2><p id="65b45491_92" >To clarify how to use services, consider the <span class="control" id="65b45491_93" >maxOpenProjects</span> sample plugin available in the <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/max_opened_projects" id="65b45491_94"   data-external="true" rel="noopener noreferrer" >code samples</a>.</p><p id="65b45491_95" >This plugin has an application service counting the number of currently opened projects in the IDE. If this number exceeds the maximum number of simultaneously opened projects allowed by the plugin (3), it displays a warning message.</p><p id="65b45491_96" >See <a href="code-samples.html" id="65b45491_97" data-tooltip="This guide comes with a number of sample plugins available from dedicated intellij-sdk-code-samples GitHub repository."  >Code Samples</a> on how to set up and run the plugin.</p></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="plugin-extensions.html">Extensions</a>   <a class="navigation-links__next" href="plugin-listeners.html">Listeners</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>