<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-29T19:15:57.0402992"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Messaging Infrastructure | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"purpose","level":0,"title":"Purpose","anchor":"#purpose"},{"id":"rationale","level":0,"title":"Rationale","anchor":"#rationale"},{"id":"design","level":0,"title":"Design","anchor":"#design"},{"id":"broadcasting","level":0,"title":"Broadcasting","anchor":"#broadcasting"},{"id":"nested-messages","level":0,"title":"Nested Messages","anchor":"#nested-messages"},{"id":"tips-n-tricks","level":0,"title":"Tips\u0027n\u0027tricks","anchor":"#tips-n-tricks"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Messaging Infrastructure | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/messaging-infrastructure.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Messaging Infrastructure | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/messaging-infrastructure.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/messaging-infrastructure.html", "name": "Messaging Infrastructure | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="messaging_infrastructure.md" data-main-title="Messaging Infrastructure" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///fundamentals.md|基础知识"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/messaging_infrastructure.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="messaging_infrastructure.md" id="messaging_infrastructure.md"  >Messaging Infrastructure</h1><section class="chapter"  ><h2 id="purpose" data-toc="purpose"  >Purpose</h2><p id="3b7cf3d6_187" >The purpose of this document is to introduce the messaging infrastructure available in the IntelliJ Platform to developers and plugin writers. It is intended to answer why, when and how to use it.</p></section><section class="chapter"  ><h2 id="rationale" data-toc="rationale"  >Rationale</h2><p id="3b7cf3d6_188" >So, what is messaging in the IntelliJ Platform and why do we need it? Basically, its implementation of <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" id="3b7cf3d6_189"   data-external="true" rel="noopener noreferrer" >Publisher Subscriber Pattern</a> that provides additional features like <span class="emphasis" id="3b7cf3d6_190" >broadcasting on hierarchy</span> and special <span class="emphasis" id="3b7cf3d6_191" >nested events</span> processing (<span class="emphasis" id="3b7cf3d6_192" >nested event</span> here is a situation when new event is fired (directly or indirectly) from the callback of another event).</p></section><section class="chapter"  ><h2 id="design" data-toc="design"  >Design</h2><p id="3b7cf3d6_193" >Here are the main components of the messaging API.</p><section class="chapter"  ><h3 id="topic" data-toc="topic"  >Topic</h3><p id="3b7cf3d6_194" >This class serves as an endpoint at the messaging infrastructure. I.e., clients are allowed to subscribe to a specific topic within a bus and send messages to that topic within that particular bus.</p><figure  id="3b7cf3d6_195"><img alt="Topic" title="Topic" src="images/topic.svg"  class="" width="414" height="109"/></figure><ul class="list _ul" id="3b7cf3d6_196"    ><li class="list__item" id="3b7cf3d6_197" ><p><span class="emphasis" id="3b7cf3d6_198" >display name</span> just a human-readable name used for logging/monitoring purposes;</p></li><li class="list__item" id="3b7cf3d6_199" ><p><span class="emphasis" id="3b7cf3d6_200" >broadcast direction</span> will be explained in details at Broadcasting. Default value is <span class="emphasis" id="3b7cf3d6_201" >TO_CHILDREN</span>;</p></li><li class="list__item" id="3b7cf3d6_202" ><p><span class="emphasis" id="3b7cf3d6_203" >listener class</span> that is a business interface for particular topic. Subscribers register an implementation of this interface at the messaging infrastructure. Publishers later retrieve objects that conform to the interface (IS-A) and call any methods defined on those implementations. The messaging infrastructure takes care of dispatching the message to all subscribers of the topic by calling the same method with the same arguments on the registered implementation callbacks;</p></li></ul><p id="3b7cf3d6_204" >To clarify corresponding message bus, <code class="code " id="3b7cf3d6_205"  >Topic</code> field declaration can be annotated with <code class="code " id="3b7cf3d6_206"  >com.intellij.util.messages.Topic.AppLevel</code> and <code class="code " id="3b7cf3d6_207"  >com.intellij.util.messages.Topic.ProjectLevel</code>, respectively.</p><aside data-type="tip" class="prompt" data-title="" id="3b7cf3d6_208" ><p id="3b7cf3d6_209" >All available listeners/topics are listed on <a href="extension-point-list.html" id="3b7cf3d6_210" data-tooltip="IntelliJ Platform的扩展点和监听器一览"  >扩展点和监听器列表</a> under <span class="emphasis" id="3b7cf3d6_211" >Listeners</span> sections.</p></aside></section><section class="chapter"  ><h3 id="message-bus" data-toc="message-bus"  >Message Bus</h3><p id="3b7cf3d6_212" >Is the core of the messaging system. Is used at the following scenarios:</p><figure  id="3b7cf3d6_213"><img alt="Bus" title="Bus" src="images/bus.svg"  class="" width="411" height="194"/></figure></section><section class="chapter"  ><h3 id="connection" data-toc="connection"  >Connection</h3><p id="3b7cf3d6_214" >Manages all subscriptions for particular client within particular bus.</p><figure  id="3b7cf3d6_215"><img alt="Connection" title="Connection" src="images/connection.svg"  class="" width="263" height="221"/></figure><ul class="list _ul" id="3b7cf3d6_216"    ><li class="list__item" id="3b7cf3d6_217" ><p>keeps number of <span class="emphasis" id="3b7cf3d6_218" >topic handler</span> mappings (callbacks to invoke when message for the target topic is received) <span class="emphasis" id="3b7cf3d6_219" >Note</span>: not more than one handler per-topic within the same connection is allowed;</p></li><li class="list__item" id="3b7cf3d6_220" ><p>it's possible to specify <span class="emphasis" id="3b7cf3d6_221" >default handler</span> and subscribe to the target topic without explicitly provided callback. Connection will use that <span class="emphasis" id="3b7cf3d6_222" >default handler</span> when storing <span class="emphasis" id="3b7cf3d6_223" >(topic-handler)</span> mapping;</p></li><li class="list__item" id="3b7cf3d6_224" ><p>it's possible to explicitly release acquired resources (<span class="emphasis" id="3b7cf3d6_225" >disconnect()</span> method). Also it can be plugged to standard semi-automatic disposing (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/openapi/Disposable.java" id="3b7cf3d6_226"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_227"  >Disposable</code></a>);</p></li></ul></section><section class="chapter"  ><h3 id="putting-altogether" data-toc="putting-altogether"  >Putting Altogether</h3><p id="3b7cf3d6_228" ><span class="emphasis" id="3b7cf3d6_229" >Defining business interface and topic</span></p><div class="code-block" data-lang="java"         >
public interface ChangeActionNotifier {

    Topic&lt;ChangeActionNotifier&gt; CHANGE_ACTION_TOPIC = Topic.create(&quot;custom name&quot;, ChangeActionNotifier.class);

    void beforeAction(Context context);
    void afterAction(Context context);
}
</div><p id="3b7cf3d6_231" ><span class="emphasis" id="3b7cf3d6_232" >Subscribing</span></p><figure  id="3b7cf3d6_233"><img alt="Subscribing" title="Subscribing" src="images/subscribe.svg"  class="" width="840" height="111"/></figure><aside data-type="tip" class="prompt" data-title="" id="3b7cf3d6_234" ><p id="3b7cf3d6_235" >If targeting 2019.3 or later, use <a href="plugin-listeners.html" id="3b7cf3d6_236" data-tooltip="Listeners allow subscription to application and project events."  >declarative registration</a> if possible.</p></aside><div class="code-block" data-lang="java"         >
public void init(MessageBus bus) {
    bus.connect().subscribe(ActionTopics.CHANGE_ACTION_TOPIC, new ChangeActionNotifier() {
        @Override
        public void beforeAction(Context context) {
            // Process 'before action' event.
        }
        @Override
        public void afterAction(Context context) {
            // Process 'after action' event.
        }
    });
}
</div><p id="3b7cf3d6_238" ><span class="emphasis" id="3b7cf3d6_239" >Publishing</span></p><figure  id="3b7cf3d6_240"><img alt="Publishing" title="Publishing" src="images/publish.svg"  class="" width="668" height="124"/></figure><div class="code-block" data-lang="java"         >
public void doChange(Context context) {
    ChangeActionNotifier publisher = myBus.syncPublisher(ActionTopics.CHANGE_ACTION_TOPIC);
    publisher.beforeAction(context);
    try {
        // Do action
        // ...
    } finally {
        publisher.afterAction(context)
    }
}
</div><p id="3b7cf3d6_242" ><span class="emphasis" id="3b7cf3d6_243" >Existing resources</span></p><ul class="list _ul" id="3b7cf3d6_244"    ><li class="list__item" id="3b7cf3d6_245" ><p><span class="emphasis" id="3b7cf3d6_246" >MessageBus</span> instances are available via <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/extensions/src/com/intellij/openapi/components/ComponentManager.java" id="3b7cf3d6_247"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_248"  >ComponentManager.getMessageBus()</code></a> Many standard interfaces implement a message bus, e.g., <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/application/Application.java" id="3b7cf3d6_249"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_250"  >Application</code></a> and <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/project/Project.java" id="3b7cf3d6_251"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_252"  >Project</code></a>.</p></li><li class="list__item" id="3b7cf3d6_253" ><p>A number of public topics are used by the IntelliJ Platform, e.g., <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/AppTopics.java" id="3b7cf3d6_254"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_255"  >AppTopics</code></a>, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/ProjectTopics.java" id="3b7cf3d6_256"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3b7cf3d6_257"  >ProjectTopics</code></a>, etc. So, it's possible to subscribe to them in order to receive information about the processing.</p></li></ul></section></section><section class="chapter"  ><h2 id="broadcasting" data-toc="broadcasting"  >Broadcasting</h2><p id="3b7cf3d6_258" >Message buses can be organised into hierarchies. Moreover, the IntelliJ Platform has them already:</p><figure  id="3b7cf3d6_259"><img alt="Standard hierarchy" title="Standard hierarchy" src="images/standard_hierarchy.svg"  class="" width="392" height="47"/></figure><p id="3b7cf3d6_260" >That allows to notify subscribers registered in one message bus on messages sent to another message bus.</p><p id="3b7cf3d6_261" ><span class="emphasis" id="3b7cf3d6_262" >Example:</span></p><figure  id="3b7cf3d6_263"><img alt="Parent-child broadcast" title="Parent-child broadcast" src="images/parent_child_broadcast.svg"  class="" width="383" height="308"/></figure><p id="3b7cf3d6_264" >Here we have a simple hierarchy (<span class="emphasis" id="3b7cf3d6_265" >application bus</span> is a parent of <span class="emphasis" id="3b7cf3d6_266" >project bus</span>) with three subscribers for the same topic.</p><p id="3b7cf3d6_267" >We get the following if <span class="emphasis" id="3b7cf3d6_268" >topic1</span> defines broadcast direction as <span class="emphasis" id="3b7cf3d6_269" >TO_CHILDREN</span>:</p><ol class="list _decimal" id="3b7cf3d6_270"  type="1"  ><li class="list__item" id="3b7cf3d6_271" ><p>A message is sent to <span class="emphasis" id="3b7cf3d6_272" >topic1</span> via <span class="emphasis" id="3b7cf3d6_273" >application bus</span>;</p></li><li class="list__item" id="3b7cf3d6_274" ><p><span class="emphasis" id="3b7cf3d6_275" >handler1</span> is notified about the message;</p></li><li class="list__item" id="3b7cf3d6_276" ><p>The message is delivered to the subscribers of the same topic within <span class="emphasis" id="3b7cf3d6_277" >project bus</span> (<span class="emphasis" id="3b7cf3d6_278" >handler2</span> and <span class="emphasis" id="3b7cf3d6_279" >handler3</span>);</p></li></ol><p id="3b7cf3d6_280" ><span class="emphasis" id="3b7cf3d6_281" >Benefits</span></p><p id="3b7cf3d6_282" >We don't need to bother with memory management of subscribers that are bound to child buses but interested in parent bus-level events.</p><p id="3b7cf3d6_283" >Consider the example above we may want to have project-specific functionality that reacts to the application-level events. All we need to do is to subscribe to the target topic within the <span class="emphasis" id="3b7cf3d6_284" >project bus</span>. No hard reference to the project-level subscriber will be stored at application-level then, i.e., we just avoided memory leak on project re-opening.</p><p id="3b7cf3d6_285" ><span class="emphasis" id="3b7cf3d6_286" >Options</span></p><p id="3b7cf3d6_287" >Broadcast configuration is defined per-topic. The following options are available:</p><ul class="list _ul" id="3b7cf3d6_288"    ><li class="list__item" id="3b7cf3d6_289" ><p>TO_CHILDREN_ (default);</p></li><li class="list__item" id="3b7cf3d6_290" ><p><span class="emphasis" id="3b7cf3d6_291" >NONE</span>;</p></li><li class="list__item" id="3b7cf3d6_292" ><p><span class="emphasis" id="3b7cf3d6_293" >TO_PARENT</span>;</p></li></ul></section><section class="chapter"  ><h2 id="nested-messages" data-toc="nested-messages"  >Nested Messages</h2><p id="3b7cf3d6_294" ><span class="emphasis" id="3b7cf3d6_295" >Nested message</span> is a message sent (directly or indirectly) during another message processing. The IntelliJ Platform's Messaging infrastructure guarantees that all messages sent to particular topic will be delivered at the sending order.</p><p id="3b7cf3d6_296" ><span class="emphasis" id="3b7cf3d6_297" >Example:</span></p><p id="3b7cf3d6_298" >Suppose we have the following configuration:</p><figure  id="3b7cf3d6_299"><img alt="Nested messages" title="Nested messages" src="images/nested_config.svg"  class="" width="246" height="221"/></figure><p id="3b7cf3d6_300" >Let's see what happens if someone sends a message to the target topic:</p><ul class="list _ul" id="3b7cf3d6_301"    ><li class="list__item" id="3b7cf3d6_302" ><p><span class="emphasis" id="3b7cf3d6_303" >message1</span> is sent;</p></li><li class="list__item" id="3b7cf3d6_304" ><p><span class="emphasis" id="3b7cf3d6_305" >handler1</span> receives <span class="emphasis" id="3b7cf3d6_306" >message1</span> and sends <span class="emphasis" id="3b7cf3d6_307" >message2</span> to the same topic;</p></li><li class="list__item" id="3b7cf3d6_308" ><p><span class="emphasis" id="3b7cf3d6_309" >handler2</span> receives <span class="emphasis" id="3b7cf3d6_310" >message1</span>;</p></li><li class="list__item" id="3b7cf3d6_311" ><p><span class="emphasis" id="3b7cf3d6_312" >handler2</span> receives <span class="emphasis" id="3b7cf3d6_313" >message2</span>;</p></li><li class="list__item" id="3b7cf3d6_314" ><p><span class="emphasis" id="3b7cf3d6_315" >handler1</span> receives <span class="emphasis" id="3b7cf3d6_316" >message2</span>;</p></li></ul></section><section class="chapter"  ><h2 id="tips-n-tricks" data-toc="tips-n-tricks"  >Tips'n'tricks</h2><section class="chapter"  ><h3 id="relief-listeners-management" data-toc="relief-listeners-management"  >Relief Listeners Management</h3><p id="3b7cf3d6_317" >Messaging infrastructure is very light-weight, so, it's possible to reuse it at local sub-systems in order to relieve <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" id="3b7cf3d6_318"   data-external="true" rel="noopener noreferrer" >Subscribers</a> construction. Let's see what is necessary to do then:</p><ol class="list _decimal" id="3b7cf3d6_319"  type="1"  ><li class="list__item" id="3b7cf3d6_320" ><p>Define business interface to work with;</p></li><li class="list__item" id="3b7cf3d6_321" ><p>Create shared message bus and topic that uses the interface above (<span class="emphasis" id="3b7cf3d6_322" >shared</span> here means that either <span class="emphasis" id="3b7cf3d6_323" >subject</span> or <span class="emphasis" id="3b7cf3d6_324" >subscribers</span> know about them);</p></li></ol><p id="3b7cf3d6_325" >Let's compare that with a manual implementation:</p><ol class="list _decimal" id="3b7cf3d6_326"  type="1"  ><li class="list__item" id="3b7cf3d6_327" ><p>Define listener interface (business interface);</p></li><li class="list__item" id="3b7cf3d6_328" ><p>Provide reference to the <span class="emphasis" id="3b7cf3d6_329" >subject</span> to all interested listeners;</p></li><li class="list__item" id="3b7cf3d6_330" ><p>Add listeners storage and listeners management methods (add/remove) to the <span class="emphasis" id="3b7cf3d6_331" >subject</span>;</p></li><li class="list__item" id="3b7cf3d6_332" ><p>Manually iterate all listeners and call target callback in all places where new event is fired;</p></li></ol></section><section class="chapter"  ><h3 id="avoid-shared-data-modification-from-subscribers" data-toc="avoid-shared-data-modification-from-subscribers"  >Avoid Shared Data Modification from Subscribers</h3><p id="3b7cf3d6_333" >We had a problem in a situation when two subscribers tried to modify the same document (<a href="https://youtrack.jetbrains.com/issue/IDEA-71701" id="3b7cf3d6_334"   data-external="true" rel="noopener noreferrer" >IDEA-71701</a>).</p><p id="3b7cf3d6_335" >The thing is that every document change is performed by the following scenario:</p><ol class="list _decimal" id="3b7cf3d6_336"  type="1"  ><li class="list__item" id="3b7cf3d6_337" ><p><span class="emphasis" id="3b7cf3d6_338" >before change</span> event is sent to all document listeners and some of them publish new messages during that;</p></li><li class="list__item" id="3b7cf3d6_339" ><p>actual change is performed;</p></li><li class="list__item" id="3b7cf3d6_340" ><p><span class="emphasis" id="3b7cf3d6_341" >after change</span> event is sent to all document listeners;</p></li></ol><p id="3b7cf3d6_342" >We had the following then:</p><ol class="list _decimal" id="3b7cf3d6_343"  type="1"  ><li class="list__item" id="3b7cf3d6_344" ><p><span class="emphasis" id="3b7cf3d6_345" >message1</span> is sent to the topic with two subscribers;</p></li><li class="list__item" id="3b7cf3d6_346" ><p><span class="emphasis" id="3b7cf3d6_347" >message1</span> is queued for both subscribers;</p></li><li class="list__item" id="3b7cf3d6_348" ><p><span class="emphasis" id="3b7cf3d6_349" >message1</span> delivery starts;</p></li><li class="list__item" id="3b7cf3d6_350" ><p><span class="emphasis" id="3b7cf3d6_351" >subscriber1</span> receives <span class="emphasis" id="3b7cf3d6_352" >message1</span>;</p></li><li class="list__item" id="3b7cf3d6_353" ><p><span class="emphasis" id="3b7cf3d6_354" >subscriber1</span> issues document modification request at particular range (e.g. <span class="emphasis" id="3b7cf3d6_355" >document.delete(startOffset, endOffset)</span>);</p></li><li class="list__item" id="3b7cf3d6_356" ><p><span class="emphasis" id="3b7cf3d6_357" >before change</span> notification is sent to the document listeners;</p></li><li class="list__item" id="3b7cf3d6_358" ><p><span class="emphasis" id="3b7cf3d6_359" >message2</span> is sent by one of the standard document listeners to another topic within the same message bus during <span class="emphasis" id="3b7cf3d6_360" >before change</span> processing;</p></li><li class="list__item" id="3b7cf3d6_361" ><p>the bus tries to deliver all pending messages before queuing <span class="emphasis" id="3b7cf3d6_362" >message2</span>;</p></li><li class="list__item" id="3b7cf3d6_363" ><p><span class="emphasis" id="3b7cf3d6_364" >subscriber2</span> receives <span class="emphasis" id="3b7cf3d6_365" >message1</span> and also modifies a document;</p></li><li class="list__item" id="3b7cf3d6_366" ><p>the call stack is unwinded and <span class="emphasis" id="3b7cf3d6_367" >actual change</span> phase of document modification operation requested by <span class="emphasis" id="3b7cf3d6_368" >subscriber1</span> begins;</p></li></ol><p id="3b7cf3d6_369" ><span class="control" id="3b7cf3d6_370" >The problem</span> is that document range used by <span class="emphasis" id="3b7cf3d6_371" >subscriber1</span> for initial modification request is invalid if <span class="emphasis" id="3b7cf3d6_372" >subscriber2</span> has changed document's range before it.</p></section></section><div class="last-modified"> Last modified: 29 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="general-threading-rules.html">通用线程规则</a>   <a class="navigation-links__next" href="ide-infrastructure.html">IDE Infrastructure</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>