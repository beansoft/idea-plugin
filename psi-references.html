<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:41.6567383"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>PSI References | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"contributed-references","level":0,"title":"Contributed References","anchor":"#contributed-references"},{"id":"references-with-optional-or-multiple-resolve-results","level":0,"title":"References with Optional or Multiple Resolve Results","anchor":"#references-with-optional-or-multiple-resolve-results"},{"id":"searching-for-references","level":0,"title":"Searching for References","anchor":"#searching-for-references"},{"id":"implementing-references","level":0,"title":"Implementing References","anchor":"#implementing-references"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="PSI References | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/psi-references.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="PSI References | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/psi-references.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/psi-references.html", "name": "PSI References | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="psi_references.md" data-main-title="PSI References" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part IV — PSI"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/architectural_overview/psi_references.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="psi_references.md" id="psi_references.md"  >PSI References</h1><p id="3c1d41ba_1" >A <span class="emphasis" id="3c1d41ba_2" >reference</span> in a PSI tree is an object that represents a link from a <span class="emphasis" id="3c1d41ba_3" >usage</span> of a particular element in the code to the corresponding <span class="emphasis" id="3c1d41ba_4" >declaration</span>. <span class="emphasis" id="3c1d41ba_5" >Resolving</span> a reference means locating the declaration to which a specific usage refers.</p><p id="3c1d41ba_6" >The most common type of reference is defined by language semantics. For example, consider a simple Java method:</p><div class="code-block" data-lang="java"         >
public void hello(String message) {
    System.out.println(message);
}
</div><p id="3c1d41ba_8" >This simple code fragment contains five references. The references created by the identifiers <code class="code " id="3c1d41ba_9"  >String</code>, <code class="code " id="3c1d41ba_10"  >System</code>, <code class="code " id="3c1d41ba_11"  >out</code>, and <code class="code " id="3c1d41ba_12"  >println</code> can be resolved to the corresponding declarations in the JDK: the <code class="code " id="3c1d41ba_13"  >String</code> and <code class="code " id="3c1d41ba_14"  >System</code> classes, the <code class="code " id="3c1d41ba_15"  >out</code> field, and the <code class="code " id="3c1d41ba_16"  >println</code> method. The reference created by the second occurrence of the <code class="code " id="3c1d41ba_17"  >message</code> identifier in <code class="code " id="3c1d41ba_18"  >println(message)</code> can be resolved to the <code class="code " id="3c1d41ba_19"  >message</code> parameter, declared by <code class="code " id="3c1d41ba_20"  >String message</code> in the method header.</p><p id="3c1d41ba_21" >Note that <code class="code " id="3c1d41ba_22"  >String message</code> is not a reference and cannot be resolved. Instead, it's a <span class="emphasis" id="3c1d41ba_23" >declaration</span>. It does not refer to any name defined elsewhere; instead, it defines a name by itself.</p><p id="3c1d41ba_24" >A reference is an instance of a class implementing the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReference.java" id="3c1d41ba_25"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_26"  >PsiReference</code></a> interface. Note that references are distinct from PSI elements. References created by a PSI element are returned from <code class="code " id="3c1d41ba_27"  >PsiElement.getReferences()</code>, the underlying PSI element of a reference can be obtained from <code class="code " id="3c1d41ba_28"  >PsiReference.getElement()</code>.</p><p id="3c1d41ba_29" >To <span class="emphasis" id="3c1d41ba_30" >resolve</span> the reference - to locate the declaration being referenced - call <code class="code " id="3c1d41ba_31"  >PsiReference.resolve()</code>. It's very important to understand the difference between <code class="code " id="3c1d41ba_32"  >PsiReference.getElement()</code> and <code class="code " id="3c1d41ba_33"  >PsiReference.resolve()</code>. The former method returns the <span class="emphasis" id="3c1d41ba_34" >source</span> of a reference, while the latter returns its <span class="emphasis" id="3c1d41ba_35" >target</span>. In the example above, for the <code class="code " id="3c1d41ba_36"  >message</code> reference, <code class="code " id="3c1d41ba_37"  >getElement()</code> will return the <code class="code " id="3c1d41ba_38"  >message</code> identifier on the second line of the snippet, and <code class="code " id="3c1d41ba_39"  >resolve()</code> will return the <code class="code " id="3c1d41ba_40"  >message</code> identifier on the first line (inside the parameter list).</p><p id="3c1d41ba_41" >The process of resolving references is distinct from parsing and is not performed at the same time. Moreover, it is not always successful. If the code currently open in the IDE does not compile, or in other situations, it's normal for <code class="code " id="3c1d41ba_42"  >PsiReference.resolve()</code> to return <code class="code " id="3c1d41ba_43"  >null</code> - all code working with references must be prepared to handle that.</p><aside data-type="tip" class="prompt" data-title="" id="3c1d41ba_44" ><p id="3c1d41ba_45" >Please see also <a href="psi-performance.html#cache-results-of-heavy-computations" id="3c1d41ba_46" data-tooltip="Method calls such as PsiElement.getReference(s), PsiReference.resolve() (and multiResolve() and other equivalents) or computation of expression types, type inference results, control flow graphs, etc. can be expensive. To avoid paying this cost several times, the result of such…"  >Cache Results of Heavy Computations</a>.</p></aside><section class="chapter"  ><h2 id="contributed-references" data-toc="contributed-references"  >Contributed References</h2><p id="3c1d41ba_47" >In addition to references defined by the semantics of the programming language, the IDE recognizes many references determined by the semantics of the APIs and frameworks used in code. Consider the following example:</p><div class="code-block" data-lang="java"         >
File f = new File(&quot;foo.txt&quot;);
</div><p id="3c1d41ba_49" >Here, &quot;foo.txt&quot; has no special meaning from the point of view of the Java syntax - it's just a string literal. However, opening this example in IntelliJ IDEA and having a file called &quot;foo.txt&quot; in the same directory, one can <kbd data-bypass="true" class="keystroke" id="3c1d41ba_50" ><span class="keystroke__value">Ctrl/Cmd+Click</span></kbd> on &quot;foo.txt&quot; and navigate to the file. This works because the IDE recognizes the semantics of <code class="code " id="3c1d41ba_51"  >new File(...)</code> and contributes a reference into the string literal passed as a parameter to the method.</p><p id="3c1d41ba_52" >Typically, references can be contributed to elements that don't have their own references, such as string literals and comments. References are also often contributed to non-code files, such as XML or JSON.</p><p id="3c1d41ba_53" >Contributing references is one of the most common ways to extend an existing language. For example, your plugin can contribute references to Java code, even though the Java PSI is part of the platform and not defined in your plugin.</p><p id="3c1d41ba_54" >Implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReferenceContributor.java" id="3c1d41ba_55"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_56"  >PsiReferenceContributor</code></a> registered in <code class="code " id="3c1d41ba_57"  >com.intellij.psi.referenceContributor</code> extension point.</p><p id="3c1d41ba_58" >Attribute <code class="code " id="3c1d41ba_59"  >language</code> should be set to the Language ID where this contributor applies to. The exact places to contribute references to are then specified using <a href="element-patterns.html" id="3c1d41ba_60" data-tooltip="Element patterns provide a generic way to specify conditions on objects."  >Element Patterns</a> in calls to <code class="code " id="3c1d41ba_61"  >PsiReferenceRegistrar.registerReferenceProvider()</code>.</p><p id="3c1d41ba_62" >See also <a href="reference-contributor.html" id="3c1d41ba_63" data-tooltip="Reference: ,"  >Reference Contributor tutorial</a>.</p></section><section class="chapter"  ><h2 id="references-with-optional-or-multiple-resolve-results" data-toc="references-with-optional-or-multiple-resolve-results"  >References with Optional or Multiple Resolve Results</h2><p id="3c1d41ba_64" >In the simplest case, a reference resolves to a single element, and if resolving fails, the code is incorrect, and the IDE needs to highlight it as an error. However, there are cases when the situation is different.</p><p id="3c1d41ba_65" >The first case is <span class="emphasis" id="3c1d41ba_66" >soft references</span>. Consider the <code class="code " id="3c1d41ba_67"  >new File(&quot;foo.txt&quot;)</code> example above. If the IDE can't find the file &quot;foo.txt&quot;, it doesn't mean that an error needs to be highlighted - maybe the file is only available at runtime. Such references return <code class="code " id="3c1d41ba_68"  >true</code> from the <code class="code " id="3c1d41ba_69"  >PsiReference.isSoft()</code> method, which can then be used in inspection/annotator to skip highlighting them completely or use a lower severity.</p><p id="3c1d41ba_70" >The second case is <span class="emphasis" id="3c1d41ba_71" >polyvariant references</span>. Consider the case of a JavaScript program. JavaScript is a dynamically typed language, so the IDE cannot always precisely determine which method is being called at a particular location. To handle this, it provides a reference that can be resolved to multiple possible elements. Such references implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiPolyVariantReference.java" id="3c1d41ba_72"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_73"  >PsiPolyVariantReference</code></a> interface.</p><p id="3c1d41ba_74" >For resolving a <code class="code " id="3c1d41ba_75"  >PsiPolyVariantReference</code>, you call its <code class="code " id="3c1d41ba_76"  >multiResolve()</code> method. The call returns an array of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/ResolveResult.java" id="3c1d41ba_77"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_78"  >ResolveResult</code></a> objects. Each of the objects identifies a PSI element and also specifies whether the result is valid. For example, suppose you have multiple Java method overloads and a call with arguments not matching any of the overloads. In that case, you will get back <code class="code " id="3c1d41ba_79"  >ResolveResult</code> objects for all the overloads, and <code class="code " id="3c1d41ba_80"  >isValidResult()</code> returns <code class="code " id="3c1d41ba_81"  >false</code> for all of them.</p></section><section class="chapter"  ><h2 id="searching-for-references" data-toc="searching-for-references"  >Searching for References</h2><p id="3c1d41ba_82" >Resolving a reference means going from usage to the corresponding declaration. To perform the navigation in the opposite direction - from a declaration to its usages - perform a <span class="emphasis" id="3c1d41ba_83" >references search</span>.</p><p id="3c1d41ba_84" >To perform a search using <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/psi/search/searches/ReferencesSearch.java" id="3c1d41ba_85"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_86"  >ReferencesSearch</code></a>, specify the element to search for, and optionally other parameters such as the scope in which the reference needs to be searched. The created <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/util/Query.java" id="3c1d41ba_87"   data-external="true" rel="noopener noreferrer" ><code class="code " id="3c1d41ba_88"  >Query</code></a> allows obtaining all results at once or iterating over the results one by one. The latter allows stopping processing as soon as the first (matching) result has been found.</p></section><section class="chapter"  ><h2 id="implementing-references" data-toc="implementing-references"  >Implementing References</h2><p id="3c1d41ba_89" >Please refer to the <a href="references-and-resolve.html" id="3c1d41ba_90" data-tooltip="One of the most important and tricky parts in implementing a custom language PSI is resolving references. Resolving references gives users the ability to navigate from a PSI element usage (accessing a variable, calling a method, etc.) to the declaration of that element (the…"  >guide</a> and corresponding <a href="reference-contributor.html" id="3c1d41ba_91" data-tooltip="Reference: ,"  >tutorial</a> for more information.</p></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="navigating-psi.html">Navigating the PSI</a>   <a class="navigation-links__next" href="modifying-psi.html">Modifying the PSI</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>