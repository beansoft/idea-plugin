<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-29T19:15:57.1321832"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>File-Based Indexes | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"implementing-a-file-based-index","level":0,"title":"Implementing a File-Based Index","anchor":"#implementing-a-file-based-index"},{"id":"accessing-a-file-based-index","level":0,"title":"Accessing a File-Based Index","anchor":"#accessing-a-file-based-index"},{"id":"standard-indexes","level":0,"title":"Standard Indexes","anchor":"#standard-indexes"},{"id":"additional-index-roots","level":0,"title":"Additional Index Roots","anchor":"#additional-index-roots"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="File-Based Indexes | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/file-based-indexes.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="File-Based Indexes | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/file-based-indexes.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/file-based-indexes.html", "name": "File-Based Indexes | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="file_based_indexes.md" data-main-title="File-Based Indexes" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part IV — PSI///indexing_and_psi_stubs.md|Indexing and PSI Stubs"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/indexing_and_psi_stubs/file_based_indexes.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="file_based_indexes.md" id="file_based_indexes.md"  >File-Based Indexes</h1><p id="b970080e_113" >File-based indexes are based on a <a href="https://en.wikipedia.org/wiki/MapReduce" id="b970080e_114"   data-external="true" rel="noopener noreferrer" >Map/Reduce architecture</a>. Each index has a specific type of key and a particular type of value.</p><p id="b970080e_115" >The key is what's later used to retrieve data from the index.</p><p id="b970080e_116" ><span class="emphasis" id="b970080e_117" >Example:</span> in the word index, the key is the word itself.</p><p id="b970080e_118" >The value is arbitrary data, which is associated with the key in the index.</p><p id="b970080e_119" ><span class="emphasis" id="b970080e_120" >Example:</span> in the word index, the value is a mask indicating in which context the word occurs (code, string literal, or comment).</p><p id="b970080e_121" >In the simplest case, when one needs to know in what files some data is present, the value has type <code class="code " id="b970080e_122"  >Void</code> and is not stored in the index.</p><p id="b970080e_123" >When the index implementation indexes a file, it receives a file's content and returns a map from the keys found in the file to the associated values.</p><p id="b970080e_124" >When accessing an index, specify the key you're interested in and get back the list of files in which the key occurs, and the value associated with each file.</p><aside data-type="tip" class="prompt" data-title="" id="b970080e_125" ><p id="b970080e_126" >In some cases, using <a href="indexing-and-psi-stubs.html#gists" id="b970080e_127" data-tooltip="Sometimes, the following conditions hold:"  >Gists</a> can be considered as an alternative.</p></aside><section class="chapter"  ><h2 id="implementing-a-file-based-index" data-toc="implementing-a-file-based-index"  >Implementing a File-Based Index</h2><aside data-type="tip" class="prompt" data-title="" id="b970080e_128" ><p id="b970080e_129" >A relatively simple file-based index implementation is the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/ui-designer/src/com/intellij/uiDesigner/binding/FormClassIndex.java" id="b970080e_130"   data-external="true" rel="noopener noreferrer" >UI Designer bound forms index</a>, storing FQN of bound implementation class for <a href="https://www.jetbrains.com/help/idea/gui-designer-basics.html" id="b970080e_131"   data-external="true" rel="noopener noreferrer" >GUI Designer</a> <span class="filepath" id="b970080e_132" >.form</span> files.</p></aside><p id="b970080e_133" >Each specific index implementation is a class extending <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/FileBasedIndexExtension.java" id="b970080e_134"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_135"  >FileBasedIndexExtension</code></a> registered via <code class="code " id="b970080e_136"  >com.intellij.fileBasedIndex</code> extension point.</p><p id="b970080e_137" >An implementation of a file-based index consists of the following main parts:</p><ul class="list _ul" id="b970080e_138"    ><li class="list__item" id="b970080e_139" ><p><code class="code " id="b970080e_140"  >getIndexer()</code> returns the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/indexing/DataIndexer.java" id="b970080e_141"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_142"  >DataIndexer</code></a> implementation actually responsible for building a set of key/value pairs based on file content.</p></li><li class="list__item" id="b970080e_143" ><p><code class="code " id="b970080e_144"  >getKeyDescriptor()</code> returns the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/io/KeyDescriptor.java" id="b970080e_145"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_146"  >KeyDescriptor</code></a> responsible for comparing keys and storing them in a serialized binary format. Probably the most commonly used implementation is <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/io/EnumeratorStringDescriptor.java" id="b970080e_147"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_148"  >EnumeratorStringDescriptor</code></a>, which is designed for storing identifiers efficiently.</p></li><li class="list__item" id="b970080e_149" ><p><code class="code " id="b970080e_150"  >getValueExternalizer()</code> returns the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/io/DataExternalizer.java" id="b970080e_151"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_152"  >DataExternalizer</code></a> responsible for storing values in a serialized binary format.</p></li><li class="list__item" id="b970080e_153" ><p><code class="code " id="b970080e_154"  >getInputFilter()</code> allows restricting the indexing only to a certain set of files. Consider using <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/DefaultFileTypeSpecificInputFilter.java" id="b970080e_155"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_156"  >DefaultFileTypeSpecificInputFilter</code></a>.</p></li><li class="list__item" id="b970080e_157" ><p><code class="code " id="b970080e_158"  >getName()</code> returns a unique index ID. Consider using fully qualified index class name to not clash with other plugins defining index with the same ID, e.g., <code class="code " id="b970080e_159"  >com.example.myplugin.indexing.MyIndex</code>.</p></li><li class="list__item" id="b970080e_160" ><p><code class="code " id="b970080e_161"  >getVersion()</code> returns the version of the index implementation. The index is automatically rebuilt if the current version differs from the version of the index implementation used to build it.</p></li></ul><p id="b970080e_162" >If there's no value to associate with the files (i.e., value type is <code class="code " id="b970080e_163"  >Void</code>), simplify the implementation by extending <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/ScalarIndexExtension.java" id="b970080e_164"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_165"  >ScalarIndexExtension</code></a>. In case of single value per file, extend from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/SingleEntryFileBasedIndexExtension.java" id="b970080e_166"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_167"  >SingleEntryFileBasedIndexExtension</code></a>.</p><p id="b970080e_168" >Please see also <a href="indexing-and-psi-stubs.html#improving-indexing-performance" id="b970080e_169" data-tooltip="Indexing performance metrics in JSON format are generated in logs directory (see sandbox directory for development instance) in 2020.2 and later. These are additionally available in HTML format starting with 2021.1."  >Improving indexing performance</a>.</p><aside data-type="tip" class="prompt" data-title="" id="b970080e_170" ><p id="b970080e_171" ><span class="control" id="b970080e_172" >Critical Implementation Notes</span></p><p id="b970080e_173" >Value class must implement <code class="code " id="b970080e_174"  >equals()</code> and <code class="code " id="b970080e_175"  >hashCode()</code> properly, so a value deserialized from binary data should be equal to original one.</p><p id="b970080e_176" >The data returned by <code class="code " id="b970080e_177"  >DataIndexer.map()</code> must depend only on input data passed to the method, and must not depend on any external files. Otherwise, your index will not be correctly updated when the external data changes, and you will have stale data in your index.</p><p id="b970080e_178" >Please set system property <code class="code " id="b970080e_179"  >intellij.idea.indices.debug</code>/<code class="code " id="b970080e_180"  >intellij.idea.indices.debug.extra.sanity</code> to <code class="code " id="b970080e_181"  >true</code> to enable additional debugging assertions during development to assert correct index implementation.</p></aside></section><section class="chapter"  ><h2 id="accessing-a-file-based-index" data-toc="accessing-a-file-based-index"  >Accessing a File-Based Index</h2><p id="b970080e_182" >Access to file-based indexes is performed through the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/FileBasedIndex.java" id="b970080e_183"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_184"  >FileBasedIndex</code></a> class.</p><aside data-type="tip" class="prompt" data-title="" id="b970080e_185" ><p id="b970080e_186" >Please note index access is restricted during <a href="indexing-and-psi-stubs.html#dumb-mode" id="b970080e_187" data-tooltip="Indexing is a potentially lengthy process. It's performed in the background, and during this time, IDE features are restricted to the ones that don't require index: basic text editing, version control, etc. This restriction is managed by DumbService. Violations are reported via…"  >Dumb Mode</a>.</p></aside><p id="b970080e_188" >The following primary operations are supported:</p><ul class="list _ul" id="b970080e_189"    ><li class="list__item" id="b970080e_190" ><p><code class="code " id="b970080e_191"  >getAllKeys()</code> and <code class="code " id="b970080e_192"  >processAllKeys()</code> allow obtaining the list of all keys found in files, which are a part of the specified project. To optimize performance, consider returning <code class="code " id="b970080e_193"  >true</code> from <code class="code " id="b970080e_194"  >FileBasedIndexExtension.traceKeyHashToVirtualFileMapping()</code> (see javadoc for details).</p></li></ul><aside data-type="tip" class="prompt" data-title="" id="b970080e_195" ><p id="b970080e_196" >The returned data is guaranteed to contain all keys found in up-to-date project content, but may also include additional keys not currently found in the project.</p></aside><ul class="list _ul" id="b970080e_197"    ><li class="list__item" id="b970080e_198" ><p><code class="code " id="b970080e_199"  >getValues()</code> allows to get all values associated with a specific key but not the files in which they were found.</p></li><li class="list__item" id="b970080e_200" ><p><code class="code " id="b970080e_201"  >getContainingFiles()</code> allows collecting all files in which a particular key was encountered.</p></li><li class="list__item" id="b970080e_202" ><p><code class="code " id="b970080e_203"  >processValues()</code> allows iterating through all files in which a specific key was encountered and accessing the associated values simultaneously.</p></li></ul><aside data-type="tip" class="prompt" data-title="" id="b970080e_204" ><p id="b970080e_205" >Nested index access is forbidden as it might lead to a deadlock. Collect all necessary data from index <span class="emphasis" id="b970080e_206" >A</span> first, then process results while accessing index <span class="emphasis" id="b970080e_207" >B</span>.</p></aside></section><section class="chapter"  ><h2 id="standard-indexes" data-toc="standard-indexes"  >Standard Indexes</h2><p id="b970080e_208" >The IntelliJ Platform contains several standard file-based indexes. The most useful indexes for plugin developers are:</p><section class="chapter"  ><h3 id="word-index" data-toc="word-index"  >Word Index</h3><p id="b970080e_209" >Generally, the word index should be accessed indirectly by using helper methods of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/psi/search/PsiSearchHelper.java" id="b970080e_210"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_211"  >PsiSearchHelper</code></a> class.</p></section><section class="chapter"  ><h3 id="file-name-index" data-toc="file-name-index"  >File Name Index</h3><p id="b970080e_212" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/psi/search/FilenameIndex.java" id="b970080e_213"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_214"  >FilenameIndex</code></a> provides a quick way to find all files matching a specific file name.</p></section><section class="chapter"  ><h3 id="file-type-index" data-toc="file-type-index"  >File Type Index</h3><p id="b970080e_215" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/psi/search/FileTypeIndex.java" id="b970080e_216"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_217"  >FileTypeIndex</code></a> serves a similar goal: it allows to find all files of a particular <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/fileTypes/FileType.java" id="b970080e_218"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_219"  >FileType</code></a> quickly.</p></section></section><section class="chapter"  ><h2 id="additional-index-roots" data-toc="additional-index-roots"  >Additional Index Roots</h2><p id="b970080e_220" >To add additional files/directories to be indexed, implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/util/indexing/IndexableSetContributor.java" id="b970080e_221"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_222"  >IndexableSetContributor</code></a> and register in <a href="https://jb.gg/ipe?extensions=com.intellij.indexedRootsProvider" id="b970080e_223"   data-external="true" rel="noopener noreferrer" ><code class="code " id="b970080e_224"  >com.intellij.indexedRootsProvider</code></a> extension point.</p></section><div class="last-modified"> Last modified: 29 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="indexing-and-psi-stubs.html">Indexing and PSI Stubs</a>   <a class="navigation-links__next" href="stub-indexes.html">Stub Indexes</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>