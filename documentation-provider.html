<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:41.6297332"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>20. Documentation | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"implement-documentationprovider-and-register-the-ep","level":0,"title":"Implement DocumentationProvider and Register the EP","anchor":"#implement-documentationprovider-and-register-the-ep"},{"id":"ensure-that-the-correct-psi-element-is-used","level":0,"title":"Ensure That the Correct PSI Element Is Used","anchor":"#ensure-that-the-correct-psi-element-is-used"},{"id":"extract-documentation-comments-from-keyvalue-definitions","level":0,"title":"Extract Documentation Comments from Key/Value Definitions","anchor":"#extract-documentation-comments-from-keyvalue-definitions"},{"id":"render-the-documentation","level":0,"title":"Render the Documentation","anchor":"#render-the-documentation"},{"id":"implement-additional-functionality","level":0,"title":"Implement Additional Functionality","anchor":"#implement-additional-functionality"},{"id":"addendum-choosing-a-better-target-element","level":0,"title":"Addendum: Choosing a Better Target Element","anchor":"#addendum-choosing-a-better-target-element"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="20. Documentation | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/documentation-provider.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="20. Documentation | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/documentation-provider.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/documentation-provider.html", "name": "20. Documentation | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="documentation_provider.md" data-main-title="20. Documentation" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages///custom_language_support_tutorial.md|Custom Language Support Tutorial"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/tutorials/custom_language_support/documentation_provider.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="documentation_provider.md" id="documentation_provider.md"  >20. Documentation</h1><p id="6ab26a7_15" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-api/src/com/intellij/lang/documentation/DocumentationProvider.java" id="6ab26a7_16"   data-external="true" rel="noopener noreferrer" ><code class="code " id="6ab26a7_17"  >DocumentationProvider</code></a> helps users by showing documentation for symbols like method calls inside the editor. For the custom language tutorial, we're implementing a version of this extension point (EP) for the Simple Language that shows the key/value, the file where it is defined, and any related documentation comment.</p><section class="chapter"  ><h2 id="implement-documentationprovider-and-register-the-ep" data-toc="implement-documentationprovider-and-register-the-ep"  >Implement DocumentationProvider and Register the EP</h2><p id="6ab26a7_18" >In the first step, we create an empty class that extends <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-api/src/com/intellij/lang/documentation/AbstractDocumentationProvider.java" id="6ab26a7_19"   data-external="true" rel="noopener noreferrer" ><code class="code " id="6ab26a7_20"  >AbstractDocumentationProvider</code></a> and register it in the <span class="filepath" id="6ab26a7_21" ><a href="plugin-configuration-file.html" id="6ab26a7_22" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span>.</p><div class="code-block" data-lang="java"         >
public class SimpleDocumentationProvider extends AbstractDocumentationProvider { }
</div><p id="6ab26a7_24" >Make sure the class is registered in the <span class="filepath" id="6ab26a7_25" >plugin.xml</span> between the <code class="code " id="6ab26a7_26"  >extensions</code> tags, as shown below:</p><div class="code-block" data-lang="markup"         >
&lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
  &lt;!-- Other extensions… --&gt;
  &lt;lang.documentationProvider
      language=&quot;Simple&quot;
      implementationClass=&quot;org.intellij.sdk.language.SimpleDocumentationProvider&quot;/&gt;
&lt;/extensions&gt;
</div></section><section class="chapter"  ><h2 id="ensure-that-the-correct-psi-element-is-used" data-toc="ensure-that-the-correct-psi-element-is-used"  >Ensure That the Correct PSI Element Is Used</h2><p id="6ab26a7_28" >For the Simple Language, we consider two use-cases:</p><ol class="list _decimal" id="6ab26a7_29"  type="1"  ><li class="list__item" id="6ab26a7_30" ><p>A Simple key is <a href="reference-contributor.html" id="6ab26a7_31" data-tooltip="Reference: ,"  >used inside a Java string literal</a>, and we would like to show documentation for the key/value right from the reference inside the Java file.</p></li><li class="list__item" id="6ab26a7_32" ><p>The cursor is already over a key/value definition inside a Simple file, in which case we would also like to show its documentation.</p></li></ol><p id="6ab26a7_33" >To ensure that the IntelliJ Platform chooses the correct element of type <code class="code " id="6ab26a7_34"  >SimpleProperty</code> when  is called, we create a dummy implementation of <code class="code " id="6ab26a7_36"  >generateDoc()</code>:</p><div class="code-block" data-lang="java"         >
@Override
public @Nullable String generateDoc(PsiElement element,
                                    @Nullable PsiElement originalElement) {
  return super.generateDoc(element, originalElement);
}
</div><p id="6ab26a7_38" >Now, we set a breakpoint in our dummy implementation, debug the plugin, and call  for the Simple property both in the Java file and the Simple file. We do this by placing the cursor over the key and <a href="https://www.jetbrains.com/help/idea/viewing-reference-information.html#view-quick-docs" id="6ab26a7_40"   data-external="true" rel="noopener noreferrer" >pressing the shortcut</a> for showing the documentation.</p><p id="6ab26a7_41" >In both cases, we find that the element provided is <code class="code " id="6ab26a7_42"  >SimplePropertyImpl</code>, which is exactly what we hoped for. However, there are two drawbacks: inside a Java string, your cursor needs to be directly over <code class="code " id="6ab26a7_43"  >key</code> in the string <code class="code " id="6ab26a7_44"  >&quot;simple:key&quot;</code> to make <span class="emphasis" id="6ab26a7_45" >Quick Documentation</span> work. Since the Simple Language only allows for one property per string, it would be nice if <span class="emphasis" id="6ab26a7_46" >Quick Documentation</span> worked no matter where your cursor was positioned in the string as long as the string contained a Simple property. Inside a Simple file, the situation is similar, and calling  only works when the cursor is positioned on the key.</p><p id="6ab26a7_48" >Please refer to the Addendum below, which explains how to improve on this situation by additionally overriding <code class="code " id="6ab26a7_49"  >getCustomDocumentationElement()</code> method.</p></section><section class="chapter"  ><h2 id="extract-documentation-comments-from-keyvalue-definitions" data-toc="extract-documentation-comments-from-keyvalue-definitions"  >Extract Documentation Comments from Key/Value Definitions</h2><p id="6ab26a7_50" >While <code class="code " id="6ab26a7_51"  >SimpleProperty</code> elements will provide us with their key and value, we have no direct access to a possible comment that is preceding the key/value definition. Since we would like to show this comment in the documentation as well, we need a small helper function that extracts the text from the comment. This function will reside in the <code class="code " id="6ab26a7_52"  >SimpleUtil</code> class and will find for instance the comment preceding <code class="code " id="6ab26a7_53"  >apikey</code> in the following short example:</p><div class="code-block" data-lang="plaintext"         >
#An application programming interface key (API key) is a unique identifier
#used to authenticate a user, developer, or calling program to an API.
apikey=ph342m91337h4xX0r5k!11Zz!
</div><p id="6ab26a7_55" >The following implementation will check if there is any comment preceding a <code class="code " id="6ab26a7_56"  >SimpleProperty</code>, and if there is, it will collect all comment lines until it reaches either the previous key/value definition or the beginning of the file. One caveat is that since we're collecting the comment lines backwards, we need to reverse the list before joining them into a single string. A simple regex is used to remove the leading hash characters and whitespaces from each line.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div></section><section class="chapter"  ><h2 id="render-the-documentation" data-toc="render-the-documentation"  >Render the Documentation</h2><p id="6ab26a7_58" >With easy ways to access the key, the value, the file, and a possible documentation comment, we now have everything in place to provide a useful implementation of <code class="code " id="6ab26a7_59"  >generateDoc()</code>.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="6ab26a7_61" >The creation of the rendered documentation is done in a separate method for clarity. It uses <code class="code " id="6ab26a7_62"  >DocumentationMarkup</code> to align and format the contents.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="6ab26a7_64" >The <code class="code " id="6ab26a7_65"  >addKeyValueSection()</code> method used is just a small helper function to reduce repetition.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="6ab26a7_67" >After implementing all the steps above, the IDE will show the rendered documentation for a Simple key when called with .</p></section><section class="chapter"  ><h2 id="implement-additional-functionality" data-toc="implement-additional-functionality"  >Implement Additional Functionality</h2><p id="6ab26a7_69" >We can provide implementations for additional functionality that comes with a <code class="code " id="6ab26a7_70"  >DocumentationProvider</code>. For instance, when simply hovering the mouse over the code, it also shows documentation after a short delay. It's not necessary that this popup show the exact same information as when calling <span class="emphasis" id="6ab26a7_71" >Quick Documentation</span>, but for the purpose of this tutorial, we'll do just that.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="6ab26a7_73" >When the mouse hovers over code with <kbd data-bypass="true" class="keystroke" id="6ab26a7_74" ><span class="keystroke__value">Ctrl</span></kbd>/<kbd data-bypass="true" class="keystroke" id="6ab26a7_75" ><span class="keystroke__value">Cmd</span></kbd> pressed, the IDE shows navigation information of the symbol under the cursor, such as its namespace or package. The implementation below will show the Simple key and the file where it is defined.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="6ab26a7_77" >Finally,  can also be called from a selected entry within the autocompletion popup. In that case, language developers need to ensure that the correct PSI element for generating the documentation is provided. In the case of Simple Language, the lookup element is already a <code class="code " id="6ab26a7_79"  >SimpleProperty</code> and no additional work needs to be done. In other circumstances, you can override <code class="code " id="6ab26a7_80"  >getDocumentationElementForLookupItem()</code>and return the correct PSI element.</p></section><section class="chapter"  ><h2 id="addendum-choosing-a-better-target-element" data-toc="addendum-choosing-a-better-target-element"  >Addendum: Choosing a Better Target Element</h2><p id="6ab26a7_81" >To be able to call  for Simple properties in all places of a Java string literal, two steps are required:</p><ol class="list _decimal" id="6ab26a7_83"  type="1"  ><li class="list__item" id="6ab26a7_84" ><p>The extension point needs to be changed from <code class="code " id="6ab26a7_85"  >lang.documentationProvider</code> to <code class="code " id="6ab26a7_86"  >documentationProvider</code> because only then the Simple DocumentationProvider is called for PSI elements with a different language.</p></li><li class="list__item" id="6ab26a7_87" ><p>The <code class="code " id="6ab26a7_88"  >getCustomDocumentationElement()</code> method needs to be implemented to find the correct target PSI element for creating the documentation.</p></li></ol><p id="6ab26a7_89" >Therefore, the current version of the code could be extended to check whether  was called from inside a Java string or a Simple file. It then uses PSI and <code class="code " id="6ab26a7_91"  >PsiReference</code> functionalities to determine the correct target element. This allows getting documentation for a Simple property no matter where it was called inside a Java string literal or a Simple property definition.</p><div class="code-block" data-lang="java"         >
@Override
public @Nullable PsiElement getCustomDocumentationElement(@NotNull Editor editor,
                                                          @NotNull PsiFile file,
                                                          @Nullable PsiElement context,
                                                          int targetOffset) {
  if (context != null) {
    // In this part the SimpleProperty element
    // is extracted from inside a Java string
    if (context instanceof PsiJavaToken &amp;&amp;
        ((PsiJavaToken) context).getTokenType().equals(JavaTokenType.STRING_LITERAL)) {
      PsiElement parent = context.getParent();
      PsiReference[] references = parent.getReferences();
      for (PsiReference ref : references) {
        if (ref instanceof SimpleReference) {
          PsiElement property = ref.resolve();
          if (property instanceof SimpleProperty) {
            return property;
          }
        }
      }
    }
    // In this part the SimpleProperty element is extracted
    // when inside of a .simple file
    else if (context.getLanguage() == SimpleLanguage.INSTANCE) {
      PsiElement property =
        PsiTreeUtil.getParentOfType(context, SimpleProperty.class);
      if (property != null) {
        return property;
      }
    }
  }
  return super.getCustomDocumentationElement(
      editor, file, context, targetOffset);
}
</div></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="quick-fix.html">19. Quick Fix</a>   <a class="navigation-links__next" href="writing-tests-for-plugins.html">Testing a Custom Language Plugin</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>