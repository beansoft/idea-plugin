<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.1261191"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Multiple Carets | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"core-functionality","level":0,"title":"Core Functionality","anchor":"#core-functionality"},{"id":"editor-actions","level":0,"title":"Editor Actions","anchor":"#editor-actions"},{"id":"typing-actions","level":0,"title":"Typing Actions","anchor":"#typing-actions"},{"id":"code-insight-actions","level":0,"title":"Code Insight Actions","anchor":"#code-insight-actions"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Multiple Carets | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/multiple-carets.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Multiple Carets | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/multiple-carets.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/multiple-carets.html", "name": "Multiple Carets | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="multiple_carets.md" data-main-title="Multiple Carets" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///editors.md|Editors"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/multiple_carets.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="multiple_carets.md" id="multiple_carets.md"  >Multiple Carets</h1><section class="chapter"  ><h2 id="introduction" data-toc="introduction"  >Introduction</h2><p id="7e190ed5_1" >Support for multiple independent carets has been added to editor implementation in IDEA 13.1. Most editor actions (keyboard navigation, text insertion and deletion, etc.) will be applied to each caret independently. Each caret has its own associated selection, which is a continuous range of document characters (can be empty). When after some action two or more carets end up in the same visual position, they are merged into a single caret with their associated selections merged into a single one. A similar thing will happen when selections for several carets become overlapped: only one of the carets will remain, and the selections will be merged. There's a concept of 'primary' caret — the one on which non-multi-caret-aware actions and the actions which need a single-point document context (like code completion) will operate. Currently, the most recent caret is considered the primary one.</p></section><section class="chapter"  ><h2 id="core-functionality" data-toc="core-functionality"  >Core Functionality</h2><p id="7e190ed5_2" >Core logic related to multi-caret implementation such as accessing currently existing carets, adding and removing carets, is available via <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/CaretModel.java" id="7e190ed5_3"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_4"  >CaretModel</code></a> interface, some changes also have been made in <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/SelectionModel.java" id="7e190ed5_5"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_6"  >SelectionModel</code></a> interface. Check Javadoc of those interfaces for details.</p><p id="7e190ed5_7" >Notable changes from old behaviour:</p><ul class="list _ul" id="7e190ed5_8"    ><li class="list__item" id="7e190ed5_9" ><p id="7e190ed5_10" >Previously existing methods in <code class="code " id="7e190ed5_11"  >CaretModel</code> and <code class="code " id="7e190ed5_12"  >SelectionModel</code> to query and modify caret and selection positions work by default on the primary caret now. In the context of <code class="code " id="7e190ed5_13"  >CaretModel.runForEachCaret</code> method though, they operate on the current caret. So the behaviour of legacy code (not using Caret interface) will depend on the context of its invocation.</p></li><li class="list__item" id="7e190ed5_14" ><p id="7e190ed5_15" >Block selection doesn't exist as a separate concept anymore. Correspondingly, block-selection-related methods in SelectionModel interface have changed behaviour — <code class="code " id="7e190ed5_16"  >hasBlockSelection()</code> will always return false, <code class="code " id="7e190ed5_17"  >setBlockSelection()</code> will create a multi-caret selection equivalent to the requested block selection. <code class="code " id="7e190ed5_18"  >getBlockSelectionStarts()</code> and <code class="code " id="7e190ed5_19"  >getBlockSelectionEnds()</code> methods work in multi-caret state, returning all selected regions.</p></li></ul></section><section class="chapter"  ><h2 id="editor-actions" data-toc="editor-actions"  >Editor Actions</h2><section class="chapter"  ><h3 id="editoraction-and-editoractionhandler" data-toc="editoraction-and-editoractionhandler"  >EditorAction and EditorActionHandler</h3><p id="7e190ed5_20" >When <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/EditorActionHandler.java" id="7e190ed5_21"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_22"  >EditorActionHandler</code></a> is invoked, an additional parameter will be passed to it — a caret instance on which it should operate, or <code class="code " id="7e190ed5_23"  >null</code> if it's invoked without any caret context. If the handler invokes another handler (delegate handler for the same <code class="code " id="7e190ed5_24"  >actionId</code> or a completely unrelated handler), that parameter should normally be passed to the delegate unchanged (unless no context caret has been provided to the handler, but it needs to invoke another handler on a specific caret). Of course, the handler can just ignore the caret parameter if its functionality is not related to caret/selection position.</p><p id="7e190ed5_25" >If the handler needs to implement multi-caret functionality it can do so explicitly in the overridden <code class="code " id="7e190ed5_26"  >doExecute</code> method, but if it just needs that method to be invoked for each caret, it suffices to pass a parameter to <code class="code " id="7e190ed5_27"  >EditorActionHandler</code> constructor to make <code class="code " id="7e190ed5_28"  >doExecute</code> called for each caret when the handler is invoked without a specific caret context.</p></section><section class="chapter"  ><h3 id="editor-action-delegates" data-toc="editor-action-delegates"  >Editor Action Delegates</h3><p id="7e190ed5_29" >The following delegates are available:</p><ul class="list _ul" id="7e190ed5_30"    ><li class="list__item" id="7e190ed5_31" ><p><code class="code " id="7e190ed5_32"  >EnterHandlerDelegate</code></p></li><li class="list__item" id="7e190ed5_33" ><p><code class="code " id="7e190ed5_34"  >BackspaceHandlerDelegate</code></p></li><li class="list__item" id="7e190ed5_35" ><p><code class="code " id="7e190ed5_36"  >JoinLinesHandlerDelegate</code></p></li><li class="list__item" id="7e190ed5_37" ><p><code class="code " id="7e190ed5_38"  >EditorNavigationDelegate</code></p></li><li class="list__item" id="7e190ed5_39" ><p><code class="code " id="7e190ed5_40"  >SmartEnterProcessor</code></p></li><li class="list__item" id="7e190ed5_41" ><p><code class="code " id="7e190ed5_42"  >CommentCompleteHandler</code></p></li><li class="list__item" id="7e190ed5_43" ><p><code class="code " id="7e190ed5_44"  >StatementUpDownMover</code></p></li><li class="list__item" id="7e190ed5_45" ><p><code class="code " id="7e190ed5_46"  >CodeBlockProvider</code></p></li></ul><p id="7e190ed5_47" >At the moment there's no need to make any changes in the handlers to support multiple carets — they are already invoked for each caret.</p></section></section><section class="chapter"  ><h2 id="typing-actions" data-toc="typing-actions"  >Typing Actions</h2><section class="chapter"  ><h3 id="typedactionhandler-typedhandlerdelegate" data-toc="typedactionhandler-typedhandlerdelegate"  >TypedActionHandler, TypedHandlerDelegate</h3><p id="7e190ed5_48" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedActionHandler.java" id="7e190ed5_49"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_50"  >TypedActionHandler</code></a> and <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-api/src/com/intellij/codeInsight/editorActions/TypedHandlerDelegate.java" id="7e190ed5_51"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_52"  >TypedHandlerDelegate</code></a> implementations are invoked only once for each typed character. If those handlers need to support multiple carets, they will need to implement that explicitly.</p><p id="7e190ed5_53" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/EditorModificationUtil.java" id="7e190ed5_54"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_55"  >EditorModificationUtil</code></a>. <code class="code " id="7e190ed5_56"  >typeInStringAtCaretHonorMultipleCarets()</code> method is available to do the most common task in this case — inserting the same text into all caret positions and/or moving all carets relatively to their current position. Examples of its usage:</p><ul class="list _ul" id="7e190ed5_57"    ><li class="list__item" id="7e190ed5_58" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedAction.java" id="7e190ed5_59"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_60"  >TypedAction</code></a>.</p></li><li class="list__item" id="7e190ed5_61" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/xml/impl/src/com/intellij/codeInsight/editorActions/XmlGtTypedHandler.java" id="7e190ed5_62"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_63"  >XmlGtTypedHandler</code></a>.</p></li></ul><aside data-type="tip" class="prompt" data-title="" id="7e190ed5_64" ><p id="7e190ed5_65" >Starting from version 14, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-api/src/com/intellij/codeInsight/editorActions/TypedHandlerDelegate.java" id="7e190ed5_66"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_67"  >TypedHandlerDelegate</code></a> implementations are invoked automatically for each caret. If one wants to implement custom multicaret behaviour on typing, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedActionHandler.java" id="7e190ed5_68"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_69"  >TypedActionHandler</code></a> needs to be provided instead.</p></aside></section></section><section class="chapter"  ><h2 id="code-insight-actions" data-toc="code-insight-actions"  >Code Insight Actions</h2><p id="7e190ed5_70" >Existing actions inheriting from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-api/src/com/intellij/codeInsight/actions/CodeInsightAction.java" id="7e190ed5_71"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_72"  >CodeInsightAction</code></a> will work for primary caret only. To support multiple carets, one should subclass <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-impl/src/com/intellij/codeInsight/actions/MultiCaretCodeInsightAction.java" id="7e190ed5_73"   data-external="true" rel="noopener noreferrer" ><code class="code " id="7e190ed5_74"  >MultiCaretCodeInsightAction</code></a> instead. Each caret might have a different editor and PSI instance, so using the old API is not possible.</p></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="text-selection.html">Text Selection</a>   <a class="navigation-links__next" href="basic-run-configurations.html">Run Configurations</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>