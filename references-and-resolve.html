<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-29T19:15:56.7722377"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>References and Resolve | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"psireference","level":0,"title":"PsiReference","anchor":"#psireference"},{"id":"implementing-resolve-logic","level":0,"title":"Implementing Resolve Logic","anchor":"#implementing-resolve-logic"},{"id":"resolving-to-multiple-targets","level":0,"title":"Resolving to Multiple Targets","anchor":"#resolving-to-multiple-targets"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="References and Resolve | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/references-and-resolve.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="References and Resolve | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/references-and-resolve.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/references-and-resolve.html", "name": "References and Resolve | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="references_and_resolve.md" data-main-title="References and Resolve" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages///custom_language_support.md|Custom Language Support"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/custom_language_support/references_and_resolve.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="references_and_resolve.md" id="references_and_resolve.md"  >References and Resolve</h1><p id="da3673be_99" >One of the most important and tricky parts in implementing a custom language PSI is resolving references. Resolving references gives users the ability to navigate from a PSI element usage (accessing a variable, calling a method, etc.) to the declaration of that element (the variable's definition, a method declaration, and so on).</p><p id="da3673be_100" >This feature is needed in order to support the  action invoked by <kbd data-bypass="true" class="keystroke" id="da3673be_102" ><span class="keystroke__value">Ctrl/Cmd+B</span></kbd> or clicking the mouse button while holding <kbd data-bypass="true" class="keystroke" id="da3673be_103" ><span class="keystroke__value">Ctrl/Cmd</span></kbd> key, and it is a prerequisite for implementing the <a href="find-usages.html" id="da3673be_104" data-tooltip="The Find Usages action is a multi-step process, and each step of the process requires involvement from the custom language plugin."  >Find Usages</a> action, the <a href="rename-refactoring.html" id="da3673be_105" data-tooltip="The Rename refactoring operation is quite similar to that of Find Usages. It uses the same rules for locating the element to be renamed and the same index of words for finding the files that may have references to the element being renamed."  >Rename Refactoring</a> and <a href="code-completion.html" id="da3673be_106" data-tooltip="Two main types of code completion can be provided by custom language plugins: reference completion and contributor-based completion."  >Code Completion</a>.</p><p id="da3673be_107" >The  action is based on the same mechanism, so it becomes automatically available for all references that can be resolved by the language plugin. To customize the exact document range to show in the popup (e.g., include &quot;surrounding&quot; code or comments), provide <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-api/src/com/intellij/codeInsight/hint/ImplementationTextSelectioner.java" id="da3673be_109"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_110"  >ImplementationTextSelectioner</code></a> registered in <code class="code " id="da3673be_111"  >com.intellij.lang.implementationTextSelectioner</code> extension point.</p><section class="chapter"  ><h2 id="psireference" data-toc="psireference"  >PsiReference</h2><p id="da3673be_112" >All PSI elements which work as references (for which the  action applies) need to implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiElement.java" id="da3673be_114"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_115"  >PsiElement.getReference()</code></a> method and to return a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReference.java" id="da3673be_116"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_117"  >PsiReference</code></a> implementation from that method. The <code class="code " id="da3673be_118"  >PsiReference</code> can be implemented by the same class as <code class="code " id="da3673be_119"  >PsiElement</code>, or by a different class. An element can also contain multiple references (for example, a string literal can contain multiple substrings which are valid fully-qualified class names), in which case it can implement <code class="code " id="da3673be_120"  >PsiElement.getReferences()</code> and return the references as an array. To optimize <code class="code " id="da3673be_121"  >PsiElement.getReferences()</code> performance, consider implementing <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/HintedReferenceHost.java" id="da3673be_122"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_123"  >HintedReferenceHost</code></a> to provide additional hints.</p><p id="da3673be_124" >The primary method of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReference.java" id="da3673be_125"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_126"  >PsiReference</code></a> interface is <code class="code " id="da3673be_127"  >resolve()</code>, which returns the element to which the reference points, or <code class="code " id="da3673be_128"  >null</code> if it was not possible to resolve the reference to a valid element (for example, should it point to an undefined class). The resolved element should implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiNamedElement.java" id="da3673be_129"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_130"  >PsiNamedElement</code></a> interface. In order to enable more advanced functionality, prefer implementing <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiNameIdentifierOwner.java" id="da3673be_131"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_132"  >PsiNameIdentifierOwner</code></a> over <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiNamedElement.java" id="da3673be_133"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_134"  >PsiNamedElement</code></a> where possible.</p><aside data-type="tip" class="prompt" data-title="" id="da3673be_135" ><p id="da3673be_136" >While the referencing element and the referenced element both may have a name, only the element which <span class="control" id="da3673be_137" >introduces</span> the name (e.g., the definition <code class="code " id="da3673be_138"  >int x = 42</code>) needs to implement <code class="code " id="da3673be_139"  >PsiNamedElement</code>. The referencing element at the point of usage (e.g., the <code class="code " id="da3673be_140"  >x</code> in the expression <code class="code " id="da3673be_141"  >x + 1</code>) should not implement <code class="code " id="da3673be_142"  >PsiNamedElement</code> since it does not <span class="emphasis" id="da3673be_143" >have</span> a name.</p></aside><p id="da3673be_144" >A counterpart to the <code class="code " id="da3673be_145"  >resolve()</code> method is <code class="code " id="da3673be_146"  >isReferenceTo()</code>, which checks if the reference resolves to the specified element. The latter method can be implemented by calling <code class="code " id="da3673be_147"  >resolve()</code> and comparing the result with the passed PSI element. Still, additional optimizations are possible (for example, performing the tree walk only if the element text is equal to the text of the reference).</p><p id="da3673be_148" ><span class="control" id="da3673be_149" >Examples</span>:</p><ul class="list _ul" id="da3673be_150"    ><li class="list__item" id="da3673be_151" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties/src/com/intellij/lang/properties/ResourceBundleReference.java" id="da3673be_152"   data-external="true" rel="noopener noreferrer" >Reference</a> to a ResourceBundle in the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties" id="da3673be_153"   data-external="true" rel="noopener noreferrer" >Properties language plugin</a></p></li><li class="list__item" id="da3673be_154" ><p><a href="reference-contributor.html" id="da3673be_155" data-tooltip="Reference: ,"  >Custom Language Support Tutorial: Reference Contributor</a></p></li></ul></section><section class="chapter"  ><h2 id="implementing-resolve-logic" data-toc="implementing-resolve-logic"  >Implementing Resolve Logic</h2><p id="da3673be_156" >There is a set of interfaces that can be used as a base for implementing resolve support, namely the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/scope/PsiScopeProcessor.java" id="da3673be_157"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_158"  >PsiScopeProcessor</code></a> interface and the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiElement.java" id="da3673be_159"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_160"  >PsiElement.processDeclarations()</code></a> method. These interfaces have several extra complexities that are unnecessary for most custom languages (like support for substituting Java generics types). Still, they are required if the custom language can have references to Java code. If Java interoperability is not required, the plugin can forgo the standard interfaces and provide its own, different implementation of resolve.</p><p id="da3673be_161" >Please see also <a href="psi-performance.html#cache-results-of-heavy-computations" id="da3673be_162" data-tooltip="Method calls such as PsiElement.getReference(s), PsiReference.resolve() (and multiResolve() and other equivalents) or computation of expression types, type inference results, control flow graphs, etc. can be expensive. To avoid paying this cost several times, the result of such…"  >Cache Results of Heavy Computations</a>.</p><p id="da3673be_163" >The implementation of resolve based on the standard helper classes contains the following components:</p><ul class="list _ul" id="da3673be_164"    ><li class="list__item" id="da3673be_165" ><p>A class implements the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/scope/PsiScopeProcessor.java" id="da3673be_166"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_167"  >PsiScopeProcessor</code></a> interface, which gathers the possible declarations for the reference and stops the resolve process when it has successfully completed. The primary method which needs to be implemented is <code class="code " id="da3673be_168"  >execute()</code>, which is called to process every declaration encountered during the resolve, and returns <code class="code " id="da3673be_169"  >true</code> if the resolve needs to be continued or <code class="code " id="da3673be_170"  >false</code> if the declaration has been found. The methods <code class="code " id="da3673be_171"  >getHint()</code> and <code class="code " id="da3673be_172"  >handleEvent()</code> are used for internal optimizations and can be left empty in the <code class="code " id="da3673be_173"  >PsiScopeProcessor</code> implementations for custom languages.</p></li><li class="list__item" id="da3673be_174" ><p>A function which walks the PSI tree up from the reference location until the resolve has successfully completed or until the end of the resolve scope has been reached. If the target of the reference is located in a different file, the file can be located, for example, using <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/psi/search/FilenameIndex.java" id="da3673be_175"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_176"  >FilenameIndex.getFilesByName()</code></a> (if the file name is known) or by iterating through all custom language files in the project (<code class="code " id="da3673be_177"  >iterateContent()</code> in the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/roots/ProjectFileIndex.java" id="da3673be_178"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_179"  >ProjectFileIndex</code></a> interface obtained from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/roots/ProjectRootManager.java" id="da3673be_180"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_181"  >ProjectRootManager.getFileIndex()</code></a>).</p></li><li class="list__item" id="da3673be_182" ><p>The individual PSI elements, on which the <code class="code " id="da3673be_183"  >processDeclarations()</code> method is called during the PSI tree walk. If a PSI element is a declaration, it passes itself to the <code class="code " id="da3673be_184"  >execute()</code> method of the <code class="code " id="da3673be_185"  >PsiScopeProcessor</code> passed to it. Also, if necessary, according to the language scoping rules, a PSI element can pass the <code class="code " id="da3673be_186"  >PsiScopeProcessor</code> to its child elements.</p></li></ul></section><section class="chapter"  ><h2 id="resolving-to-multiple-targets" data-toc="resolving-to-multiple-targets"  >Resolving to Multiple Targets</h2><p id="da3673be_187" >An extension of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReference.java" id="da3673be_188"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_189"  >PsiReference</code></a> interface, which allows a reference to resolve to multiple targets, is the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiPolyVariantReference.java" id="da3673be_190"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_191"  >PsiPolyVariantReference</code></a> interface. The targets to which the reference resolves are returned from the <code class="code " id="da3673be_192"  >multiResolve()</code> method. The  action for such references allows the user to choose a navigation target in a popup. The implementation of <code class="code " id="da3673be_194"  >multiResolve()</code> can be also based on <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/scope/PsiScopeProcessor.java" id="da3673be_195"   data-external="true" rel="noopener noreferrer" ><code class="code " id="da3673be_196"  >PsiScopeProcessor</code></a>, and can collect all valid targets for the reference instead of stopping when the first valid target is found.</p></section><div class="last-modified"> Last modified: 29 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="syntax-highlighting-and-error-highlighting.html">Syntax and Error Highlighting</a>   <a class="navigation-links__next" href="symbols.html">Symbols</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>