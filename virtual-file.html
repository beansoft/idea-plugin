<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.5304677"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Virtual Files | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"how-do-i-get-a-virtual-file","level":0,"title":"How do I get a virtual file?","anchor":"#how-do-i-get-a-virtual-file"},{"id":"what-can-i-do-with-it","level":0,"title":"What can I do with it?","anchor":"#what-can-i-do-with-it"},{"id":"where-does-it-come-from","level":0,"title":"Where does it come from?","anchor":"#where-does-it-come-from"},{"id":"how-long-does-a-virtual-file-persist","level":0,"title":"How long does a virtual file persist?","anchor":"#how-long-does-a-virtual-file-persist"},{"id":"how-do-i-create-a-virtual-file","level":0,"title":"How do I create a virtual file?","anchor":"#how-do-i-create-a-virtual-file"},{"id":"how-do-i-get-notified-when-vfs-changes","level":0,"title":"How do I get notified when VFS changes?","anchor":"#how-do-i-get-notified-when-vfs-changes"},{"id":"are-there-any-utilities-for-analyzing-and-manipulating-virtual-files","level":0,"title":"Are there any utilities for analyzing and manipulating virtual files?","anchor":"#are-there-any-utilities-for-analyzing-and-manipulating-virtual-files"},{"id":"how-do-i-extend-vfs","level":0,"title":"How do I extend VFS?","anchor":"#how-do-i-extend-vfs"},{"id":"what-are-the-rules-for-working-with-vfs","level":0,"title":"What are the rules for working with VFS?","anchor":"#what-are-the-rules-for-working-with-vfs"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Virtual Files | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/virtual-file.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Virtual Files | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/virtual-file.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/virtual-file.html", "name": "Virtual Files | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="virtual_file.md" data-main-title="Virtual Files" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///files.md|Files"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/architectural_overview/virtual_file.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="virtual_file.md" id="virtual_file.md"  >Virtual Files</h1><p id="aafebee8_1" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/VirtualFile.java" id="aafebee8_2"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_3"  >VirtualFile</code></a> (VF) is the IntelliJ Platform's representation of a file in a <a href="virtual-file-system.html" id="aafebee8_4" data-tooltip="The Virtual File System (VFS) is a component of the IntelliJ Platform that encapsulates most of its activity for working with files represented as Virtual File."  >Virtual File System (VFS)</a>.</p><p id="aafebee8_5" >Most commonly, a virtual file is a file in a local file system. However, the IntelliJ Platform supports multiple pluggable file system implementations, so virtual files can also represent classes in a JAR file, old revisions of files loaded from a version control repository, and so on.</p><p id="aafebee8_6" >The VFS level deals only with binary content. Contents of a <code class="code " id="aafebee8_7"  >VirtualFile</code> are treated as a stream of bytes, but concepts like encodings and line separators are handled on higher system levels.</p><section class="chapter"  ><h2 id="how-do-i-get-a-virtual-file" data-toc="how-do-i-get-a-virtual-file"  >How do I get a virtual file?</h2><div class="table-wrapper" ><table class=" wide" id="aafebee8_8"  ><thead><tr class=" ijRowHead" id="aafebee8_9" ><th id="aafebee8_10"    ><p>Context</p></th><th id="aafebee8_11"    ><p>API</p></th></tr></thead><tbody ><tr class="" id="aafebee8_12" ><td id="aafebee8_13"    ><p><a href="basic-action-system.html" id="aafebee8_14" data-tooltip="The actions system allows plugins to add their items to IntelliJ Platform-based IDE menus and toolbars. For example, one of the action classes is responsible for the File | Open File... menu item and the Open... toolbar button."  >Action</a></p></td><td id="aafebee8_15"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/actionSystem/AnActionEvent.java" id="aafebee8_16"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_17"  >AnActionEvent.getData(PlatformDataKeys.VIRTUAL_FILE)</code></a></p><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/actionSystem/AnActionEvent.java" id="aafebee8_19"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_20"  >AnActionEvent.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY)</code></a> for multiple selection</p></td></tr><tr class="" id="aafebee8_21" ><td id="aafebee8_22"    ><p><a href="documents.html" id="aafebee8_23" data-tooltip="A Document is an editable sequence of Unicode characters, typically corresponding to the text contents of a virtual file."  >Document</a></p></td><td id="aafebee8_24"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/fileEditor/FileDocumentManager.java" id="aafebee8_25"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_26"  >FileDocumentManager.getFile()</code></a></p></td></tr><tr class="" id="aafebee8_27" ><td id="aafebee8_28"    ><p><a href="psi-files.html" id="aafebee8_29" data-tooltip="A PSI (Program Structure Interface) file is the root of a structure representing a file's contents as a hierarchy of elements in a particular programming language."  >PSI File</a></p></td><td id="aafebee8_30"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiFile.java" id="aafebee8_31"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_32"  >PsiFile.getVirtualFile()</code></a> (may return <code class="code " id="aafebee8_33"  >null</code> if the PSI file exists only in memory)</p></td></tr><tr class="" id="aafebee8_34" ><td id="aafebee8_35"    ><p>Local File System Path</p></td><td id="aafebee8_36"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-api/src/com/intellij/openapi/vfs/LocalFileSystem.java" id="aafebee8_37"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_38"  >LocalFileSystem.findFileByIoFile()</code></a></p><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/VirtualFileManager.java" id="aafebee8_40"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_41"  >VirtualFileManager.findFileByNioPath()</code>/<code class="code " id="aafebee8_42"  >refreshAndFindFileByNioPath()</code></a> (2020.2+)</p></td></tr></tbody ></table ></div></section><section class="chapter"  ><h2 id="what-can-i-do-with-it" data-toc="what-can-i-do-with-it"  >What can I do with it?</h2><p id="aafebee8_43" >Typical file operations are available, such as traverse the file system, get file contents, rename, move, or delete. Recursive iteration should be performed using <code class="code " id="aafebee8_44"  >VfsUtilCore.iterateChildrenRecursively()</code> to prevent endless loops caused by recursive symlinks.</p></section><section class="chapter"  ><h2 id="where-does-it-come-from" data-toc="where-does-it-come-from"  >Where does it come from?</h2><p id="aafebee8_45" >The VFS is built incrementally by scanning the file system up and down, starting from the project root. VFS <span class="emphasis" id="aafebee8_46" >refresh</span> operations detect new files appearing in the file system. A refresh operation can be initiated programmatically using <code class="code " id="aafebee8_47"  >VirtualFileManager.syncRefresh()</code>/<code class="code " id="aafebee8_48"  >asyncRefresh()</code> or <code class="code " id="aafebee8_49"  >VirtualFile.refresh()</code>. VFS refreshes are also triggered whenever file system watchers receive file system change notifications.</p><p id="aafebee8_50" >Invoking a VFS refresh might be necessary for accessing a file that has just been created by an external tool through the IntelliJ Platform APIs.</p></section><section class="chapter"  ><h2 id="how-long-does-a-virtual-file-persist" data-toc="how-long-does-a-virtual-file-persist"  >How long does a virtual file persist?</h2><p id="aafebee8_51" >A particular file on disk is represented by equal <code class="code " id="aafebee8_52"  >VirtualFile</code> instances for the IDE process's entire lifetime. There may be several instances corresponding to the same file, and they can be garbage-collected. The file is a <code class="code " id="aafebee8_53"  >UserDataHolder</code>, and the user data is shared between those equal instances. If a file is deleted, its corresponding VirtualFile instance becomes invalid (<code class="code " id="aafebee8_54"  >isValid()</code> returns <code class="code " id="aafebee8_55"  >false</code>), and operations cause exceptions.</p></section><section class="chapter"  ><h2 id="how-do-i-create-a-virtual-file" data-toc="how-do-i-create-a-virtual-file"  >How do I create a virtual file?</h2><p id="aafebee8_56" >Usually, you don't. As a general rule, files are created either through the PSI API or through the regular <code class="code " id="aafebee8_57"  >java.io.File</code> API.</p><p id="aafebee8_58" >If one needs to create a file through VFS, use <code class="code " id="aafebee8_59"  >VirtualFile.createChildData()</code> to create a <code class="code " id="aafebee8_60"  >VirtualFile</code> instance and <code class="code " id="aafebee8_61"  >VirtualFile.setBinaryContent()</code> to write some data to the file.</p></section><section class="chapter"  ><h2 id="how-do-i-get-notified-when-vfs-changes" data-toc="how-do-i-get-notified-when-vfs-changes"  >How do I get notified when VFS changes?</h2><aside data-type="tip" class="prompt" data-title="" id="aafebee8_62" ><p id="aafebee8_63" >See <a href="virtual-file-system.html#virtual-file-system-events" id="aafebee8_64" data-tooltip="All changes happening in the virtual file system, either due to refresh operations or caused by user actions, are reported as virtual file system events. VFS events are always fired in the event dispatch thread and in a write action."  >Virtual file system events</a> for important details.</p></aside><p id="aafebee8_65" >Implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/newvfs/BulkFileListener.java" id="aafebee8_66"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_67"  >BulkFileListener</code></a> and subscribe to the <a href="messaging-infrastructure.html" id="aafebee8_68" data-tooltip="The purpose of this document is to introduce the messaging infrastructure available in the IntelliJ Platform to developers and plugin writers. It is intended to answer why, when and how to use it."  >message bus</a> topic <code class="code " id="aafebee8_69"  >VirtualFileManager.VFS_CHANGES</code>. For example:</p><div class="code-block" data-lang="java"         >
project.getMessageBus().connect().subscribe(VirtualFileManager.VFS_CHANGES,
    new BulkFileListener() {
      @Override
      public void after(@NotNull List&lt;? extends VFileEvent&gt; events) {
        // handle the events
      }
    });
</div><p id="aafebee8_71" >See <a href="messaging-infrastructure.html" id="aafebee8_72" data-tooltip="The purpose of this document is to introduce the messaging infrastructure available in the IntelliJ Platform to developers and plugin writers. It is intended to answer why, when and how to use it."  >Message Infrastructure</a> and <a href="plugin-listeners.html" id="aafebee8_73" data-tooltip="Listeners allow subscription to application and project events."  >Plugin Listeners</a> for more details.</p><p id="aafebee8_74" >For a non-blocking alternative, starting with version 2019.2 of the platform, see <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/AsyncFileListener.java" id="aafebee8_75"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_76"  >AsyncFileListener</code></a>.</p></section><section class="chapter"  ><h2 id="are-there-any-utilities-for-analyzing-and-manipulating-virtual-files" data-toc="are-there-any-utilities-for-analyzing-and-manipulating-virtual-files"  >Are there any utilities for analyzing and manipulating virtual files?</h2><p id="aafebee8_77" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-api/src/com/intellij/openapi/vfs/VfsUtil.java" id="aafebee8_78"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_79"  >VfsUtil</code></a> and <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/VfsUtilCore.java" id="aafebee8_80"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_81"  >VfsUtilCore</code></a> provide utility methods for analyzing files in the Virtual File System.</p><p id="aafebee8_82" >For storing a large set of Virtual Files, use dedicated <code class="code " id="aafebee8_83"  >VfsUtilCore.createCompactVirtualFileSet()</code>.</p><p id="aafebee8_84" >Use <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/project/ProjectLocator.java" id="aafebee8_85"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_86"  >ProjectLocator</code></a> to find the projects that contain a given virtual file.</p></section><section class="chapter"  ><h2 id="how-do-i-extend-vfs" data-toc="how-do-i-extend-vfs"  >How do I extend VFS?</h2><p id="aafebee8_87" >To provide an alternative file system implementation (for example, an FTP file system), implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/VirtualFileSystem.java" id="aafebee8_88"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_89"  >VirtualFileSystem</code></a> class (most likely you'll also need to implement <code class="code " id="aafebee8_90"  >VirtualFile</code>), and register your implementation via <code class="code " id="aafebee8_91"  >com.intellij.virtualFileSystem</code> extension point (2019.2 and later) or <a href="plugin-components.html" id="aafebee8_92" data-tooltip="When writing new plugins, creating Components should be avoided. Any existing Components should be migrated to services, extensions, or listeners (see below)."  >application component</a> for earlier versions.</p><p id="aafebee8_93" >To hook into operations performed in the local file system (for example, when developing a version control system integration that needs custom rename/move handling), implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-api/src/com/intellij/openapi/vfs/LocalFileOperationsHandler.java" id="aafebee8_94"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aafebee8_95"  >LocalFileOperationsHandler</code></a> and register it via <code class="code " id="aafebee8_96"  >LocalFileSystem.registerAuxiliaryFileOperationsHandler()</code>.</p></section><section class="chapter"  ><h2 id="what-are-the-rules-for-working-with-vfs" data-toc="what-are-the-rules-for-working-with-vfs"  >What are the rules for working with VFS?</h2><p id="aafebee8_97" >See <a href="virtual-file-system.html" id="aafebee8_98" data-tooltip="The Virtual File System (VFS) is a component of the IntelliJ Platform that encapsulates most of its activity for working with files represented as Virtual File."  >Virtual File System</a> for a detailed description of the VFS architecture and usage guidelines.</p></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="virtual-file-system.html">Virtual File System</a>   <a class="navigation-links__next" href="documents.html">Documents</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>