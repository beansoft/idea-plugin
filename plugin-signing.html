<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.1481228"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Plugin Signing | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"how-signing-works","level":0,"title":"How Signing Works","anchor":"#how-signing-works"},{"id":"signing-methods","level":0,"title":"Signing Methods","anchor":"#signing-methods"},{"id":"signing-for-custom-repositories","level":0,"title":"Signing for Custom Repositories","anchor":"#signing-for-custom-repositories"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Plugin Signing | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/plugin-signing.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Plugin Signing | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/plugin-signing.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/plugin-signing.html", "name": "Plugin Signing | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="plugin_signing.md" data-main-title="Plugin Signing" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part I — 插件"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/plugin_signing.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="plugin_signing.md" id="plugin_signing.md"  >Plugin Signing</h1><p id="70af0fb9_1" >Plugin Signing is a mechanism introduced in the 2021.2 release cycle to increase security in <a href="https://plugins.jetbrains.com" id="70af0fb9_2"   data-external="true" rel="noopener noreferrer" >JetBrains Marketplace</a> and all of our IntelliJ-based IDEs.</p><p id="70af0fb9_3" >The Marketplace signing is designed to ensure that plugins are not modified over the course of the publishing and delivery pipeline. If the author does not sign the plugin or has a revoked certificate, a warning dialog will appear in the IDE during installation.</p><p id="70af0fb9_4" >On our side, we will check if the public part of a key is present, and we will verify the signature. This is similar to the <a href="https://developer.android.com/studio/publish/app-signing#generate-key" id="70af0fb9_5"   data-external="true" rel="noopener noreferrer" >Google upload key</a> mechanism.</p><section class="chapter"  ><h2 id="how-signing-works" data-toc="how-signing-works"  >How Signing Works</h2><p id="70af0fb9_6" >To be sure a file has not been modified, the file will be signed twice – first by the plugin author, then by JetBrains Marketplace.</p><p id="70af0fb9_7" >The plugin author's sign-verify process is as follows:</p><ul class="list _ul" id="70af0fb9_8"    ><li class="list__item" id="70af0fb9_9" ><p>A plugin author generates a key pair <span id="70af0fb9_10"   class=""><span class="text-line-through">and uploads the public part to JetBrains Marketplace</span></span> (this feature is not yet available).</p></li><li class="list__item" id="70af0fb9_11" ><p>A build tool signs a plugin file during the assembly process.</p></li><li class="list__item" id="70af0fb9_12" ><p>The user uploads the plugin file to JetBrains Marketplace.</p></li><li class="list__item" id="70af0fb9_13" ><p>JetBrains Marketplace checks if the public key is present in the user profile.</p></li><li class="list__item" id="70af0fb9_14" ><p>JetBrains Marketplace verifies the signature.</p></li><li class="list__item" id="70af0fb9_15" ><p>The JetBrains sign-verify process is as follows: </p><ul class="list _ul" id="70af0fb9_16"    ><li class="list__item" id="70af0fb9_17" ><p>JetBrains CA is used as the source of truth here.</p></li><li class="list__item" id="70af0fb9_18" ><p>Its public part will be added to the IDE Java TrustStore, while the private part will be used only once to generate an intermediate certificate.</p></li><li class="list__item" id="70af0fb9_19" ><p>The private key of JetBrains CA is super-secret; in fact, we've already said too much.</p></li></ul></li></ul><p id="70af0fb9_20" >The intermediate certificate issues a certificate that will be used to sign plugins. This way, it will be possible to re-generate this certificate without access to JetBrains CA's super-secret private key. The private key of the intermediate certificate is issued and kept in the AWS Certificate Manager, and no application has access to it; people's access is also limited. So now we have an AWS-based Intermediate CA. The public part of the intermediate certificate will be added to the plugin file together with the signing certificate.</p><p id="70af0fb9_21" >The certificate used to sign plugins is stored securely, too. JetBrains Marketplace uses AWS KMS as a signature provider to sign plugin files.</p></section><section class="chapter"  ><h2 id="signing-methods" data-toc="signing-methods"  >Signing Methods</h2><p id="70af0fb9_22" >To provide a suitable method for plugin signing, we have introduced the <a href="https://github.com/JetBrains/marketplace-zip-signer" id="70af0fb9_23"   data-external="true" rel="noopener noreferrer" >Marketplace ZIP Signer</a> library. It can be executed using the <a href="tools-gradle-intellij-plugin.html#tasks-signplugin" id="70af0fb9_24" data-tooltip="Signs the ZIP archive with the provided key using marketplace-zip-signer library."  ><code class="code " id="70af0fb9_25"  >signPlugin</code></a> task provided by the <a href="tools-gradle-intellij-plugin.html" id="70af0fb9_26" data-tooltip="The Gradle IntelliJ Plugin is a plugin for the Gradle build system to help configuring your environment for building, testing, verifying, and publishing plugins for IntelliJ-based IDEs."  >Gradle IntelliJ Plugin</a> if your project is Gradle-based. Alternatively, it can be used standalone <a href="#cli-tool" id="70af0fb9_27" data-tooltip="CLI tool is required if you don't rely on the Gradle IntelliJ Plugin – i.e. when working with Themes."  >CLI Tool</a>.</p><p id="70af0fb9_28" >Both methods require a private certificate key to be already present.</p><section class="chapter"  ><h3 id="generate-private-key" data-toc="generate-private-key"  >Generate Private Key</h3><p id="70af0fb9_29" >To generate an RSA <span class="filepath" id="70af0fb9_30" >private.pem</span> private key, run the <code class="code " id="70af0fb9_31"  >openssl genpkey</code> command in the terminal, as below:</p><div class="code-block" data-lang="bash"         >
openssl genpkey\
  -aes-256-cbc\
  -algorithm RSA\
  -out private.pem\
  -pkeyopt rsa_keygen_bits:4096
</div><p id="70af0fb9_33" >At this point, the generated <span class="filepath" id="70af0fb9_34" >private.pem</span> content should be provided to the <a href="tools-gradle-intellij-plugin.html#signplugin-task-privatekey" id="70af0fb9_35" data-tooltip="Encoded private key in PEM format. Refers to key CLI option."  ><code class="code " id="70af0fb9_36"  >signPlugin.privateKey</code></a> property. Provided password should be specified as the <a href="tools-gradle-intellij-plugin.html#signplugin-task-password" id="70af0fb9_37" data-tooltip="Password required to decrypt the private key. Refers to key-pass CLI option."  ><code class="code " id="70af0fb9_38"  >signPlugin.password</code></a> property in the <a href="tools-gradle-intellij-plugin.html#tasks-signplugin" id="70af0fb9_39" data-tooltip="Signs the ZIP archive with the provided key using marketplace-zip-signer library."  ><code class="code " id="70af0fb9_40"  >signPlugin</code></a> configuration.</p><p id="70af0fb9_41" >As a next step, we'll generate a <span class="filepath" id="70af0fb9_42" >chain.crt</span> certificate chain with:</p><div class="code-block" data-lang="bash"         >
openssl req\
  -key private.pem\
  -new\
  -x509\
  -days 365\
  -out chain.crt
</div><p id="70af0fb9_44" >The content of the <span class="filepath" id="70af0fb9_45" >chain.crt</span> file will be used for the <a href="tools-gradle-intellij-plugin.html#signplugin-task-certificatechain" id="70af0fb9_46" data-tooltip="A string containing X509 certificates. The first certificate from the chain will be used as a certificate authority (CA). Refers to cert CLI option."  ><code class="code " id="70af0fb9_47"  >signPlugin.certificateChain</code></a> property.</p></section><section class="chapter"  ><h3 id="gradle-intellij-plugin" data-toc="gradle-intellij-plugin"  >Gradle IntelliJ Plugin</h3><p id="70af0fb9_48" >In version <code class="code " id="70af0fb9_49"  >1.x</code>, the Gradle IntelliJ Plugin provides the <a href="tools-gradle-intellij-plugin.html#tasks-signplugin" id="70af0fb9_50" data-tooltip="Signs the ZIP archive with the provided key using marketplace-zip-signer library."  ><code class="code " id="70af0fb9_51"  >signPlugin</code></a> task, which will be executed automatically right before the <a href="tools-gradle-intellij-plugin.html#tasks-publishplugin" id="70af0fb9_52" data-tooltip="Publishes plugin to the remote JetBrains Marketplace repository."  ><code class="code " id="70af0fb9_53"  >publishPlugin</code></a> task when <a href="tools-gradle-intellij-plugin.html#signplugin-task-certificatechain" id="70af0fb9_54" data-tooltip="A string containing X509 certificates. The first certificate from the chain will be used as a certificate authority (CA). Refers to cert CLI option."  ><code class="code " id="70af0fb9_55"  >signPlugin.certificateChain</code></a> and <a href="tools-gradle-intellij-plugin.html#signplugin-task-privatekey" id="70af0fb9_56" data-tooltip="Encoded private key in PEM format. Refers to key CLI option."  ><code class="code " id="70af0fb9_57"  >signPlugin.privateKey</code></a> signing properties are specified. Otherwise, it'll be skipped.</p><p id="70af0fb9_58" >An example <a href="tools-gradle-intellij-plugin.html#tasks-signplugin" id="70af0fb9_59" data-tooltip="Signs the ZIP archive with the provided key using marketplace-zip-signer library."  ><code class="code " id="70af0fb9_60"  >signPlugin</code></a> task configuration may look like:</p><div class="tabs" id="70af0fb9_61"data-group="languages"><div class="tabs__content" data-gtm="tab" id="70af0fb9_62" data-sync-tabs="kotlin"  data-title="Kotlin" ><div class="code-block" data-lang="kotlin"    data-title="Kotlin"     >
signPlugin {
  certificateChain.set(&quot;&quot;&quot;
    -----BEGIN CERTIFICATE-----
    MIIElgCCAn4CCQDo83LWYj2QSTANBgkqhkiG9w0BAQsFADANMQswCQYDVQQGEwJQ
    ...
    gdZzxCN8t1EmH8kD2Yve6YKGFCRAIIzveEg=
    -----END CERTIFICATE-----
  &quot;&quot;&quot;.trimIndent())

  privateKey.set(&quot;&quot;&quot;
    -----BEGIN RSA PRIVATE KEY-----
    MIIJKgIBAAKCAgEAwU8awS22Rw902BmwVDDBMlTREX440BAAVM40NW3E0lJ7YTJG
    ...
    EnNBfIVFhh6khisKqTBWSEo5iS2RYJcuZs961riCn1LARztiaXL4l17oW8t+Qw==
    -----END RSA PRIVATE KEY-----
  &quot;&quot;&quot;.trimIndent())

  password.set(&quot;8awS22%#3(4wVDDBMlTREX&quot;)
}

publishPlugin {
  token.set(&quot;perm:a961riC....l17oW8t+Qw==&quot;)
}
</div></div><div class="tabs__content" data-gtm="tab" id="70af0fb9_64" data-sync-tabs="groovy"  data-title="Groovy" ><div class="code-block" data-lang="groovy"    data-title="Groovy"     >
signPlugin {
  certificateChain = &quot;&quot;&quot;
    -----BEGIN CERTIFICATE-----
    MIIElgCCAn4CCQDo83LWYj2QSTANBgkqhkiG9w0BAQsFADANMQswCQYDVQQGEwJQ
    ...
    gdZzxCN8t1EmH8kD2Yve6YKGFCRAIIzveEg=
    -----END CERTIFICATE-----
  &quot;&quot;&quot;.stripIndent()

  privateKey = &quot;&quot;&quot;
    -----BEGIN RSA PRIVATE KEY-----
    MIIJKgIBAAKCAgEAwU8awS22Rw902BmwVDDBMlTREX440BAAVM40NW3E0lJ7YTJG
    ...
    EnNBfIVFhh6khisKqTBWSEo5iS2RYJcuZs961riCn1LARztiaXL4l17oW8t+Qw==
    -----END RSA PRIVATE KEY-----
  &quot;&quot;&quot;.stripIndent()

  password = &quot;8awS22%#3(4wVDDBMlTREX&quot;
}

publishPlugin {
  token = &quot;perm:a961riC....l17oW8t+Qw==&quot;
}
</div></div></div><aside data-type="tip" class="prompt" data-title="" id="70af0fb9_66" ><p id="70af0fb9_67" >Do not commit your credentials to the Version Control System! To avoid that, you may use environment variables, like:</p><div class="code-block" data-lang="none"         >
token.set(System.getenv(&quot;PUBLISH_TOKEN&quot;))
</div></aside></section><section class="chapter"  ><h3 id="provide-secrets-to-ide" data-toc="provide-secrets-to-ide"  >Provide Secrets to IDE</h3><p id="70af0fb9_69" >To avoid storing hard-coded values in the project configuration, the most suitable method for local development would be using environment variables provided within the <span class="emphasis" id="70af0fb9_70" >Run/Debug Configuration</span>.</p><p id="70af0fb9_71" >To specify secrets like <code class="code " id="70af0fb9_72"  >PUBLISH_TOKEN</code> and values required for the <a href="tools-gradle-intellij-plugin.html#tasks-signplugin" id="70af0fb9_73" data-tooltip="Signs the ZIP archive with the provided key using marketplace-zip-signer library."  ><code class="code " id="70af0fb9_74"  >signPlugin</code></a> task, modify your Gradle configuration as follows:</p><div class="tabs" id="70af0fb9_75"data-group="languages"><div class="tabs__content" data-gtm="tab" id="70af0fb9_76" data-sync-tabs="kotlin"  data-title="Kotlin" ><div class="code-block" data-lang="kotlin"    data-title="Kotlin"     >
signPlugin {
  certificateChain.set(System.getenv(&quot;CERTIFICATE_CHAIN&quot;))
  privateKey.set(System.getenv(&quot;PRIVATE_KEY&quot;))
  password.set(System.getenv(&quot;PRIVATE_KEY_PASSWORD&quot;))
}

publishPlugin {
  token.set(System.getenv(&quot;PUBLISH_TOKEN&quot;))
}
</div></div><div class="tabs__content" data-gtm="tab" id="70af0fb9_78" data-sync-tabs="groovy"  data-title="Groovy" ><div class="code-block" data-lang="groovy"    data-title="Groovy"     >
signPlugin {
  certificateChain = System.getenv(&quot;CERTIFICATE_CHAIN&quot;)
  privateKey = System.getenv(&quot;PRIVATE_KEY&quot;)
  password = System.getenv(&quot;PRIVATE_KEY_PASSWORD&quot;)
}

publishPlugin {
  token = System.getenv(&quot;PUBLISH_TOKEN&quot;)
}
</div></div></div><p id="70af0fb9_80" >In the <span class="control" id="70af0fb9_81" >Run/Debug Configuration</span> for <a href="tools-gradle-intellij-plugin.html#tasks-publishplugin" id="70af0fb9_82" data-tooltip="Publishes plugin to the remote JetBrains Marketplace repository."  ><code class="code " id="70af0fb9_83"  >publishPlugin</code></a> Gradle task, provide <span class="control" id="70af0fb9_84" >Environment Variables</span> using relevant environment variable names:</p><figure  id="70af0fb9_85"><img alt="Run/Debug Configuration Environment Variables" title="Run/Debug Configuration Environment Variables" src="images/plugin_singing_env_variables.png"  class="" width="2280" height="1578"/></figure></section><section class="chapter"  ><h3 id="cli-tool" data-toc="cli-tool"  >CLI Tool</h3><p id="70af0fb9_86" >CLI tool is required if you don't rely on the Gradle IntelliJ Plugin – i.e. when working with Themes.</p><p id="70af0fb9_87" >To get the latest Marketplace ZIP Signer CLI Tool, visit the <a href="https://github.com/JetBrains/marketplace-zip-signer/releases" id="70af0fb9_88"   data-external="true" rel="noopener noreferrer" >JetBrains/marketplace-zip-signer</a> GitHub Releases page. After downloading the <span class="filepath" id="70af0fb9_89" >marketplace-zip-signer-cli.jar</span>, execute it as below:</p><div class="code-block" data-lang="bash"         >
java -jar marketplace-zip-signer-cli.jar sign\
  -in &quot;unsigned.zip&quot;\
  -out &quot;signed.zip&quot;\
  -cert-file &quot;/path/to/chain.crt&quot;\
  -key-file &quot;/path/to/private.pem&quot;\
  -key-pass &quot;PRIVATE_KEY_PASSWORD&quot;
</div></section></section><section class="chapter"  ><h2 id="signing-for-custom-repositories" data-toc="signing-for-custom-repositories"  >Signing for Custom Repositories</h2><p id="70af0fb9_91" >Signing plugins hosted on a custom repository can be accomplished for added trust between the repository and installation. However, unlike Marketplace, the custom repository will not re-sign the plugin with the JetBrains key. Instead, a trusted private CA or self-signed certificate can be used to sign and validate plugins.</p><section class="chapter"  ><h3 id="verification" data-toc="verification"  >Verification</h3><p id="70af0fb9_92" >Before looking at how we can sign a plugin, let's first review how verification works when a non-JetBrains certificate is used. As of 2021.2, during verification, IntelliJ-based IDEs check if the plugin was signed by the JetBrains CA certificate or any public key provided by the user via . In 2021.2.1, a system property has been added: <code class="code " id="70af0fb9_94"  >intellij.plugins.truststore</code>, pointing to a trusted JKS TrustStore. During verification, the plugin's public key is extracted from the signature. The last certificate entry in the chain matched against the certificates stored in one of the storages from above.</p></section><section class="chapter"  ><h3 id="using-a-trusted-internal-ca" data-toc="using-a-trusted-internal-ca"  >Using a Trusted Internal CA</h3><p id="70af0fb9_95" >If an internal CA is available, you can use this to generate certificates for signing. When choosing this route, the certificate chain includes the root CA public key at the end of the chain.</p><p id="70af0fb9_96" >With this approach, existing internal TrustStores may exist and could be used. Be sure when choosing a TrustStore that the CAs are limited to the internal CAs you trust. Using a TrustStore with public CAs can expose the users to an attack vector.</p><p id="70af0fb9_97" >If adding a TrustStore to a users environment is not possible, the user may also add the root CAs public key to .</p></section><section class="chapter"  ><h3 id="using-self-signed-certificates" data-toc="using-self-signed-certificates"  >Using Self-Signed Certificates</h3><p id="70af0fb9_99" >Using a self-signed certificate is an option if no internal CAs exist. To generate the key and public key, see: <a href="#generate-private-key" id="70af0fb9_100" data-tooltip="To generate an RSA private.pem private key, run the openssl genpkey command in the terminal, as below:"  >Generate Private Key</a></p><p id="70af0fb9_101" >If providing users with a TrustStore, you can generate one with the public key using <code class="code " id="70af0fb9_102"  >keytool</code>:</p><div class="code-block" data-lang="bash"         >
keytool -import -alias IdeaPlugin -file chain.crt -keystore pluginKeystore.jks -storepass changeit
</div><p id="70af0fb9_104" >(note: the TrustStore password must remain <code class="code " id="70af0fb9_105"  >changeit</code>)</p><p id="70af0fb9_106" >Otherwise, users may add the public key manually to .</p></section></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="kotlin.html">Kotlin for Plugin Developers</a>   <a class="navigation-links__next" href="faq.html">Plugin Development FAQ</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>