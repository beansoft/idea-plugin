<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:42.0538277"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Documents | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"how-do-i-get-a-document","level":0,"title":"How do I get a Document?","anchor":"#how-do-i-get-a-document"},{"id":"what-can-i-do-with-a-document","level":0,"title":"What can I do with a Document?","anchor":"#what-can-i-do-with-a-document"},{"id":"where-does-a-document-come-from","level":0,"title":"Where does a Document come from?","anchor":"#where-does-a-document-come-from"},{"id":"how-long-does-a-document-persist","level":0,"title":"How long does a Document persist?","anchor":"#how-long-does-a-document-persist"},{"id":"how-do-i-create-a-document","level":0,"title":"How do I create a Document?","anchor":"#how-do-i-create-a-document"},{"id":"how-do-i-get-notified-when-documents-change","level":0,"title":"How do I get notified when Documents change?","anchor":"#how-do-i-get-notified-when-documents-change"},{"id":"what-are-the-rules-of-working-with-documents","level":0,"title":"What are the rules of working with Documents?","anchor":"#what-are-the-rules-of-working-with-documents"},{"id":"are-there-any-utilities-available-for-working-with-documents","level":0,"title":"Are there any utilities available for working with Documents?","anchor":"#are-there-any-utilities-available-for-working-with-documents"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Documents | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/documents.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Documents | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/documents.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/documents.html", "name": "Documents | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="documents.md" data-main-title="Documents" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/architectural_overview/documents.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="documents.md" id="documents.md"  >Documents</h1><p id="20deddfc_1" >A <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/editor/Document.java" id="20deddfc_2"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_3"  >Document</code></a> is an editable sequence of Unicode characters, typically corresponding to the text contents of a <a href="virtual-file.html" id="20deddfc_4" data-tooltip="A VirtualFile (VF) is the IntelliJ Platform's representation of a file in a Virtual File System (VFS)."  >virtual file</a>.</p><p id="20deddfc_5" >Line breaks in a document are <span class="emphasis" id="20deddfc_6" >always</span> normalized to <code class="code " id="20deddfc_7"  >\n</code>. The IntelliJ Platform handles encoding and line break conversions when loading and saving documents transparently.</p><section class="chapter"  ><h2 id="how-do-i-get-a-document" data-toc="how-do-i-get-a-document"  >How do I get a Document?</h2><div class="table-wrapper" ><table class=" wide" id="20deddfc_8"  ><thead><tr class=" ijRowHead" id="20deddfc_9" ><th id="20deddfc_10"    ><p>Context</p></th><th id="20deddfc_11"    ><p>API</p></th></tr></thead><tbody ><tr class="" id="20deddfc_12" ><td id="20deddfc_13"    ><p><a href="basic-action-system.html" id="20deddfc_14" data-tooltip="The actions system allows plugins to add their items to IntelliJ Platform-based IDE menus and toolbars. For example, one of the action classes is responsible for the File | Open File... menu item and the Open... toolbar button."  >Action</a></p></td><td id="20deddfc_15"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/actionSystem/AnActionEvent.java" id="20deddfc_16"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_17"  >AnActionEvent.getData(CommonDataKeys.EDITOR).getDocument()</code></a></p></td></tr><tr class="" id="20deddfc_18" ><td id="20deddfc_19"    ><p><a href="psi-files.html" id="20deddfc_20" data-tooltip="A PSI (Program Structure Interface) file is the root of a structure representing a file's contents as a hierarchy of elements in a particular programming language."  >PSI File</a></p></td><td id="20deddfc_21"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiDocumentManager.java" id="20deddfc_22"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_23"  >PsiDocumentManager.getDocument()</code>/<code class="code " id="20deddfc_24"  >getCachedDocument()</code></a></p></td></tr><tr class="" id="20deddfc_25" ><td id="20deddfc_26"    ><p><a href="virtual-file.html" id="20deddfc_27" data-tooltip="A VirtualFile (VF) is the IntelliJ Platform's representation of a file in a Virtual File System (VFS)."  >Virtual File</a></p></td><td id="20deddfc_28"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/fileEditor/FileDocumentManager.java" id="20deddfc_29"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_30"  >FileDocumentManager.getDocument()</code></a> (forces the document content to be loaded from a disk if it wasn't loaded previously) </p><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/fileEditor/FileDocumentManager.java" id="20deddfc_32"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_33"  >FileDocumentManager.getCachedDocument()</code></a> (use if only open or possibly modified documents are relevant)</p></td></tr></tbody ></table ></div></section><section class="chapter"  ><h2 id="what-can-i-do-with-a-document" data-toc="what-can-i-do-with-a-document"  >What can I do with a Document?</h2><p id="20deddfc_34" >You may perform any operations that access or modify the file contents on the &quot;plain text&quot; level (as a sequence of characters, not as a tree of <a href="psi.html" id="20deddfc_35" data-tooltip="The Program Structure Interface, commonly referred to as just PSI, is the layer in the IntelliJ Platform responsible for parsing files and creating the syntactic and semantic code model that powers so many of the platform's features."  >Program Structure Interface (PSI)</a> elements).</p></section><section class="chapter"  ><h2 id="where-does-a-document-come-from" data-toc="where-does-a-document-come-from"  >Where does a Document come from?</h2><p id="20deddfc_36" >Document instances are created when some operation needs to access the text contents of a file (in particular, this is necessary to build the PSI for a file). Also, document instances not linked to any virtual files can be created temporarily, for example, representing the contents of a text editor field in a dialog.</p></section><section class="chapter"  ><h2 id="how-long-does-a-document-persist" data-toc="how-long-does-a-document-persist"  >How long does a Document persist?</h2><p id="20deddfc_37" >Document instances are weakly referenced from <code class="code " id="20deddfc_38"  >VirtualFile</code> instances. Thus, an unmodified <code class="code " id="20deddfc_39"  >Document</code> instance can be garbage-collected if no one references it, and a new instance is created if the document contents are reaccessed later.</p><aside data-type="tip" class="prompt" data-title="" id="20deddfc_40" ><p id="20deddfc_41" >Storing <code class="code " id="20deddfc_42"  >Document</code> references in long-term data structures of a plugin will cause memory leaks.</p></aside></section><section class="chapter"  ><h2 id="how-do-i-create-a-document" data-toc="how-do-i-create-a-document"  >How do I create a Document?</h2><p id="20deddfc_43" >For creating a new file on disk, please do not create a <code class="code " id="20deddfc_44"  >Document</code> but a PSI file and get its <code class="code " id="20deddfc_45"  >Document</code> (see <a href="psi-files.html#how-do-i-create-a-psi-file" id="20deddfc_46" data-tooltip="The PsiFileFactory createFileFromText() method creates an in-memory PSI file with the specified contents."  >How do I create a PSI file?</a>). To create a <code class="code " id="20deddfc_47"  >Document</code> instance that isn't bound to anything, use <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/editor/EditorFactory.java" id="20deddfc_48"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_49"  >EditorFactory.createDocument()</code></a>.</p></section><section class="chapter"  ><h2 id="how-do-i-get-notified-when-documents-change" data-toc="how-do-i-get-notified-when-documents-change"  >How do I get notified when Documents change?</h2><ul class="list _ul" id="20deddfc_50"    ><li class="list__item" id="20deddfc_51" ><p><code class="code " id="20deddfc_52"  >Document.addDocumentListener()</code> allows receiving notifications about changes in a particular <code class="code " id="20deddfc_53"  >Document</code> instance.</p></li><li class="list__item" id="20deddfc_54" ><p><code class="code " id="20deddfc_55"  >EditorFactory.getEventMulticaster().addDocumentListener()</code> allows receiving notifications about changes in all open documents.</p></li><li class="list__item" id="20deddfc_56" ><p>Register <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/fileEditor/FileDocumentManagerListener.java" id="20deddfc_57"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_58"  >FileDocumentManagerListener</code></a> <a href="plugin-listeners.html" id="20deddfc_59" data-tooltip="Listeners allow subscription to application and project events."  >listener</a> or subscribe to <code class="code " id="20deddfc_60"  >AppTopics.FILE_DOCUMENT_SYNC</code> on any level bus to receive notifications when a <code class="code " id="20deddfc_61"  >Document</code> is saved or reloaded from disk.</p></li></ul></section><section class="chapter"  ><h2 id="what-are-the-rules-of-working-with-documents" data-toc="what-are-the-rules-of-working-with-documents"  >What are the rules of working with Documents?</h2><p id="20deddfc_62" >The general read/write action rules are in effect (see <a href="general-threading-rules.html" id="20deddfc_63" data-tooltip="Thread Access Info 插件在调试器中可视化显示读/写锁访问以及线程信息."  >通用线程规则</a>). Besides, any operations which modify the contents of the document must be wrapped in a command (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/command/CommandProcessor.java" id="20deddfc_64"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_65"  >CommandProcessor.executeCommand()</code></a>). <code class="code " id="20deddfc_66"  >executeCommand()</code> calls can be nested, and the outermost <code class="code " id="20deddfc_67"  >executeCommand()</code> call is added to the undo stack. If multiple documents are modified within a command, undoing this command will, by default, show a confirmation dialog to the user.</p><p id="20deddfc_68" >If the file corresponding to a <code class="code " id="20deddfc_69"  >Document</code> is read-only (for example, not checked out from the version control system), document modifications will fail. Thus, before modifying the <code class="code " id="20deddfc_70"  >Document</code>, it is necessary to call <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/vfs/ReadonlyStatusHandler.java" id="20deddfc_71"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_72"  >ReadonlyStatusHandler.ensureFilesWritable()</code></a> to check out the file.</p><p id="20deddfc_73" >All text strings passed to <code class="code " id="20deddfc_74"  >Document</code> modification methods (<code class="code " id="20deddfc_75"  >setText()</code>, <code class="code " id="20deddfc_76"  >insertString()</code>, <code class="code " id="20deddfc_77"  >replaceString()</code>) must use only <code class="code " id="20deddfc_78"  >\n</code> as line separators.</p><p id="20deddfc_79" >See also <a href="working-with-text.html#safely-replacing-selected-text-in-the-document" id="20deddfc_80" data-tooltip="Based on the evaluation of conditions by EditorIllustrationAction.update(), the EditorIllustrationAction action menu item is visible. To make the menu item do something, the EditorIllustrationAction class must override the AnAction.actionPerformed() method. As explained below, this…"  >Working with Text</a> in Editors Basics tutorial.</p></section><section class="chapter"  ><h2 id="are-there-any-utilities-available-for-working-with-documents" data-toc="are-there-any-utilities-available-for-working-with-documents"  >Are there any utilities available for working with Documents?</h2><p id="20deddfc_81" ><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-impl/src/com/intellij/util/DocumentUtil.java" id="20deddfc_82"   data-external="true" rel="noopener noreferrer" ><code class="code " id="20deddfc_83"  >DocumentUtil</code></a> contains utility methods for <code class="code " id="20deddfc_84"  >Document</code> processing. This allows you to get information like the text offsets of particular lines. This is particularly useful when you need text location/offset information about a given <code class="code " id="20deddfc_85"  >PsiElement</code>.</p></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="virtual-file.html">Virtual Files</a>   <a class="navigation-links__next" href="editors.html">Editors</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>