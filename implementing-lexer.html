<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.1701282"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Implementing Lexer | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"lexer-state","level":0,"title":"Lexer State","anchor":"#lexer-state"},{"id":"lexer-implementation","level":0,"title":"Lexer Implementation","anchor":"#lexer-implementation"},{"id":"token-types","level":0,"title":"Token Types","anchor":"#token-types"},{"id":"embedded-language","level":0,"title":"Embedded Language","anchor":"#embedded-language"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Implementing Lexer | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/implementing-lexer.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Implementing Lexer | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/implementing-lexer.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/implementing-lexer.html", "name": "Implementing Lexer | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="implementing_lexer.md" data-main-title="Implementing Lexer" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages///custom_language_support.md|Custom Language Support"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/custom_language_support/implementing_lexer.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="implementing_lexer.md" id="implementing_lexer.md"  >Implementing Lexer</h1><p id="a18cf9fc_1" ></p><p id="a18cf9fc_3" >The lexer, or <a href="https://en.wikipedia.org/wiki/Lexical_analysis" id="a18cf9fc_4"   data-external="true" rel="noopener noreferrer" >lexical analyzer</a>, defines how a file's contents are broken into tokens. The lexer serves as a foundation for nearly all features of custom language plugins, from basic syntax highlighting to advanced code analysis features.</p><p id="a18cf9fc_5" >The API for the lexer is defined by the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lexer/Lexer.java" id="a18cf9fc_6"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_7"  >Lexer</code></a> interface.</p><p id="a18cf9fc_8" >The IDE invokes the lexer in three main contexts, and the plugin can provide different lexer implementations if needed:</p><ul class="list _ul" id="a18cf9fc_9"    ><li class="list__item" id="a18cf9fc_10" ><p id="a18cf9fc_11" ><a href="syntax-highlighting-and-error-highlighting.html#lexer" id="a18cf9fc_12" data-tooltip="The first syntax highlighting level is based on the lexer output and is provided through the SyntaxHighlighter interface. The syntax highlighter returns the TextAttributesKey instances for each token type, which needs special highlighting. For highlighting lexer errors, the standard…"  >Syntax highlighting</a>: The lexer is returned from the implementation of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/editor-ui-api/src/com/intellij/openapi/fileTypes/SyntaxHighlighterFactory.java" id="a18cf9fc_13"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_14"  >SyntaxHighlighterFactory</code></a> interface which is registered in the <code class="code " id="a18cf9fc_15"  >com.intellij.lang.syntaxHighlighterFactory</code> extension point.</p></li><li class="list__item" id="a18cf9fc_16" ><p id="a18cf9fc_17" ><a href="grammar-and-parser.html" id="a18cf9fc_18" data-tooltip="Reference: ,"  >Building the syntax tree of a file</a>: the lexer is expected to be returned from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lang/ParserDefinition.java" id="a18cf9fc_19"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_20"  >ParserDefinition.createLexer()</code></a> implementation registered in the <code class="code " id="a18cf9fc_21"  >com.intellij.lang.parserDefinition</code> extension point.</p></li><li class="list__item" id="a18cf9fc_22" ><p id="a18cf9fc_23" >Building the index of the words contained in the file: if the lexer-based words scanner implementation is used, the lexer is passed to the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/indexing-api/src/com/intellij/lang/cacheBuilder/DefaultWordsScanner.java" id="a18cf9fc_24"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_25"  >DefaultWordsScanner</code></a> constructor. See also <a href="find-usages.html" id="a18cf9fc_26" data-tooltip="The Find Usages action is a multi-step process, and each step of the process requires involvement from the custom language plugin."  >Find Usages</a>.</p></li></ul><p id="a18cf9fc_27" >The lexer used for syntax highlighting can be invoked incrementally to process only the file's changed part. In contrast, lexers used in other contexts are always called to process an entire file or a complete language construction embedded in a different language file.</p><section class="chapter"  ><h2 id="lexer-state" data-toc="lexer-state"  >Lexer State</h2><p id="a18cf9fc_28" >A lexer that can be used incrementally may need to return its <span class="emphasis" id="a18cf9fc_29" >state</span>, which means the context corresponding to each position in a file. For example, a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/java/java-psi-impl/src/com/intellij/lang/java/lexer/JavaLexer.java" id="a18cf9fc_30"   data-external="true" rel="noopener noreferrer" >Java lexer</a> could have separate states for top-level context, comment context, and string literal context.</p><p id="a18cf9fc_31" >An essential requirement for a syntax highlighting lexer is that its state must be represented by a single integer number returned from <code class="code " id="a18cf9fc_32"  >Lexer.getState()</code>. That state will be passed to the <code class="code " id="a18cf9fc_33"  >Lexer.start()</code> method, along with the start offset of the fragment to process, when lexing is resumed from the middle of a file. Lexers used in other contexts can always return <code class="code " id="a18cf9fc_34"  >0</code> from <code class="code " id="a18cf9fc_35"  >getState()</code>.</p></section><section class="chapter"  ><h2 id="lexer-implementation" data-toc="lexer-implementation"  >Lexer Implementation</h2><p id="a18cf9fc_36" >The easiest way to create a lexer for a custom language plugin is to use <a href="https://jflex.de" id="a18cf9fc_37"   data-external="true" rel="noopener noreferrer" >JFlex</a>.</p><p id="a18cf9fc_38" >Classes <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lexer/FlexLexer.java" id="a18cf9fc_39"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_40"  >FlexLexer</code></a> and <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/lexer/FlexAdapter.java" id="a18cf9fc_41"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_42"  >FlexAdapter</code></a> adapt JFlex lexers to the IntelliJ Platform Lexer API. A <a href="https://github.com/JetBrains/intellij-deps-jflex" id="a18cf9fc_43"   data-external="true" rel="noopener noreferrer" >patched version of JFlex</a> can be used with the lexer skeleton file <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/tools/lexer/idea-flex.skeleton" id="a18cf9fc_44"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_45"  >idea-flex.skeleton</code></a> located in the <a href="https://github.com/JetBrains/intellij-community" id="a18cf9fc_46"   data-external="true" rel="noopener noreferrer" >IntelliJ IDEA Community Edition</a> source to create lexers compatible with <code class="code " id="a18cf9fc_47"  >FlexAdapter</code>. The patched version of JFlex provides a new command-line option <code class="code " id="a18cf9fc_48"  >--charat</code> that changes the JFlex generated code to work with the IntelliJ Platform skeleton. Enabling <code class="code " id="a18cf9fc_49"  >--charat</code> option passes the source data for lexing as a <code class="code " id="a18cf9fc_50"  >java.lang.CharSequence</code> and not as an array of characters.</p><p id="a18cf9fc_51" >For developing lexers using JFlex, the <a href="https://plugins.jetbrains.com/plugin/6606-grammar-kit" id="a18cf9fc_52"   data-external="true" rel="noopener noreferrer" >Grammar-Kit plugin</a> can be useful. It provides syntax highlighting and other useful features for editing JFlex files (<span class="filepath" id="a18cf9fc_53" >*.flex</span>).</p><aside data-type="tip" class="prompt" data-title="" id="a18cf9fc_54" ><p id="a18cf9fc_55" >Lexers, and in particular JFlex-based lexers, need to be created so that they always match the entire contents of the file, without any gaps between tokens, and generate special tokens for characters which are not valid at their location. Lexers must never abort prematurely because of an invalid character.</p></aside><p id="a18cf9fc_56" ><span class="control" id="a18cf9fc_57" >Examples</span>:</p><ul class="list _ul" id="a18cf9fc_58"    ><li class="list__item" id="a18cf9fc_59" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties/src/com/intellij/lang/properties/parsing/Properties.flex" id="a18cf9fc_60"   data-external="true" rel="noopener noreferrer" >JFlex</a> definition file for <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties" id="a18cf9fc_61"   data-external="true" rel="noopener noreferrer" >Properties language plugin</a></p></li><li class="list__item" id="a18cf9fc_62" ><p><a href="lexer-and-parser-definition.html" id="a18cf9fc_63" data-tooltip="Reference:"  >Custom Language Support Tutorial: Lexer</a></p></li></ul></section><section class="chapter"  ><h2 id="token-types" data-toc="token-types"  >Token Types</h2><p id="a18cf9fc_64" >Types of tokens for lexers are defined by instances of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/IElementType.java" id="a18cf9fc_65"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_66"  >IElementType</code></a>. Many token types common for all languages are defined in the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/TokenType.java" id="a18cf9fc_67"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_68"  >TokenType</code></a> interface. Custom language plugins should reuse these token types wherever applicable. For all other token types, the plugin needs to create new <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/IElementType.java" id="a18cf9fc_69"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_70"  >IElementType</code></a> instances and associate with the language in which the token type is used. The same <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/IElementType.java" id="a18cf9fc_71"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_72"  >IElementType</code></a> instance should be returned every time a particular token type is encountered by the lexer.</p><p id="a18cf9fc_73" ><span class="control" id="a18cf9fc_74" >Example:</span> <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties/properties-psi-api/src/com/intellij/lang/properties/parsing/PropertiesTokenTypes.java" id="a18cf9fc_75"   data-external="true" rel="noopener noreferrer" >Token types</a> for <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/properties" id="a18cf9fc_76"   data-external="true" rel="noopener noreferrer" >Properties language plugin</a></p><p id="a18cf9fc_77" >Groups of related types (e.g., keywords) can be defined using <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/TokenSet.java" id="a18cf9fc_78"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_79"  >TokenSet</code></a>. All <code class="code " id="a18cf9fc_80"  >TokenSet</code> for a language should be grouped in a dedicated <code class="code " id="a18cf9fc_81"  >$Language$TokenSets</code> class for re-use.</p><p id="a18cf9fc_82" ><span class="control" id="a18cf9fc_83" >Example:</span> <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/groovy/groovy-psi/src/org/jetbrains/plugins/groovy/lang/psi/GroovyTokenSets.java" id="a18cf9fc_84"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_85"  >GroovyTokenSets</code></a></p></section><section class="chapter"  ><h2 id="embedded-language" data-toc="embedded-language"  >Embedded Language</h2><p id="a18cf9fc_86" >An important feature that can be implemented at the lexer level is mixing languages within a file, such as embedding fragments of Java code in some template language. Suppose a language supports embedding its fragments in another language. In that case, it needs to define the chameleon token types for different types of fragments that can be embedded, and these token types need to implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/ILazyParseableElementType.java" id="a18cf9fc_87"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_88"  >ILazyParseableElementType</code></a> interface. The enclosing language's lexer needs to return the entire fragment of the embedded language as a single chameleon token, of the type defined by the embedded language. To parse the contents of the chameleon token, the IDE will call the parser of the embedded language through a call to <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/tree/ILazyParseableElementType.java" id="a18cf9fc_89"   data-external="true" rel="noopener noreferrer" ><code class="code " id="a18cf9fc_90"  >ILazyParseableElementType.parseContents()</code></a>.</p></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="registering-file-type.html">Registering a File Type</a>   <a class="navigation-links__next" href="implementing-parser-and-psi.html">Implementing Parser and PSI</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>