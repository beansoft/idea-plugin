<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:42.669966"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Persisting State of Components | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"using-persistentstatecomponent","level":0,"title":"Using PersistentStateComponent","anchor":"#using-persistentstatecomponent"},{"id":"using-propertiescomponent-for-simple-non-roamable-persistence","level":0,"title":"Using PropertiesComponent for Simple Non-Roamable Persistence","anchor":"#using-propertiescomponent-for-simple-non-roamable-persistence"},{"id":"legacy-api-jdomexternalizable","level":0,"title":"Legacy API (JDOMExternalizable)","anchor":"#legacy-api-jdomexternalizable"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Persisting State of Components | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/persisting-state-of-components.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Persisting State of Components | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/persisting-state-of-components.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/persisting-state-of-components.html", "name": "Persisting State of Components | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="persisting_state_of_components.md" data-main-title="Persisting State of Components" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///persistence.md|Persistence"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/persisting_state_of_components.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="persisting_state_of_components.md" id="persisting_state_of_components.md"  >Persisting State of Components</h1><p id="94a2a8ab_1" >The IntelliJ Platform provides an API that allows components or services to persist their state between restarts of the IDE. You can use either a simple API to persist a few values or persist the state of more complicated components using the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/components/PersistentStateComponent.java" id="94a2a8ab_2"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_3"  >PersistentStateComponent</code></a> interface.</p><aside data-type="tip" class="prompt" data-title="" id="94a2a8ab_4" ><p id="94a2a8ab_5" >If you need to persist sensitive data like passwords, please see <a href="persisting-sensitive-data.html" id="94a2a8ab_6" data-tooltip="The Credentials Store API allows you to store sensitive user data securely, like passwords, server URLs, etc."  >Persisting Sensitive Data</a>.</p></aside><section class="chapter"  ><h2 id="using-persistentstatecomponent" data-toc="using-persistentstatecomponent"  >Using PersistentStateComponent</h2><p id="94a2a8ab_7" >The <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/components/PersistentStateComponent.java" id="94a2a8ab_8"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_9"  >com.intellij.openapi.components.PersistentStateComponent</code></a> interface gives you the most flexibility for defining the values to be persisted, their format, and storage location.</p><p id="94a2a8ab_10" >To use it:</p><ul class="list _ul" id="94a2a8ab_11"    ><li class="list__item" id="94a2a8ab_12" ><p>mark a <a href="plugin-services.html" id="94a2a8ab_13" data-tooltip="A service is a plugin component loaded on demand when your plugin calls the getService() method of corresponding ComponentManager instance (see Types). The IntelliJ Platform ensures that only one instance of a service is loaded even though it is called several times."  >service</a> as implementing the <code class="code " id="94a2a8ab_14"  >PersistentStateComponent</code> interface</p></li><li class="list__item" id="94a2a8ab_15" ><p>define the state class</p></li><li class="list__item" id="94a2a8ab_16" ><p>specify the storage location using <code class="code " id="94a2a8ab_17"  >@com.intellij.openapi.components.State</code></p></li></ul><p id="94a2a8ab_18" >Note that instances of extensions cannot persist their state by implementing <code class="code " id="94a2a8ab_19"  >PersistentStateComponent</code>. If your extension needs to have a persistent state, you need to define a separate service responsible for managing that state.</p><section class="chapter"  ><h3 id="implementing-the-persistentstatecomponent-interface" data-toc="implementing-the-persistentstatecomponent-interface"  >Implementing the PersistentStateComponent Interface</h3><p id="94a2a8ab_20" >The implementation of <code class="code " id="94a2a8ab_21"  >PersistentStateComponent</code> needs to be parameterized with the type of state class. The state class can either be a separate JavaBean class, or the class implementing <code class="code " id="94a2a8ab_22"  >PersistentStateComponent</code>.</p><p id="94a2a8ab_23" >In the former case, the state class instance is typically stored as a field in the <code class="code " id="94a2a8ab_24"  >PersistentStateComponent</code> class:</p><div class="code-block" data-lang="java"         >
@State(...)
class MyService implements PersistentStateComponent&lt;MyService.State&gt; {

  public static MyService getInstance() {
    // implementation according to Application/Project level service
  }

  static class State {
    public String value;
  }

  private State myState = new State();

  public State getState() {
    return myState;
  }

  public void loadState(State state) {
    myState = state;
  }
}
</div><p id="94a2a8ab_26" >In the latter case, you can use the following pattern to implement <code class="code " id="94a2a8ab_27"  >getState()</code> and <code class="code " id="94a2a8ab_28"  >loadState()</code> methods:</p><div class="code-block" data-lang="java"         >
@State(...)
class MyService implements PersistentStateComponent&lt;MyService&gt; {

  public static MyService getInstance() {
    // implementation according to Application/Project level service
  }

  public String stateValue;

  public MyService getState() {
    return this;
  }

  public void loadState(MyService state) {
    XmlSerializerUtil.copyBean(state, this);
  }
}
</div></section><section class="chapter"  ><h3 id="implementing-the-state-class" data-toc="implementing-the-state-class"  >Implementing the State Class</h3><p id="94a2a8ab_30" >The implementation of <code class="code " id="94a2a8ab_31"  >PersistentStateComponent</code> works by serializing public fields, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/xmlb/annotations" id="94a2a8ab_32"   data-external="true" rel="noopener noreferrer" >annotated</a> private fields (see also <a href="#customizing-the-xml-format-of-persisted-values" id="94a2a8ab_33" data-tooltip="Please consider using annotation parameters only to achieve backward compatibility. Otherwise, please feel free to file issues about specific serialization cosmetics."  >Customizing the XML format of persisted values</a>), and bean properties into an XML format.</p><p id="94a2a8ab_34" >To exclude a public field or bean property from serialization, annotate the field or getter with <code class="code " id="94a2a8ab_35"  >@com.intellij.util.xmlb.annotations.Transient</code>.</p><p id="94a2a8ab_36" >Note that the state class must have a default constructor. It should return the component's default state: the one used if there is nothing persisted in the XML files yet.</p><p id="94a2a8ab_37" >State class should have an <code class="code " id="94a2a8ab_38"  >equals()</code> method, but state objects are compared by fields if it is not implemented. When using Kotlin, use <a href="https://kotlinlang.org/docs/reference/data-classes.html" id="94a2a8ab_39"   data-external="true" rel="noopener noreferrer" >Data Classes</a>.</p><p id="94a2a8ab_40" >The following types of values can be persisted:</p><ul class="list _ul" id="94a2a8ab_41"    ><li class="list__item" id="94a2a8ab_42" ><p>numbers (both primitive types, such as <code class="code " id="94a2a8ab_43"  >int</code>, and boxed types, such as <code class="code " id="94a2a8ab_44"  >Integer</code>)</p></li><li class="list__item" id="94a2a8ab_45" ><p>booleans</p></li><li class="list__item" id="94a2a8ab_46" ><p>strings</p></li><li class="list__item" id="94a2a8ab_47" ><p>collections</p></li><li class="list__item" id="94a2a8ab_48" ><p>maps</p></li><li class="list__item" id="94a2a8ab_49" ><p>enums</p></li></ul><p id="94a2a8ab_50" >For other types, extend <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/xmlb/Converter.java" id="94a2a8ab_51"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_52"  >com.intellij.util.xmlb.Converter</code></a>:</p><div class="code-block" data-lang="java"         >
class LocalDateTimeConverter extends Converter&lt;LocalDateTime&gt; {
  public LocalDateTime fromString(String value) {
    long epochMilli = Long.parseLong(value);
    ZoneId zoneId = ZoneId.systemDefault();
    return Instant.ofEpochMilli(epochMilli).atZone(zoneId).toLocalDateTime();
  }

  public String toString(LocalDateTime value) {
    ZoneId zoneId = ZoneId.systemDefault();
    long toEpochMilli = value.atZone(zoneId).toInstant().toEpochMilli();
    return Long.toString(toEpochMilli);
  }
}
</div><p id="94a2a8ab_54" >Define the converter above in <code class="code " id="94a2a8ab_55"  >@com.intellij.util.xmlb.annotations.OptionTag</code> or <code class="code " id="94a2a8ab_56"  >@com.intellij.util.xmlb.annotations.Attribute</code>:</p><div class="code-block" data-lang="java"         >
class State {
  @OptionTag(converter = LocalDateTimeConverter.class)
  public LocalDateTime dateTime;
}
</div></section><section class="chapter"  ><h3 id="defining-the-storage-location" data-toc="defining-the-storage-location"  >Defining the Storage Location</h3><p id="94a2a8ab_58" >To specify where precisely the persisted values are stored, add <code class="code " id="94a2a8ab_59"  >@State</code> annotation to the <code class="code " id="94a2a8ab_60"  >PersistentStateComponent</code> class.</p><p id="94a2a8ab_61" >It has the following fields:</p><ul class="list _ul" id="94a2a8ab_62"    ><li class="list__item" id="94a2a8ab_63" ><p><code class="code " id="94a2a8ab_64"  >name</code> (required) — specifies the name of the state (name of the root tag in XML).</p></li><li class="list__item" id="94a2a8ab_65" ><p><code class="code " id="94a2a8ab_66"  >storages</code> — one or more of <code class="code " id="94a2a8ab_67"  >@com.intellij.openapi.components.Storage</code> annotations to specify the storage locations. Optional for project-level values — standard project file is used in this case.</p></li><li class="list__item" id="94a2a8ab_68" ><p><code class="code " id="94a2a8ab_69"  >reloadable</code> (optional) — if set to false, a full project (or application) reload is required when the XML file is changed externally, and the state has changed.</p></li></ul><p id="94a2a8ab_70" >The simplest ways of specifying the <code class="code " id="94a2a8ab_71"  >@Storage</code> annotation are as follows:</p><ul class="list _ul" id="94a2a8ab_72"    ><li class="list__item" id="94a2a8ab_73" ><p id="94a2a8ab_74" ><code class="code " id="94a2a8ab_75"  >@Storage(&quot;yourName.xml&quot;)</code> If a component is project-level — for <span class="filepath" id="94a2a8ab_76" >.ipr</span> based projects standard project file is used automatically - no need to specify anything.</p></li><li class="list__item" id="94a2a8ab_77" ><p id="94a2a8ab_78" ><code class="code " id="94a2a8ab_79"  >@Storage(StoragePathMacros.WORKSPACE_FILE)</code> for values stored in the workspace file.</p></li></ul><p id="94a2a8ab_80" >The state is persisted in a separate file by specifying a different setting for the <code class="code " id="94a2a8ab_81"  >value</code> parameter, which was the <code class="code " id="94a2a8ab_82"  >file</code> parameter before 2016.x.</p><p id="94a2a8ab_83" >See <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/projectModel-api/src/com/intellij/openapi/components/StoragePathMacros.java" id="94a2a8ab_84"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_85"  >StoragePathMacros</code></a> for commonly used values.</p><aside data-type="tip" class="prompt" data-title="" id="94a2a8ab_86" ><p id="94a2a8ab_87" >For application-level storage, it is strongly recommended to use a custom file, using of <span class="filepath" id="94a2a8ab_88" >other.xml</span> is deprecated.</p></aside><p id="94a2a8ab_89" >The <code class="code " id="94a2a8ab_90"  >roamingType</code> parameter of the <code class="code " id="94a2a8ab_91"  >@Storage</code> annotation specifies the roaming type when the Settings Repository plugin is used.</p></section><section class="chapter"  ><h3 id="customizing-the-xml-format-of-persisted-values" data-toc="customizing-the-xml-format-of-persisted-values"  >Customizing the XML Format of Persisted Values</h3><aside data-type="tip" class="prompt" data-title="" id="94a2a8ab_92" ><p id="94a2a8ab_93" >Please consider using annotation parameters only to achieve backward compatibility. Otherwise, please feel free to file issues about specific serialization cosmetics.</p></aside><p id="94a2a8ab_94" >If you want to use the default bean serialization but need to customize the storage format in XML (for example, for compatibility with previous versions of your plugin or externally defined XML formats), you can use the <code class="code " id="94a2a8ab_95"  >@Tag</code>, <code class="code " id="94a2a8ab_96"  >@Attribute</code>, <code class="code " id="94a2a8ab_97"  >@Property</code>, <code class="code " id="94a2a8ab_98"  >@MapAnnotation</code>, <code class="code " id="94a2a8ab_99"  >@XCollection</code> annotations.</p><p id="94a2a8ab_100" >Please see <code class="code " id="94a2a8ab_101"  >com.intellij.util.xmlb.annotations</code>'s <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/util/xmlb/annotations/package.html" id="94a2a8ab_102"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_103"  >package.html</code></a> for more information.</p><p id="94a2a8ab_104" >If the state you need to serialize doesn't map cleanly to a JavaBean, you can use <code class="code " id="94a2a8ab_105"  >org.jdom.Element</code> as the state class. In that case, you can use the <code class="code " id="94a2a8ab_106"  >getState()</code> method to build an XML element with an arbitrary structure, which then is saved directly in the state XML file. In the <code class="code " id="94a2a8ab_107"  >loadState()</code> method, you can deserialize the JDOM element tree using any custom logic. Please note this is not recommended and should be avoided whenever possible.</p></section><section class="chapter"  ><h3 id="migrating-persisted-values" data-toc="migrating-persisted-values"  >Migrating Persisted Values</h3><p id="94a2a8ab_108" >If the underlying persistence model or storage format has changed, a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-impl/src/com/intellij/conversion/ConverterProvider.java" id="94a2a8ab_109"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_110"  >ConverterProvider</code></a> can provide <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-impl/src/com/intellij/conversion/ProjectConverter.java" id="94a2a8ab_111"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_112"  >ProjectConverter</code></a> whose <code class="code " id="94a2a8ab_113"  >getAdditionalAffectedFiles()</code> method returns affected files to migrate and performs programmatic migration of stored values.</p></section><section class="chapter"  ><h3 id="persistent-component-lifecycle" data-toc="persistent-component-lifecycle"  >Persistent Component Lifecycle</h3><p id="94a2a8ab_114" >The <code class="code " id="94a2a8ab_115"  >loadState()</code> method is called after the component has been created (only if there is some non-default state persisted for the component), and after the XML file with the persisted state is changed externally (for example, if the project file was updated from the version control system). In the latter case, the component is responsible for updating the UI and other related components according to the changed state.</p><p id="94a2a8ab_116" >The <code class="code " id="94a2a8ab_117"  >getState()</code> method is called every time the settings are saved (for example, on frame deactivation or when closing the IDE). If the state returned from <code class="code " id="94a2a8ab_118"  >getState()</code> is equal to the default state (obtained by creating the state class with a default constructor), nothing is persisted in the XML. Otherwise, the returned state is serialized in XML and stored.</p></section></section><section class="chapter"  ><h2 id="using-propertiescomponent-for-simple-non-roamable-persistence" data-toc="using-propertiescomponent-for-simple-non-roamable-persistence"  >Using PropertiesComponent for Simple Non-Roamable Persistence</h2><p id="94a2a8ab_119" >If the plugin needs to persist just a few simple values, the easiest way to do so is to use the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/ide/util/PropertiesComponent.java" id="94a2a8ab_120"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_121"  >com.intellij.ide.util.PropertiesComponent</code></a> service. It can save both application-level values and project-level values in the workspace file. Roaming is disabled for <code class="code " id="94a2a8ab_122"  >PropertiesComponent</code>, so use it only for temporary, non-roamable properties.</p><p id="94a2a8ab_123" >Use the <code class="code " id="94a2a8ab_124"  >PropertiesComponent.getInstance()</code> method for storing application-level values, and the <code class="code " id="94a2a8ab_125"  >PropertiesComponent.getInstance(Project)</code> method for storing project-level values.</p><p id="94a2a8ab_126" >Since all plugins share the same namespace, it is highly recommended prefixing key names (e.g., using plugin ID <code class="code " id="94a2a8ab_127"  >com.example.myCustomSetting</code>).</p></section><section class="chapter"  ><h2 id="legacy-api-jdomexternalizable" data-toc="legacy-api-jdomexternalizable"  >Legacy API (JDOMExternalizable)</h2><p id="94a2a8ab_128" >Older components use the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/openapi/util/JDOMExternalizable.java" id="94a2a8ab_129"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_130"  >JDOMExternalizable</code></a> interface for persisting state. It uses the <code class="code " id="94a2a8ab_131"  >readExternal()</code> method for reading the state from a JDOM element, and <code class="code " id="94a2a8ab_132"  >writeExternal()</code> to write the state.</p><p id="94a2a8ab_133" >Implementations can manually store the state in attributes and sub-elements or use the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/util/src/com/intellij/openapi/util/DefaultJDOMExternalizer.java" id="94a2a8ab_134"   data-external="true" rel="noopener noreferrer" ><code class="code " id="94a2a8ab_135"  >DefaultJDOMExternalizer</code></a> class to store the values of all public fields automatically.</p><p id="94a2a8ab_136" >Components save their state in the following files:</p><ul class="list _ul" id="94a2a8ab_137"    ><li class="list__item" id="94a2a8ab_138" ><p>Project-level: project (<span class="filepath" id="94a2a8ab_139" >.ipr</span>) file. However, if the workspace option in the <span class="filepath" id="94a2a8ab_140" ><a href="plugin-configuration-file.html" id="94a2a8ab_141" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span> file is set to <code class="code " id="94a2a8ab_142"  >true</code>, then the workspace (<span class="filepath" id="94a2a8ab_143" >.iws</span>) file is used instead.</p></li><li class="list__item" id="94a2a8ab_144" ><p>Module-level: module (<span class="filepath" id="94a2a8ab_145" >.iml</span>) file.</p></li></ul></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="persistence.html">Persistence Model</a>   <a class="navigation-links__next" href="persisting-sensitive-data.html">Persisting Sensitive Data</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>