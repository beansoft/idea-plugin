<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.1261191"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>10. Reference Contributor | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"define-a-named-element-class","level":0,"title":"Define a Named Element Class","anchor":"#define-a-named-element-class"},{"id":"define-helper-methods-for-generated-psi-elements","level":0,"title":"Define Helper Methods for Generated PSI Elements","anchor":"#define-helper-methods-for-generated-psi-elements"},{"id":"define-an-element-factory","level":0,"title":"Define an Element Factory","anchor":"#define-an-element-factory"},{"id":"update-grammar-and-regenerate-the-parser","level":0,"title":"Update Grammar and Regenerate the Parser","anchor":"#update-grammar-and-regenerate-the-parser"},{"id":"define-a-reference","level":0,"title":"Define a Reference","anchor":"#define-a-reference"},{"id":"define-a-reference-contributor","level":0,"title":"Define a Reference Contributor","anchor":"#define-a-reference-contributor"},{"id":"register-the-reference-contributor","level":0,"title":"Register the Reference Contributor","anchor":"#register-the-reference-contributor"},{"id":"run-the-project-with-the-reference-contributor","level":0,"title":"Run the Project with the Reference Contributor","anchor":"#run-the-project-with-the-reference-contributor"},{"id":"define-a-refactoring-support-provider","level":0,"title":"Define a Refactoring Support Provider","anchor":"#define-a-refactoring-support-provider"},{"id":"register-the-refactoring-support-provider","level":0,"title":"Register the Refactoring Support Provider","anchor":"#register-the-refactoring-support-provider"},{"id":"run-the-project","level":0,"title":"Run the Project","anchor":"#run-the-project"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="10. Reference Contributor | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/reference-contributor.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="10. Reference Contributor | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/reference-contributor.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/reference-contributor.html", "name": "10. Reference Contributor | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="reference_contributor.md" data-main-title="10. Reference Contributor" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages///custom_language_support_tutorial.md|Custom Language Support Tutorial"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/tutorials/custom_language_support/reference_contributor.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="reference_contributor.md" id="reference_contributor.md"  >10. Reference Contributor</h1><p id="c661ee88_24" >The references functionality is one of the most important parts in the implementation of custom language support. Resolving references means the ability to go from the usage of an element to its declaration, completion, rename refactoring, find usages, etc.</p><aside data-type="tip" class="prompt" data-title="" id="c661ee88_25" ><p id="c661ee88_26" >Every PSI element that can be renamed or referenced needs to implement <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiNamedElement.java" id="c661ee88_27"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_28"  >PsiNamedElement</code></a> interface.</p></aside><section class="chapter"  ><h2 id="define-a-named-element-class" data-toc="define-a-named-element-class"  >Define a Named Element Class</h2><p id="c661ee88_29" >The classes below show how the Simple Language fulfills the need to implement <code class="code " id="c661ee88_30"  >PsiNamedElement</code>.</p><p id="c661ee88_31" >The <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/simple_language_plugin/src/main/java/org/intellij/sdk/language/psi/SimpleNamedElement.java" id="c661ee88_32"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_33"  >SimpleNamedElement</code></a> interface is subclassed from <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiNameIdentifierOwner.java" id="c661ee88_34"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_35"  >PsiNameIdentifierOwner</code></a>.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div><p id="c661ee88_37" >The <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/simple_language_plugin/src/main/java/org/intellij/sdk/language/psi/impl/SimpleNamedElementImpl.java" id="c661ee88_38"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_39"  >SimpleNamedElementImpl</code></a> class implements the <code class="code " id="c661ee88_40"  >SimpleNamedElement</code> interface and extends <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-impl/src/com/intellij/extapi/psi/ASTWrapperPsiElement.java" id="c661ee88_41"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_42"  >ASTWrapperPsiElement</code></a>.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div></section><section class="chapter"  ><h2 id="define-helper-methods-for-generated-psi-elements" data-toc="define-helper-methods-for-generated-psi-elements"  >Define Helper Methods for Generated PSI Elements</h2><p id="c661ee88_44" >Modify <code class="code " id="c661ee88_45"  >SimplePsiImplUtil</code> to support new methods that get added to the PSI class for Simple Language. Note that <code class="code " id="c661ee88_46"  >SimpleElementFactory</code> isn't defined until the <a href="#define-an-element-factory" id="c661ee88_47" data-tooltip="The SimpleElementFactory provides methods for creating SimpleFile."  >next step</a>, so for now it shows as an error.</p><div class="code-block" data-lang="java"         >
public class SimplePsiImplUtil {

  // ...

  public static String getName(SimpleProperty element) {
    return getKey(element);
  }

  public static PsiElement setName(SimpleProperty element, String newName) {
    ASTNode keyNode = element.getNode().findChildByType(SimpleTypes.KEY);
    if (keyNode != null) {
      SimpleProperty property =
          SimpleElementFactory.createProperty(element.getProject(), newName);
      ASTNode newKeyNode = property.getFirstChild().getNode();
      element.getNode().replaceChild(keyNode, newKeyNode);
    }
    return element;
  }

  public static PsiElement getNameIdentifier(SimpleProperty element) {
    ASTNode keyNode = element.getNode().findChildByType(SimpleTypes.KEY);
    return keyNode != null ? keyNode.getPsi() : null;
  }

  // ...

}
</div></section><section class="chapter"  ><h2 id="define-an-element-factory" data-toc="define-an-element-factory"  >Define an Element Factory</h2><p id="c661ee88_49" >The <code class="code " id="c661ee88_50"  >SimpleElementFactory</code> provides methods for creating <code class="code " id="c661ee88_51"  >SimpleFile</code>.</p><div class="code-block" data-lang="java"         >
package org.intellij.sdk.language.psi;

import com.intellij.openapi.project.Project;
import com.intellij.psi.*;
import org.intellij.sdk.language.SimpleFileType;

public class SimpleElementFactory {

  public static SimpleProperty createProperty(Project project, String name) {
    SimpleFile file = createFile(project, name);
    return (SimpleProperty) file.getFirstChild();
  }

  public static SimpleFile createFile(Project project, String text) {
    String name = &quot;dummy.simple&quot;;
    return (SimpleFile) PsiFileFactory.getInstance(project).
        createFileFromText(name, SimpleFileType.INSTANCE, text);
  }
}
</div></section><section class="chapter"  ><h2 id="update-grammar-and-regenerate-the-parser" data-toc="update-grammar-and-regenerate-the-parser"  >Update Grammar and Regenerate the Parser</h2><p id="c661ee88_53" >Now make corresponding changes to the <span class="filepath" id="c661ee88_54" >Simple.bnf</span> grammar file by replacing the <code class="code " id="c661ee88_55"  >property</code> definition with the lines below. Don't forget to regenerate the parser after updating the file! Right-click on the <span class="filepath" id="c661ee88_56" >Simple.bnf</span> file and select <span class="control" id="c661ee88_57" >Generate Parser Code</span>.</p><div class="code-block" data-lang="rbnf"         >
property ::= (KEY? SEPARATOR VALUE?) | KEY {
  mixin=&quot;org.intellij.sdk.language.psi.impl.SimpleNamedElementImpl&quot;
  implements=&quot;org.intellij.sdk.language.psi.SimpleNamedElement&quot;
  methods=[getKey getValue getName setName getNameIdentifier]
}
</div></section><section class="chapter"  ><h2 id="define-a-reference" data-toc="define-a-reference"  >Define a Reference</h2><p id="c661ee88_59" >Now define a reference class <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/simple_language_plugin/src/main/java/org/intellij/sdk/language/SimpleReference.java" id="c661ee88_60"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_61"  >SimpleReference.java</code></a> to resolve a property from its usage. This requires extending <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReferenceBase.java" id="c661ee88_62"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_63"  >PsiReferenceBase</code></a> and implementing <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiPolyVariantReference.java" id="c661ee88_64"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_65"  >PsiPolyVariantReference</code></a>. The latter enables the reference to resolve to more than one element or to resolve result(s) for a superset of valid resolve cases.</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div></section><section class="chapter"  ><h2 id="define-a-reference-contributor" data-toc="define-a-reference-contributor"  >Define a Reference Contributor</h2><p id="c661ee88_67" >A reference contributor allows the <code class="code " id="c661ee88_68"  >simple_language_plugin</code> to provide references to Simple Language from elements in other languages such as Java. Create <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/simple_language_plugin/src/main/java/org/intellij/sdk/language/SimpleReferenceContributor.java" id="c661ee88_69"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_70"  >SimpleReferenceContributor</code></a> by subclassing <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/psi/PsiReferenceContributor.java" id="c661ee88_71"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_72"  >PsiReferenceContributor</code></a>. Contribute a reference to each usage of a property:</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div></section><section class="chapter"  ><h2 id="register-the-reference-contributor" data-toc="register-the-reference-contributor"  >Register the Reference Contributor</h2><p id="c661ee88_74" >The <code class="code " id="c661ee88_75"  >SimpleReferenceContributor</code> implementation is registered using the <code class="code " id="c661ee88_76"  >com.intellij.psi.referenceContributor</code> extension point and specifying <code class="code " id="c661ee88_77"  >language=&quot;JAVA&quot;</code>.</p><div class="code-block" data-lang="markup"         >
&lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
  &lt;psi.referenceContributor language=&quot;JAVA&quot;
                            implementation=&quot;org.intellij.sdk.language.SimpleReferenceContributor&quot;/&gt;
&lt;/extensions&gt;
</div></section><section class="chapter"  ><h2 id="run-the-project-with-the-reference-contributor" data-toc="run-the-project-with-the-reference-contributor"  >Run the Project with the Reference Contributor</h2><p id="c661ee88_79" >Run the project by using the Gradle <a href="gradle-prerequisites.html#running-a-simple-gradle-based-intellij-platform-plugin" id="c661ee88_80" data-tooltip="Gradle projects are run from the IDE's Gradle Tool window."  ><code class="code " id="c661ee88_81"  >runIde</code></a> task.</p><p id="c661ee88_82" >The IDE now resolves the property and provides <a href="https://www.jetbrains.com/help/idea/auto-completing-code.html#basic_completion" id="c661ee88_83"   data-external="true" rel="noopener noreferrer" >completion</a> suggestions:</p><figure  id="c661ee88_84"><img alt="Reference Contributor" title="Reference Contributor" src="images/reference_contributor.png"  class="" width="800" height="323"/></figure><p id="c661ee88_85" >The <a href="https://www.jetbrains.com/help/idea/rename-refactorings.html#invoke-rename-refactoring" id="c661ee88_86"   data-external="true" rel="noopener noreferrer" >Rename refactoring</a> functionality is now available from definition and usages.</p><figure  id="c661ee88_87"><img alt="Rename" title="Rename" src="images/rename.png"  class="" width="800" height="324"/></figure></section><section class="chapter"  ><h2 id="define-a-refactoring-support-provider" data-toc="define-a-refactoring-support-provider"  >Define a Refactoring Support Provider</h2><p id="c661ee88_88" >Support for in-place refactoring is specified explicitly in a refactoring support provider. Create <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/simple_language_plugin/src/main/java/org/intellij/sdk/language/SimpleRefactoringSupportProvider.java" id="c661ee88_89"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_90"  >SimpleRefactoringSupportProvider</code></a> by subclassing <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/refactoring/src/com/intellij/lang/refactoring/RefactoringSupportProvider.java" id="c661ee88_91"   data-external="true" rel="noopener noreferrer" ><code class="code " id="c661ee88_92"  >RefactoringSupportProvider</code></a> As long as an element is a <code class="code " id="c661ee88_93"  >SimpleProperty</code> it is allowed to be refactored:</p><div class="code-block" data-lang="java"       data-disable-link-processing="true"  ></div></section><section class="chapter"  ><h2 id="register-the-refactoring-support-provider" data-toc="register-the-refactoring-support-provider"  >Register the Refactoring Support Provider</h2><p id="c661ee88_95" >The <code class="code " id="c661ee88_96"  >SimpleRefactoringSupportProvider</code> implementation is registered with the IntelliJ Platform in the plugin configuration file using the <code class="code " id="c661ee88_97"  >com.intellij.lang.refactoringSupport</code> extension point.</p><div class="code-block" data-lang="markup"         >
&lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
  &lt;lang.refactoringSupport
      language=&quot;Simple&quot;
      implementationClass=&quot;org.intellij.sdk.language.SimpleRefactoringSupportProvider&quot;/&gt;
&lt;/extensions&gt;
</div></section><section class="chapter"  ><h2 id="run-the-project" data-toc="run-the-project"  >Run the Project</h2><p id="c661ee88_99" >Run the project by using the Gradle <a href="gradle-prerequisites.html#running-a-simple-gradle-based-intellij-platform-plugin" id="c661ee88_100" data-tooltip="Gradle projects are run from the IDE's Gradle Tool window."  ><code class="code " id="c661ee88_101"  >runIde</code></a> task.</p><p id="c661ee88_102" >The IDE now supports <a href="https://www.jetbrains.com/help/idea/rename-refactorings.html" id="c661ee88_103"   data-external="true" rel="noopener noreferrer" >refactoring</a> suggestions:</p><figure  id="c661ee88_104"><img alt="In Place Rename" title="In Place Rename" src="images/in_place_rename.png"  class="" width="800" height="340"/></figure></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="completion-contributor.html">9. Completion Contributor</a>   <a class="navigation-links__next" href="find-usages-provider.html">11. Find Usages Provider</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>