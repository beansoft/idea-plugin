<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:41.5297094"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Listeners | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"defining-application-level-listeners","level":0,"title":"Defining Application-Level Listeners","anchor":"#defining-application-level-listeners"},{"id":"defining-project-level-listeners","level":0,"title":"Defining Project-Level Listeners","anchor":"#defining-project-level-listeners"},{"id":"additional-attributes","level":0,"title":"Additional Attributes","anchor":"#additional-attributes"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Listeners | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/plugin-listeners.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Listeners | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/plugin-listeners.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/plugin-listeners.html", "name": "Listeners | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="plugin_listeners.md" data-main-title="Listeners" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part I — 插件///plugin_structure.md|Plugin Structure"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/plugin_structure/plugin_listeners.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="plugin_listeners.md" id="plugin_listeners.md"  >Listeners</h1><p id="74490023_1" ></p><p id="74490023_3" ><span class="emphasis" id="74490023_4" >Listeners</span> allow plugins to declaratively subscribe to events delivered through the message bus (see <a href="messaging-infrastructure.html" id="74490023_5" data-tooltip="The purpose of this document is to introduce the messaging infrastructure available in the IntelliJ Platform to developers and plugin writers. It is intended to answer why, when and how to use it."  >Messaging infrastructure</a> for details). Listener implementations must be stateless and may not implement life-cycle (e.g., <code class="code " id="74490023_6"  >Disposable</code>).</p><p id="74490023_7" >You can define both application- and project-level listeners.</p><aside data-type="tip" class="prompt" data-title="" id="74490023_8" ><p id="74490023_9" >All available listeners/topics are listed on <a href="extension-point-list.html" id="74490023_10" data-tooltip="Overview of Extension Points and Listeners for IntelliJ Platform"  >Extension Point and Listener List</a> under <span class="emphasis" id="74490023_11" >Listeners</span> sections. Browse usages inside existing implementations of open-source IntelliJ Platform plugins via <a href="https://jb.gg/ipe" id="74490023_12"   data-external="true" rel="noopener noreferrer" >IntelliJ Platform Explorer</a>.</p></aside><p id="74490023_13" >Declarative registration of listeners allows you to achieve better performance than registering listeners from code. The advantage is because listener instances get created lazily — the first time an event is sent to the topic — and not during application startup or project opening.</p><aside data-type="tip" class="prompt" data-title="" id="74490023_14" ><p id="74490023_15" >Defining listeners in <span class="filepath" id="74490023_16" >plugin.xml</span> is supported starting with version 2019.3 of the platform.</p></aside><section class="chapter"  ><h2 id="defining-application-level-listeners" data-toc="defining-application-level-listeners"  >Defining Application-Level Listeners</h2><p id="74490023_17" >To define an application-level listener, add the <a href="plugin-configuration-file.html#idea-plugin__applicationListeners" id="74490023_18" data-tooltip="Defines the application-level listeners."  ><code class="code " id="74490023_19"  >&lt;applicationListeners&gt;</code></a> section to your <span class="filepath" id="74490023_20" ><a href="plugin-configuration-file.html" id="74490023_21" data-tooltip="Plugin configuration file contains all the information about the plugin, as well as all registered extensions, actions, listeners, etc."  >plugin.xml</a></span>:</p><div class="code-block" data-lang="markup"         >
&lt;idea-plugin&gt;
  &lt;applicationListeners&gt;
    &lt;listener
        class=&quot;myPlugin.MyListenerClass&quot;
        topic=&quot;BaseListenerInterface&quot;/&gt;
  &lt;/applicationListeners&gt;
&lt;/idea-plugin&gt;
</div><p id="74490023_23" >The <code class="code " id="74490023_24"  >topic</code> attribute specifies the listener interface corresponding to the type of events you want to receive. Usually, this is the interface used as the type parameter of the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/extensions/src/com/intellij/util/messages/Topic.java" id="74490023_25"   data-external="true" rel="noopener noreferrer" ><code class="code " id="74490023_26"  >Topic</code></a> instance for the type of events. The <code class="code " id="74490023_27"  >class</code> attribute specifies the class in your plugin that implements the listener interface and receives the events.</p><p id="74490023_28" >As a specific example, if you want to receive events about all <a href="virtual-file-system.html" id="74490023_29" data-tooltip="The Virtual File System (VFS) is a component of the IntelliJ Platform that encapsulates most of its activity for working with files represented as Virtual File."  >Virtual File System</a> changes, you need to implement the <code class="code " id="74490023_30"  >BulkFileListener</code> interface, corresponding to the topic <code class="code " id="74490023_31"  >VirtualFileManager.VFS_CHANGES</code>. To subscribe to this topic from code, you could use something like the following snippet:</p><div class="code-block" data-lang="java"         >
messageBus.connect().subscribe(VirtualFileManager.VFS_CHANGES,
    new BulkFileListener() {
        @Override
        public void after(@NotNull List&lt;? extends VFileEvent&gt; events) {
          // handle the events
        }
});
</div><p id="74490023_33" >To use declarative registration, you no longer need to reference the <code class="code " id="74490023_34"  >Topic</code> instance. Instead, you refer directly to the listener interface class:</p><div class="code-block" data-lang="markup"         >
&lt;applicationListeners&gt;
  &lt;listener
      class=&quot;myPlugin.MyVfsListener&quot;
      topic=&quot;com.intellij.openapi.vfs.newvfs.BulkFileListener&quot;/&gt;
&lt;/applicationListeners&gt;
</div><p id="74490023_36" >Then you provide the listener implementation as a top-level class:</p><div class="code-block" data-lang="java"         >
package myPlugin;

public class MyVfsListener implements BulkFileListener {
  @Override
  public void after(@NotNull List&lt;? extends VFileEvent&gt; events) {
    // handle the events
  }
}
</div></section><section class="chapter"  ><h2 id="defining-project-level-listeners" data-toc="defining-project-level-listeners"  >Defining Project-Level Listeners</h2><p id="74490023_38" ><a href="project.html" id="74490023_39" data-tooltip="The IntelliJ Platform stores the project configuration data in XML files. The list of those files depends on the chosen project format."  >Project</a>-level listeners are registered in the same way, except that the top-level tag is <a href="plugin-configuration-file.html#idea-plugin__projectListeners" id="74490023_40" data-tooltip="Defines the project-level listeners."  ><code class="code " id="74490023_41"  >&lt;projectListeners&gt;</code></a>. They can be used to listen to project-level events, for example, <a href="tool-windows.html" id="74490023_42" data-tooltip="Tool windows are child windows of the IDE used to display information. These windows generally have their own toolbars (referred to as tool window bars) along the outer edges of the main window containing one or more tool window buttons, which activate panels displayed on the left,…"  >tool window</a> operations:</p><div class="code-block" data-lang="markup"         >
&lt;idea-plugin&gt;
  &lt;projectListeners&gt;
    &lt;listener
        class=&quot;myPlugin.MyToolWindowListener&quot;
        topic=&quot;com.intellij.openapi.wm.ex.ToolWindowManagerListener&quot;/&gt;
  &lt;/projectListeners&gt;
&lt;/idea-plugin&gt;
</div><p id="74490023_44" >The class implementing the listener interface can define a one-argument constructor accepting a <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/project/Project.java" id="74490023_45"   data-external="true" rel="noopener noreferrer" ><code class="code " id="74490023_46"  >Project</code></a>, and it will receive the instance of the project for which the listener is created:</p><div class="code-block" data-lang="java"         >
package myPlugin;

public class MyToolWindowListener implements ToolWindowManagerListener {
  private final Project project;

  public MyToolwindowListener(Project project) {
    this.project = project;
  }

  @Override
  public void stateChanged(@NotNull ToolWindowManager toolWindowManager) {
    // handle the state change
  }
}
</div></section><section class="chapter"  ><h2 id="additional-attributes" data-toc="additional-attributes"  >Additional Attributes</h2><p id="74490023_48" >Registration of listeners can be restricted using the following attributes:</p><ul class="list _ul" id="74490023_49"    ><li class="list__item" id="74490023_50" ><p><code class="code " id="74490023_51"  >os</code> - allows restricting listener to given OS, e.g., <code class="code " id="74490023_52"  >os=&quot;windows&quot;</code> for Windows only (2020.1 and later)</p></li><li class="list__item" id="74490023_53" ><p><code class="code " id="74490023_54"  >activeInTestMode</code> - set to <code class="code " id="74490023_55"  >false</code> to disable listener if <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/application/Application.java" id="74490023_56"   data-external="true" rel="noopener noreferrer" ><code class="code " id="74490023_57"  >Application.isUnitTestMode()</code></a> returns <code class="code " id="74490023_58"  >true</code></p></li><li class="list__item" id="74490023_59" ><p><code class="code " id="74490023_60"  >activeInHeadlessMode</code> - set to <code class="code " id="74490023_61"  >false</code> to disable listener if <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/openapi/application/Application.java" id="74490023_62"   data-external="true" rel="noopener noreferrer" ><code class="code " id="74490023_63"  >Application.isHeadlessEnvironment()</code></a> returns <code class="code " id="74490023_64"  >true</code>. Also, covers <code class="code " id="74490023_65"  >activeInTestMode</code> as test mode implies headless mode.</p></li></ul><aside data-type="tip" class="prompt" data-title="" id="74490023_66" ><p id="74490023_67" >If declared listeners are intended to be used by other plugins depending on your plugin, consider <a href="bundling-plugin-openapi-sources.html" id="74490023_68" data-tooltip="If a plugin exposes its own API that is meant to be used by other plugins, it is worth considering bundling the plugin's API sources in the ZIP distribution."  >bundling their sources</a> in the plugin distribution.</p></aside></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="plugin-services.html">Services</a>   <a class="navigation-links__next" href="plugin-extension-points.html">Extension Points</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>