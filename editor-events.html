<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-29T19:15:57.3572333"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>3. Handling Editor Events | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"using-an-intellij-platform-editoractionhandler","level":0,"title":"Using an IntelliJ Platform EditorActionHandler","anchor":"#using-an-intellij-platform-editoractionhandler"},{"id":"creating-a-custom-typedactionhandler","level":0,"title":"Creating a Custom TypedActionHandler","anchor":"#creating-a-custom-typedactionhandler"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="3. Handling Editor Events | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/editor-events.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="3. Handling Editor Events | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/editor-events.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/editor-events.html", "name": "3. Handling Editor Events | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="editor_events.md" data-main-title="3. Handling Editor Events" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part II — Base Platform///editors.md|Editors///editor_basics.md|Editor Basics"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/tutorials/editor_basics/editor_events.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="editor_events.md" id="editor_events.md"  >3. Handling Editor Events</h1><p id="ea7a27ce_102" >The previous tutorial <a href="coordinates-system.html" id="ea7a27ce_103" data-tooltip="The previous tutorial Working with Text demonstrated how to use actions to access a caret placed in a document open in an editor. The examples replaced selected text in a document by using information about the caret."  >Editor Coordinate Systems</a> described working with caret coordinate systems in an editor window. Caret position was discussed in terms of Logical Position, Visual Position, and Offset. This tutorial introduces the Editor Action system, which handles actions activated by keystroke events in the editor. Two classes from the <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics" id="ea7a27ce_104"   data-external="true" rel="noopener noreferrer" >editor_basics</a> code sample are used to illustrate:</p><ul class="list _ul" id="ea7a27ce_105"    ><li class="list__item" id="ea7a27ce_106" ><p>Using an IntelliJ Platform <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/EditorActionHandler.java" id="ea7a27ce_107"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_108"  >EditorActionHandler</code></a> to manipulate a caret.</p></li><li class="list__item" id="ea7a27ce_109" ><p>Creating and registering a custom <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedActionHandler.java" id="ea7a27ce_110"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_111"  >TypedActionHandler</code></a> to intercept keystrokes and change the document.</p></li></ul><section class="chapter"  ><h2 id="using-an-intellij-platform-editoractionhandler" data-toc="using-an-intellij-platform-editoractionhandler"  >Using an IntelliJ Platform EditorActionHandler</h2><p id="ea7a27ce_112" >In this portion of the tutorial, the <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics" id="ea7a27ce_113"   data-external="true" rel="noopener noreferrer" >editor_basics</a> code sample is used to demonstrate cloning an existing caret. A custom action class will use <code class="code " id="ea7a27ce_114"  >EditorActionManager</code> to access a specific <code class="code " id="ea7a27ce_115"  >EditorActionHandler</code> for caret cloning. The <code class="code " id="ea7a27ce_116"  >editor_basics</code> code sample adds an <span class="control" id="ea7a27ce_117" >Editor Add Caret</span> menu item to the editor context menu:</p><figure  id="ea7a27ce_118"><img alt="Editor Basics Menu" title="Editor Basics Menu" src="images/basics.png"  class="" width="600" height="172"/></figure><section class="chapter"  ><h3 id="creating-the-menu-action-class" data-toc="creating-the-menu-action-class"  >Creating the Menu Action Class</h3><p id="ea7a27ce_119" >The source code for the Java action class is <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics/src/main/java/org/intellij/sdk/editor/EditorHandlerIllustration.java" id="ea7a27ce_120"   data-external="true" rel="noopener noreferrer" >EditorHandlerIllustration</a>, a subclass of <code class="code " id="ea7a27ce_121"  >AnAction</code>. For more information about creating action classes, see the <a href="action-system.html" id="ea7a27ce_122" data-tooltip="This tutorial leads you through a series of steps which show how to create, register, and customize custom actions and action groups. By registering actions, you can add your own menu items, toolbar buttons and keyboard shortcuts to the IDE user interface."  >Actions Tutorial</a>, which covers the topic in depth.</p><p id="ea7a27ce_123" >The <code class="code " id="ea7a27ce_124"  >EditorHandlerIllustration</code> action is registered in the <span class="emphasis" id="ea7a27ce_125" >editor_basic</span> <a href="https://github.com/JetBrains/intellij-sdk-code-samples/tree/main/editor_basics/src/main/resources/META-INF/plugin.xml" id="ea7a27ce_126"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_127"  >plugin.xml</code></a> file. Note that this action class is registered to appear on the Editor context menu.</p><div class="code-block" data-lang="markup"         >
&lt;actions&gt;
  &lt;action
      id=&quot;EditorBasics.EditorHandlerIllustration&quot;
      class=&quot;org.intellij.sdk.editor.EditorHandlerIllustration&quot;
      text=&quot;Editor Add Caret&quot;
      description=&quot;Adds a second caret below the existing one.&quot;
      icon=&quot;SdkIcons.Sdk_default_icon&quot;&gt;
    &lt;add-to-group group-id=&quot;EditorPopupMenu&quot; anchor=&quot;first&quot;/&gt;
  &lt;/action&gt;
&lt;/action&gt;
</div></section><section class="chapter"  ><h3 id="setting-visibility-for-the-action-menu-entry" data-toc="setting-visibility-for-the-action-menu-entry"  >Setting Visibility for the Action Menu Entry</h3><p id="ea7a27ce_129" >Under what conditions should the <code class="code " id="ea7a27ce_130"  >EditorHandlerIllustration</code> action be capable of cloning a caret? Only if the following conditions are met in the <code class="code " id="ea7a27ce_131"  >EditorHandlerIllustration.update()</code> method:</p><ul class="list _ul" id="ea7a27ce_132"    ><li class="list__item" id="ea7a27ce_133" ><p>A project is open,</p></li><li class="list__item" id="ea7a27ce_134" ><p>An editor is available,</p></li><li class="list__item" id="ea7a27ce_135" ><p>There is at least one caret active in the editor.</p></li></ul><p id="ea7a27ce_136" >After ensuring that <code class="code " id="ea7a27ce_137"  >Project</code> and <code class="code " id="ea7a27ce_138"  >Editor</code> objects are available, the <code class="code " id="ea7a27ce_139"  >Editor</code> object is used to verify there is at least one caret:</p><div class="code-block" data-lang="java"         >
public class EditorHandlerIllustration extends AnAction {
  @Override
  public void update(@NotNull AnActionEvent event) {
    Project project = event.getProject();
    Editor editor = event.getData(CommonDataKeys.EDITOR);

    // Make sure at least one caret is available
    boolean menuAllowed = false;
    if (editor != null &amp;&amp; project != null) {
      // Ensure the list of carets in the editor is not empty
      menuAllowed = !editor.getCaretModel().getAllCarets().isEmpty();
    }
    event.getPresentation().setEnabledAndVisible(menuAllowed);
  }
}
</div></section><section class="chapter"  ><h3 id="acquiring-the-correct-editoractionhandler" data-toc="acquiring-the-correct-editoractionhandler"  >Acquiring the Correct EditorActionHandler</h3><p id="ea7a27ce_141" >When the <code class="code " id="ea7a27ce_142"  >EditorHandlerIllustration.actionPerformed()</code> method clones the caret, it should use the appropriate IntelliJ Platform <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/EditorActionHandler.java" id="ea7a27ce_143"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_144"  >EditorActionHandler</code></a>. An instance of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/EditorActionManager.java" id="ea7a27ce_145"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_146"  >EditorActionManager</code></a> is required to obtain the correct <code class="code " id="ea7a27ce_147"  >EditorActionHandler</code>. The <code class="code " id="ea7a27ce_148"  >EditorActionManager</code> class provides a static method to do this.</p><p id="ea7a27ce_149" >To request the correct <code class="code " id="ea7a27ce_150"  >EditorActionHandler</code> from <code class="code " id="ea7a27ce_151"  >EditorActionManager</code>, consult the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/ide-core/src/com/intellij/openapi/actionSystem/IdeActions.java" id="ea7a27ce_152"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_153"  >IdeActions</code></a> interface for the correct constant to pass into the <code class="code " id="ea7a27ce_154"  >EditorActionManager.getActionHandler()</code> method. For cloning a caret below the primary caret, the constant is <code class="code " id="ea7a27ce_155"  >ACTION_EDITOR_CLONE_CARET_BELOW</code>. Based on that constant, the <code class="code " id="ea7a27ce_156"  >EditorActionManager</code> returns an instance of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-impl/src/com/intellij/openapi/editor/actions/CloneCaretActionHandler.java" id="ea7a27ce_157"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_158"  >CloneCaretActionHandler</code></a>, a subclass of <code class="code " id="ea7a27ce_159"  >EditorActionHandler</code>.</p><div class="code-block" data-lang="java"         >
// Snippet from EditorHandlerIllustration.actionPerformed()
EditorActionManager actionManager = EditorActionManager.getInstance();
EditorActionHandler actionHandler =
    actionManager.getActionHandler(IdeActions.ACTION_EDITOR_CLONE_CARET_BELOW);
</div></section><section class="chapter"  ><h3 id="using-an-editoractionhandler-to-clone-the-caret" data-toc="using-an-editoractionhandler-to-clone-the-caret"  >Using an EditorActionHandler to Clone the Caret</h3><p id="ea7a27ce_161" >To clone the caret requires only calling the <code class="code " id="ea7a27ce_162"  >EditorActionHandler.execute()</code> method and passing in the appropriate context.</p><div class="code-block" data-lang="java"         >
public class EditorHandlerIllustration extends AnAction {
  @Override
  public void actionPerformed(@NotNull AnActionEvent event) {
    Editor editor = event.getRequiredData(CommonDataKeys.EDITOR);
    EditorActionManager actionManager = EditorActionManager.getInstance();
    EditorActionHandler actionHandler =
        actionManager.getActionHandler(IdeActions.ACTION_EDITOR_CLONE_CARET_BELOW);
    actionHandler.execute(editor,
        editor.getCaretModel().getPrimaryCaret(), event.getDataContext());
  }
}
</div></section></section><section class="chapter"  ><h2 id="creating-a-custom-typedactionhandler" data-toc="creating-a-custom-typedactionhandler"  >Creating a Custom TypedActionHandler</h2><p id="ea7a27ce_164" >The <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedActionHandler.java" id="ea7a27ce_165"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_166"  >TypedActionHandler</code></a> interface is the basis for classes that handle keystroke events from the editor. Custom implementations of the class are registered to handle editor keystroke events, and receive a callback for each keystroke. The steps below explain how to use <code class="code " id="ea7a27ce_167"  >TypedActionHandler</code> to customize the behavior of the editor when keystroke events are received.</p><section class="chapter"  ><h3 id="implementing-a-custom-typedactionhandler-class" data-toc="implementing-a-custom-typedactionhandler-class"  >Implementing a Custom TypedActionHandler Class</h3><p id="ea7a27ce_168" >First, a subclass such as <code class="code " id="ea7a27ce_169"  >MyTypedHandler</code> is created based on <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedActionHandler.java" id="ea7a27ce_170"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_171"  >TypedActionHandler</code></a>. The class overrides the method <code class="code " id="ea7a27ce_172"  >TypedActionHandler.execute()</code>, which is the callback for editor keystroke events.</p></section><section class="chapter"  ><h3 id="implementing-the-keystroke-event-handling-logic" data-toc="implementing-the-keystroke-event-handling-logic"  >Implementing the Keystroke Event Handling Logic</h3><p id="ea7a27ce_173" >Override the <code class="code " id="ea7a27ce_174"  >TypedActionHandler.execute()</code> method in <code class="code " id="ea7a27ce_175"  >MyTypedHandler</code> to implement the logic for handling keystroke events. This method is called every time a key is pressed when the Editor Tool Window has focus.</p><p id="ea7a27ce_176" >In the following example, the <code class="code " id="ea7a27ce_177"  >MyTypedHandler.execute()</code> method inserts &quot;editor_basics\n&quot; at the zero <a href="coordinates-system.html#caret-offset" id="ea7a27ce_178" data-tooltip="The Offset of a caret is a character count from the beginning of a Document to the caret position. Caret offsets are always calculated in terms of Logical Position. The caret Offset includes:"  >caret Offset</a> position when a keystroke event occurs. As explained in <a href="working-with-text.html#safely-replacing-selected-text-in-the-document" id="ea7a27ce_179" data-tooltip="Based on the evaluation of conditions by EditorIllustrationAction.update(), the EditorIllustrationAction action menu item is visible. To make the menu item do something, the EditorIllustrationAction class must override the AnAction.actionPerformed() method. As explained below, this…"  >Working with Text</a>, safe modifications to the document must be in the context of a write action. So although a method on the <code class="code " id="ea7a27ce_180"  >Document</code> interface does the <code class="code " id="ea7a27ce_181"  >String</code> insertion, the write action ensures a stable context.</p><div class="code-block" data-lang="java"         >
class MyTypedHandler implements TypedActionHandler {
  @Override
  public void execute(@NotNull Editor editor,
                      char c,
                      @NotNull DataContext dataContext) {
    Document document = editor.getDocument();
    Project project = editor.getProject();
    Runnable runnable = () -&gt; document.insertString(0, &quot;editor_basics\n&quot;);
    WriteCommandAction.runWriteCommandAction(project, runnable);
  }
}
</div></section><section class="chapter"  ><h3 id="registering-a-custom-typedactionhandler" data-toc="registering-a-custom-typedactionhandler"  >Registering a Custom TypedActionHandler</h3><p id="ea7a27ce_183" >A custom implementation of <code class="code " id="ea7a27ce_184"  >TypedActionHandler</code> must be registered to replace the existing typing handler to receive editor keystroke events. The registration is done through the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/platform-api/src/com/intellij/openapi/editor/actionSystem/TypedAction.java" id="ea7a27ce_185"   data-external="true" rel="noopener noreferrer" ><code class="code " id="ea7a27ce_186"  >TypedAction</code></a> class.</p><p id="ea7a27ce_187" >As is shown in the snippet below, the <code class="code " id="ea7a27ce_188"  >EditorActionManager</code> is used to get access to the <code class="code " id="ea7a27ce_189"  >TypedAction</code> class. The method <code class="code " id="ea7a27ce_190"  >TypedAction.setupHandler()</code> is used to register the custom <code class="code " id="ea7a27ce_191"  >MyTypedHandler</code> class:</p><div class="code-block" data-lang="java"         >
public class EditorHandlerIllustration extends AnAction {
  static {
    EditorActionManager actionManager = EditorActionManager.getInstance();
    TypedAction typedAction = actionManager.getTypedAction();
    typedAction.setupHandler(new MyTypedHandler());
  }
}
</div><p id="ea7a27ce_193" >Placing the registration code in the <code class="code " id="ea7a27ce_194"  >EditorHandlerIllustration</code> class is somewhat arbitrary in the sense that the registration of <code class="code " id="ea7a27ce_195"  >MyTypedHandler</code> has nothing to do with the <code class="code " id="ea7a27ce_196"  >EditorHandlerIllustration</code> class. However, the <code class="code " id="ea7a27ce_197"  >EditorHandlerIllustration</code> class is convenient because as an action it gets instantiated at application startup. On instantiation, the <code class="code " id="ea7a27ce_198"  >static</code> block of code in <code class="code " id="ea7a27ce_199"  >EditorHandlerIllustration</code> gets evaluated. In the <code class="code " id="ea7a27ce_200"  >editor_basics</code> code sample any of the <code class="code " id="ea7a27ce_201"  >AnAction</code> derived classes would work for registering <code class="code " id="ea7a27ce_202"  >MyTypedHandler</code>.</p></section></section><div class="last-modified"> Last modified: 29 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="coordinates-system.html">2. Editor Coordinates System. Positions and Offsets</a>   <a class="navigation-links__next" href="text-selection.html">Text Selection</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>