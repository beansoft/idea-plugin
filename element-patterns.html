<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-28T11:33:50.160127"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Element Patterns | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"examples","level":0,"title":"Examples","anchor":"#examples"},{"id":"tools-and-debugging","level":0,"title":"Tools and Debugging","anchor":"#tools-and-debugging"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Element Patterns | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/element-patterns.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Element Patterns | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/element-patterns.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/element-patterns.html", "name": "Element Patterns | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="element_patterns.md" data-main-title="Element Patterns" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part IV — PSI"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/basics/architectural_overview/element_patterns.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="element_patterns.md" id="element_patterns.md"  >Element Patterns</h1><p id="excerpt" >Element patterns provide a generic way to specify conditions on objects.</p><p> Plugin authors use them to check whether PSI elements match a particular structure. Just as regular expressions for strings test whether a (sub-)string matches a particular pattern, element patterns are used to put conditions on the nested structure of PSI elements. Their two main applications inside the IntelliJ Platform are: </p><ol class="list _decimal" id="aa097412_2"  type="1"  ><li class="list__item" id="aa097412_3" ><p>Specifying where auto-completion should occur when implementing <a href="completion-contributor.html" id="aa097412_4" data-tooltip="Reference:"  >a completion contributor</a> for a custom language.</p></li><li class="list__item" id="aa097412_5" ><p>Specifying PSI elements that provide further references via <a href="psi-references.html#contributed-references" id="aa097412_6" data-tooltip="In addition to references defined by the semantics of the programming language, the IDE recognizes many references determined by the semantics of the APIs and frameworks used in code. Consider the following example:"  >a PSI reference contributor</a>.</p></li></ol><p id="aa097412_7" >However, plugin authors rarely implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/ElementPattern.java" id="aa097412_8"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_9"  >ElementPattern</code></a> interface directly. Instead, we recommend using the high-level pattern classes provided by the IntelliJ Platform:</p><div class="table-wrapper" ><table class=" wide" id="aa097412_10"  ><thead><tr class=" ijRowHead" id="aa097412_11" ><th id="aa097412_12"    ><p>Class</p></th><th id="aa097412_13"    ><p>Main Contents</p></th><th id="aa097412_14"    ><p>Notable Examples</p></th></tr></thead><tbody ><tr class="" id="aa097412_15" ><td id="aa097412_16"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/StandardPatterns.java" id="aa097412_17"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_18"  >StandardPatterns</code></a></p></td><td id="aa097412_19"    ><p>Factory for string and char pattern (see below); Logical operations like and, or, not</p></td><td id="aa097412_20"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/groovy/src/org/jetbrains/plugins/groovy/ext/logback/LogbackReferenceContributor.kt" id="aa097412_21"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_22"  >LogbackReferenceContributor</code></a>, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/RegExpSupport/src/org/intellij/lang/regexp/RegExpCompletionContributor.java" id="aa097412_23"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_24"  >RegExpCompletionContributor</code></a></p></td></tr><tr class="" id="aa097412_25" ><td id="aa097412_26"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/PlatformPatterns.java" id="aa097412_27"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_28"  >PlatformPatterns</code></a></p></td><td id="aa097412_29"    ><p>Factory for PSI-, IElement-, and VirtualFile-patterns</p></td><td id="aa097412_30"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/javaFX/src/org/jetbrains/plugins/javaFX/fxml/refs/FxmlReferencesContributor.java" id="aa097412_31"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_32"  >FxmlReferencesContributor</code></a>, <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/python/python-psi-impl/src/com/jetbrains/python/codeInsight/completion/PyDataclassCompletionContributor.kt" id="aa097412_33"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_34"  >PyDataclassCompletionContributor</code></a></p></td></tr><tr class="" id="aa097412_35" ><td id="aa097412_36"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/PsiElementPattern.java" id="aa097412_37"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_38"  >PsiElementPattern</code></a></p></td><td id="aa097412_39"    ><p>Patterns for PSI; Checks for children, parents, or neighboring leaves</p></td><td id="aa097412_40"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/xml/impl/src/com/intellij/codeInsight/completion/XmlCompletionContributor.java" id="aa097412_41"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_42"  >XmlCompletionContributor</code></a></p></td></tr><tr class="" id="aa097412_43" ><td id="aa097412_44"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/CollectionPattern.java" id="aa097412_45"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_46"  >CollectionPattern</code></a></p></td><td id="aa097412_47"    ><p>Filter and check pattern collections; Mainly used to provide functionality for other high-level pattern classes</p></td><td id="aa097412_48"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/PsiElementPattern.java" id="aa097412_49"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_50"  >PsiElementPattern</code></a></p></td></tr><tr class="" id="aa097412_51" ><td id="aa097412_52"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/TreeElementPattern.java" id="aa097412_53"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_54"  >TreeElementPattern</code></a></p></td><td id="aa097412_55"    ><p>Patterns specifically for checking (PSI) tree structure</p></td><td id="aa097412_56"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/python/python-psi-impl/src/com/jetbrains/python/codeInsight/completion/PyMetaClassCompletionContributor.java" id="aa097412_57"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_58"  >PyMetaClassCompletionContributor</code></a></p></td></tr><tr class="" id="aa097412_59" ><td id="aa097412_60"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/StringPattern.java" id="aa097412_61"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_62"  >StringPattern</code></a></p></td><td id="aa097412_63"    ><p>Check if strings match, have a certain length, have a specific beginning or ending, or are one of a collection of strings</p></td><td id="aa097412_64"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/gradle/java/src/codeInsight/AbstractGradleCompletionContributor.kt" id="aa097412_65"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_66"  >AbstractGradleCompletionContributor</code></a></p></td></tr><tr class="" id="aa097412_67" ><td id="aa097412_68"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-api/src/com/intellij/patterns/CharPattern.java" id="aa097412_69"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_70"  >CharPattern</code></a></p></td><td id="aa097412_71"    ><p>Check if characters are whitespace, digits, or Java identifier parts</p></td><td id="aa097412_72"    ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/analysis-impl/src/com/intellij/codeInsight/completion/CompletionUtil.java" id="aa097412_73"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_74"  >CompletionUtil</code></a></p></td></tr></tbody ></table ></div><p id="aa097412_75" >Some built-in languages in the IntelliJ Platform implement their own pattern classes and can provide additional examples:</p><ul class="list _ul" id="aa097412_76"    ><li class="list__item" id="aa097412_77" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/xml/xml-psi-api/src/com/intellij/patterns/XmlPatterns.java" id="aa097412_78"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_79"  >XmlPatterns</code></a> provides patterns for XML attributes, values, entities, and texts.</p></li><li class="list__item" id="aa097412_80" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/python/src/com/jetbrains/python/patterns/PythonPatterns.java" id="aa097412_81"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_82"  >PythonPatterns</code></a> provides patterns for literals, strings, arguments, and function/method arguments for Python.</p></li><li class="list__item" id="aa097412_83" ><p><a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/xml/dom-openapi/src/com/intellij/patterns/DomPatterns.java" id="aa097412_84"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_85"  >DomPatterns</code></a> builds upon <code class="code " id="aa097412_86"  >XmlPatterns</code> and acts as a wrapper to provide further patterns for <a href="xml-dom-api.html" id="aa097412_87" data-tooltip="This article is intended for plugin writers who create custom web server integrations, or some UI for easy XML editing. It describes the Document Object Model (DOM) in IntelliJ Platform - an easy way to work with DTD or Schema-based XML models. The following topics will be covered:…"  >DOM-API</a>.</p></li></ul><section class="chapter"  ><h2 id="examples" data-toc="examples"  >Examples</h2><p id="aa097412_88" >A good starting point for element patterns is the <a href="custom-language-support-tutorial.html" id="aa097412_89" data-tooltip="Tutorial for creating a .properties-like custom language."  >Custom Language Support Tutorial</a>. They are used in the <a href="completion-contributor.html#define-a-completion-contributor" id="aa097412_90" data-tooltip="For this tutorial, the simple_language_plugin provides custom completion for values in Simple Language property files. Create SimpleCompletionContributor by subclassing CompletionContributor. This rudimentary completion contributor always adds "Hello" to the completion variants…"  >completion</a> and <a href="reference-contributor.html#define-a-reference-contributor" id="aa097412_91" data-tooltip="A reference contributor allows the simple_language_plugin to provide references to Simple Language from elements in other languages such as Java. Create SimpleReferenceContributor by subclassing PsiReferenceContributor. Contribute a reference to each usage of a property:"  >reference</a> contributor section of the tutorial. However, the IntelliJ Platform source code provides many more examples of element patterns for built-in languages like JSON, XML, Groovy, Markdown, and so on. Checking the references in the table above or searching for usages of the high-level pattern classes will provide a comprehensive list that shows how element patterns are used in production code.</p><p id="aa097412_92" >For instance, an example can be found in <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/markdown/core/src/org/intellij/plugins/markdown/lang/references/MarkdownReferenceProvider.java" id="aa097412_93"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_94"  >MarkdownReferenceProvider</code></a> that tests if a PSI element is an instance of the <code class="code " id="aa097412_95"  >MarkdownLinkDestinationImpl</code> class and appears in a Markdown file.</p><div class="code-block" data-lang="java"         >
PsiElementPattern.Capture&lt;MarkdownLinkDestinationImpl&gt; linkDestinationCapture =
  psiElement(MarkdownLinkDestinationImpl.class).
  inFile(psiFile(MarkdownFile.class));
</div><p id="aa097412_97" >As shown in the code above, element patterns can be stacked and combined to create more complex conditions. <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/json/src/com/intellij/json/codeinsight/JsonCompletionContributor.java" id="aa097412_98"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_99"  >JsonCompletionContributor</code></a> contains another example with more requirements on the PSI element.</p><div class="code-block" data-lang="java"         >
PsiElementPattern.Capture&lt;PsiElement&gt; AFTER_COMMA_OR_BRACKET_IN_ARRAY =
  psiElement().
  afterLeaf(&quot;[&quot;, &quot;,&quot;).
  withSuperParent(2,JsonArray.class).
  andNot(
    psiElement().
    withParent(JsonStringLiteral.class)
  );
</div><p id="aa097412_101" >The above pattern makes sure that the PSI element:</p><ol class="list _decimal" id="aa097412_102"  type="1"  ><li class="list__item" id="aa097412_103" ><p>Appears after either an open bracket or a comma, which is expressed by putting a restriction on the neighboring leaf element.</p></li><li class="list__item" id="aa097412_104" ><p>Has <code class="code " id="aa097412_105"  >JsonArray</code> as a level-two parent, which indicates that the PSI element must be inside a JSON array.</p></li><li class="list__item" id="aa097412_106" ><p>Does not have a <code class="code " id="aa097412_107"  >JsonStringLiteral</code> as a parent, which prevents situations where a string with a bracket or comma inside an array would give a false-positive match.</p></li></ol><p id="aa097412_108" >This last example shows that corner cases need to be considered carefully even for simple patterns.</p></section><section class="chapter"  ><h2 id="tools-and-debugging" data-toc="tools-and-debugging"  >Tools and Debugging</h2><p id="aa097412_109" >Working with element patterns can be tricky, and plugin authors need a solid understanding of the underlying PSI structure to get it right. Therefore, it is recommended to use the <a href="explore-api.html#31-use-internal-mode-and-psiviewer" id="aa097412_110" data-tooltip="As a plugin developer, you should enable internal mode in IntelliJ IDEA. This provides access to a suite of tools to help you develop, debug, and test IntelliJ Platform plugins."  >PsiViewer plugin or built-in PSI viewer</a> and verify that elements indeed have the expected structure and properties.</p><section class="chapter"  ><h3 id="debugging" data-toc="debugging"  >Debugging</h3><p id="aa097412_111" >For this section, it is assumed that plugin authors have a basic understanding of how to work with <a href="https://www.jetbrains.com/help/idea/debugging-code.html" id="aa097412_112"   data-external="true" rel="noopener noreferrer" >a debugger</a>, how to <a href="https://www.jetbrains.com/help/idea/using-breakpoints.html#set-breakpoints" id="aa097412_113"   data-external="true" rel="noopener noreferrer" >set breakpoints</a>, and how to set <a href="https://www.jetbrains.com/help/idea/using-breakpoints.html#properties" id="aa097412_114"   data-external="true" rel="noopener noreferrer" >conditions on breakpoints</a>.</p><p id="aa097412_115" >When debugging element patterns, plugin authors need to keep in mind that the places where element patterns are instantiated are unrelated to where they are actually used. For instance, while patterns for completion contributors are instantiated when registering the contributor, the patterns are checked during completion while typing. Therefore, finding the correct locations in the IntelliJ Platform for debugging element patterns is the first important step.</p><p id="aa097412_116" >However, setting breakpoints inside <code class="code " id="aa097412_117"  >ElementPattern</code> will result in many false-positives since element patterns are used extensively throughout the IDE. One way to filter out these false-positives is to use a condition on the breakpoints. The following steps can help you investigate where patterns are checked:</p><ol class="list _decimal" id="aa097412_118"  type="1"  ><li class="list__item" id="aa097412_119" ><p>Set breakpoints at the <code class="code " id="aa097412_120"  >ElementPattern.accepts()</code> methods.</p></li><li class="list__item" id="aa097412_121" ><p>Set a condition on the breakpoints that checks whether the string representation of the pattern contains an <span class="emphasis" id="aa097412_122" >identifiable part</span> of the pattern.</p></li><li class="list__item" id="aa097412_123" ><p>Debug, and when the breakpoint triggers, make sure it is the right pattern and investigate the call stack to find relevant methods that use the pattern check.</p></li><li class="list__item" id="aa097412_124" ><p>Debug the relevant methods, e.g. methods that fill completion variants or find references.</p></li></ol><p id="aa097412_125" >Note that finding an identifiable part of a pattern can be achieved by setting a breakpoint where the pattern is <span class="control" id="aa097412_126" >instantiated</span> and checking its string representation.</p></section><section class="chapter"  ><h3 id="debugging-example" data-toc="debugging-example"  >Debugging Example</h3><p id="aa097412_127" >Using the Markdown code example from above, we note that the <code class="code " id="aa097412_128"  >MarkdownLinkDestinationImpl</code> class is used in the element pattern. Now, set a breakpoint at:</p><div class="code-block" data-lang="plaintext"         >
com.intellij.patterns.ElementPattern#accepts(
  java.lang.Object,
  com.intellij.util.ProcessingContext
)
</div><p id="aa097412_130" >Right-click on the breakpoint and set the following as a condition:</p><div class="code-block" data-lang="java"         >
toString().contains(&quot;MarkdownLinkDestinationImpl&quot;)
</div><p id="aa097412_132" >Now start a debug session and open a Markdown file. When the breakpoint hits, the call stack in the <a href="https://www.jetbrains.com/help/idea/debug-tool-window.html" id="aa097412_133"   data-external="true" rel="noopener noreferrer" >debug tool window</a> shows that reference-providers are checked in the method <code class="code " id="aa097412_134"  >doGetReferencesFromProviders</code> within <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/core-impl/src/com/intellij/psi/impl/source/resolve/reference/ReferenceProvidersRegistryImpl.java" id="aa097412_135"   data-external="true" rel="noopener noreferrer" ><code class="code " id="aa097412_136"  >ReferenceProvidersRegistryImpl</code></a>. This provides a good starting point for further investigation.</p></section></section><div class="last-modified"> Last modified: 28 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="stub-indexes.html">Stub Indexes</a>   <a class="navigation-links__next" href="uast.html">UAST - Unified Abstract Syntax Tree</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>