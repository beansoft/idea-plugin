<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2022-09-25T22:17:42.1678535"><meta name="build-number" content="${buildNumber}">    <meta name="keywords" content="">  <title>Code Formatter | IntelliJ Platform Plugin SDK</title><script id="virtual-toc-data" type="application/json">[{"id":"non-whitespace-modifications","level":0,"title":"Non-Whitespace Modifications","anchor":"#non-whitespace-modifications"},{"id":"code-style-settings","level":0,"title":"Code Style Settings","anchor":"#code-style-settings"},{"id":"external-code-formatter","level":0,"title":"External Code Formatter","anchor":"#external-code-formatter"}]</script>   <link href="https://resources.jetbrains.com/storage/help-app/v5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Code Formatter | IntelliJ Platform Plugin SDK"/><meta property="og:description" content=""/><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"/><meta property="og:site_name" content="IntelliJ Platform Plugin SDK Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://plugins.jetbrains.com/docs/intellij/code-formatting.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@JBPlatform"><meta name="twitter:title" content="Code Formatter | IntelliJ Platform Plugin SDK"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@JBPlatform"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://plugins.jetbrains.com/docs/intellij/code-formatting.html#webpage", "url": "https://plugins.jetbrains.com/docs/intellij/code-formatting.html", "name": "Code Formatter | IntelliJ Platform Plugin SDK", "description": "", "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://plugins.jetbrains.com/docs/intellij/#website", "url": "https://plugins.jetbrains.com/docs/intellij/", "name": "IntelliJ Platform Plugin SDK Help" }</script><!-- End Schema.org --></head>    <body data-id="code_formatting.md" data-main-title="Code Formatter" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Part VII — Custom Languages///custom_language_support.md|Custom Language Support"  data-edit-url="https://github.com/JetBrains/intellij-sdk-docs/edit/main/topics/reference_guide/custom_language_support/code_formatting.md"  >  <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>IntelliJ Platform Plugin SDK  Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select class="select _shortcuts" height="1" id="switch-shortcuts">      </select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="code_formatting.md" id="code_formatting.md"  >Code Formatter</h1><p id="39b5bb63_1" >The IntelliJ Platform includes a powerful framework for implementing custom language formatters. In this framework, the plugin specifies the <span class="emphasis" id="39b5bb63_2" >constraints</span> on the whitespaces between different syntax elements. The formatting engine, provided by the IDE, calculates the smallest number of whitespace modifications that need to be performed on the file to make it match the constraints.</p><p id="39b5bb63_3" >The process of formatting a file or a file fragment consists of the following main steps:</p><ul class="list _ul" id="39b5bb63_4"    ><li class="list__item" id="39b5bb63_5" ><p id="39b5bb63_6" >The <span class="emphasis" id="39b5bb63_7" >formatting model builder</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/FormattingModelBuilder.java" id="39b5bb63_8"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_9"  >FormattingModelBuilder</code></a>), implemented by the plugin, provides a formatting model (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/FormattingModel.java" id="39b5bb63_10"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_11"  >FormattingModel</code></a>) for the document to be formatted.</p></li><li class="list__item" id="39b5bb63_12" ><p id="39b5bb63_13" >The formatting model is requested to build the structure of the file as applies to formatting, as a tree of <span class="emphasis" id="39b5bb63_14" >blocks</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/Block.java" id="39b5bb63_15"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_16"  >Block</code></a>) with an associated indent, wrap, alignment, and spacing settings.</p></li><li class="list__item" id="39b5bb63_17" ><p id="39b5bb63_18" >The formatting engine calculates the sequence of whitespace characters (spaces, tabs, and/or line breaks) that needs to be placed at every block boundary, based on the plugin's formatting model.</p></li><li class="list__item" id="39b5bb63_19" ><p id="39b5bb63_20" >The formatting model is requested to insert the calculated whitespace characters at necessary positions in the file.</p></li></ul><p id="39b5bb63_21" >The structure of blocks is usually built so that it mirrors the PSI structure of the file – for example, in Java code, the top-level formatting block covers the entire file. Its children cover individual classes in the file, blocks on the next level cover methods inside classes, etc. The formatter modifies only the characters between blocks, and the tree of blocks must be built so that the bottom-level blocks cover all non-whitespace characters in the file. Otherwise, the formatter may delete the characters between blocks.</p><p id="39b5bb63_22" >To better understand how to build the block structure, use <a href="explore-api.html#31-use-internal-mode-and-psiviewer" id="39b5bb63_23" data-tooltip="As a plugin developer, you should enable internal mode in IntelliJ IDEA. This provides access to a suite of tools to help you develop, debug, and test IntelliJ Platform plugins."  >PsiViewer</a> and inspect formatting blocks built for an existing language. To invoke PsiViewer with the possibility of inspecting <span class="control" id="39b5bb63_24" >Block Structure</span>, use  or :</p><figure  id="39b5bb63_27"><img alt="Formatting Blocks Structure" title="Formatting Blocks Structure" src="images/psi_viewer_formatting_blocks.png"  class="" width="720" height="490"/></figure><p id="39b5bb63_28" >To change the default &quot;block name&quot; taken from class name, return custom <code class="code " id="39b5bb63_29"  >Block.getDebugName()</code>.</p><p id="39b5bb63_30" >If the formatting operation does not affect the entire file (for example, if the formatter is called to format the pasted block of text), a complete tree of blocks is not built. Rather, only blocks for the text range covered by the formatting operation and their parents are built.</p><p id="39b5bb63_31" >For every block, the plugin specifies the following properties:</p><ul class="list _ul" id="39b5bb63_32"    ><li class="list__item" id="39b5bb63_33" ><p id="39b5bb63_34" >The <span class="emphasis" id="39b5bb63_35" >spacing</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/Spacing.java" id="39b5bb63_36"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_37"  >Spacing</code></a>) specifies what spaces or line breaks are inserted between the specified children of the block. The spacing object specifies the minimum and maximum number of spaces that must be placed between the specified child blocks, the minimum number of line breaks to put there, and whether the existing line breaks and blank lines should be preserved. The formatting model can also specify that the formatter may not modify the spacing between the specified blocks.</p></li><li class="list__item" id="39b5bb63_38" ><p id="39b5bb63_39" >The <span class="emphasis" id="39b5bb63_40" >indent</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/Indent.java" id="39b5bb63_41"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_42"  >Indent</code></a>) specifies how the block is indented relative to its parent block. There are different modes of indenting defined by factory methods in the <code class="code " id="39b5bb63_43"  >Indent</code> class. The most commonly used are:</p><ul class="list _ul" id="39b5bb63_44"    ><li class="list__item" id="39b5bb63_45" ><p>the none indent (which means the child block is not indented)</p></li><li class="list__item" id="39b5bb63_46" ><p>the regular indent (the child block is indented by the number of spaces specified in the <span class="control" id="39b5bb63_47" >Tabs and Indents | Indent</span> code style setting)</p></li><li class="list__item" id="39b5bb63_48" ><p>the continuation indent (based on <span class="control" id="39b5bb63_49" >Tabs and Indents | Continuation indent</span> code style setting)</p></li></ul><p id="39b5bb63_50" >If the formatting model does not specify an indent, the &quot;continuation without first&quot; mode is used. This default means that the first block in a sequence of blocks with that type is not indented, and the following blocks are indented with a continuation indent.</p></li><li class="list__item" id="39b5bb63_51" ><p id="39b5bb63_52" >The <span class="emphasis" id="39b5bb63_53" >wrap</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/Wrap.java" id="39b5bb63_54"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_55"  >Wrap</code></a>) specifies whether the content of the block is wrapped to the next line. Wrapping is performed by inserting a line break before the block content. The plugin can specify that a particular block is never wrapped, always wrapped, or wrapped only if it exceeds the right margin.</p></li><li class="list__item" id="39b5bb63_56" ><p id="39b5bb63_57" >The <span class="emphasis" id="39b5bb63_58" >alignment</span> (<a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/Alignment.java" id="39b5bb63_59"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_60"  >Alignment</code></a>) specifies which blocks should be aligned with each other. If two blocks with the alignment property set to the same object instance are placed in different lines, and if the second block is the first non-whitespace block in its line, the formatter inserts white spaces before the second block, so that it starts from the same column as the first one.</p></li></ul><p id="39b5bb63_61" >For each of these properties, several particular use settings exist, described in the JavaDoc comments for the respective classes. See also <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/SpacingBuilder.java" id="39b5bb63_62"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_63"  >SpacingBuilder</code></a>, which aids in building rule-based configuration.</p><p id="39b5bb63_64" >An important special case in using the formatter is the smart indent performed when the user presses the <code class="code " id="39b5bb63_65"  >Enter</code> key in a source code file. To determine the indent for the new line, the formatter engine calls the method <code class="code " id="39b5bb63_66"  >getChildAttributes()</code> on either the block immediately before the caret or the parent of that block, depending on the return value of the <code class="code " id="39b5bb63_67"  >isIncomplete()</code> method for the block before the caret. If the block before the cursor is incomplete (contains elements that the user will probably type but has not yet typed, like a closing parenthesis of the parameter list or the trailing semicolon of a statement), <code class="code " id="39b5bb63_68"  >getChildAttributes()</code> is called on the block before the caret; otherwise, it's called on the parent block.</p><p id="39b5bb63_69" >Code formatting can be suppressed per region via <a href="https://youtrack.jetbrains.com/issue/IDEA-56995#comment=27-605969" id="39b5bb63_70"   data-external="true" rel="noopener noreferrer" >special comments</a>.</p><p id="39b5bb63_71" ><span class="control" id="39b5bb63_72" >Example</span>: <a href="formatter.html" id="39b5bb63_73" data-tooltip="Reference:"  >Custom Language Support Tutorial: Formatter</a></p><section class="chapter"  ><h2 id="non-whitespace-modifications" data-toc="non-whitespace-modifications"  >Non-Whitespace Modifications</h2><p id="39b5bb63_74" >Sometimes a plugin requires performing non-whitespace characters modifications like reordering methods, changing letter cases, or adding missing braces. The formatting framework provides extension points allowing to achieve these goals.</p><section class="chapter"  ><h3 id="pre-processor" data-toc="pre-processor"  >Pre-Processor</h3><p id="39b5bb63_75" >Allows executing additional processing before the actual formatting is performed. For example, it can be used to adjust the formatting range or modify the code by adding, removing, or converting elements like braces, semicolons, quotes, etc. All the introduced changes will be handled by the main formatting step.</p><p id="39b5bb63_76" >To register a formatting pre-processor, a plugin has to provide an implementation of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/psi/impl/source/codeStyle/PreFormatProcessor.java" id="39b5bb63_77"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_78"  >PreFormatProcessor</code></a> and register it in the <code class="code " id="39b5bb63_79"  >com.intellij.preFormatProcessor</code> extension point.</p><p id="39b5bb63_80" ><span class="control" id="39b5bb63_81" >Example:</span> <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/json/src/com/intellij/json/formatter/JsonTrailingCommaRemover.java" id="39b5bb63_82"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_83"  >JsonTrailingCommaRemover</code></a> removing trailing commas in JSON files</p></section><section class="chapter"  ><h3 id="post-processor" data-toc="post-processor"  >Post-Processor</h3><p id="39b5bb63_84" >It's similar to the pre-processor but is run after the actual formatting is performed. It can be used for adding, removing, or converting elements like braces, semicolons, quotes, changing letter-cases, etc.</p><p id="39b5bb63_85" >To register a formatting post-processor, a plugin has to provide an implementation of <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/psi/impl/source/codeStyle/PostFormatProcessor.java" id="39b5bb63_86"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_87"  >PostFormatProcessor</code></a> and register it in the <code class="code " id="39b5bb63_88"  >com.intellij.postFormatProcessor</code> extension point.</p><p id="39b5bb63_89" ><span class="control" id="39b5bb63_90" >Example:</span> <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/kotlin/idea/src/org/jetbrains/kotlin/idea/formatter/TrailingCommaPostFormatProcessor.kt" id="39b5bb63_91"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_92"  >TrailingCommaPostFormatProcessor</code></a> inserting trailing commas in Kotlin files</p></section><section class="chapter"  ><h3 id="rearranger" data-toc="rearranger"  >Rearranger</h3><p id="39b5bb63_93" >Allows custom languages to provide user-configurable arrangement/grouping rules for element types supported by language plugin. Rules can be refined via modifiers and name; ordering can be applied additionally. Please see <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/psi/codeStyle/arrangement/Rearranger.java" id="39b5bb63_94"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_95"  >Rearranger</code></a> and related for JavaDoc.</p></section></section><section class="chapter"  ><h2 id="code-style-settings" data-toc="code-style-settings"  >Code Style Settings</h2><p id="39b5bb63_96" >To specify the default indent size for the language provided by your plugin, and to allow the user to configure the tab size and indent size, you need to implement the <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/lang-api/src/com/intellij/psi/codeStyle/FileTypeIndentOptionsProvider.java" id="39b5bb63_97"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_98"  >FileTypeIndentOptionsProvider</code></a> interface and to register the implementation in the <code class="code " id="39b5bb63_99"  >com.intellij.fileTypeIndentOptionsProvider</code> extension point. The return value of <code class="code " id="39b5bb63_100"  >createIndentOptions()</code> determines the default indent size.</p><p id="39b5bb63_101" ><span class="control" id="39b5bb63_102" >Example</span>: <a href="code-style-settings.html" id="39b5bb63_103" data-tooltip="Reference:"  >Custom Language Support Tutorial: Code Style Settings</a></p></section><section class="chapter"  ><h2 id="external-code-formatter" data-toc="external-code-formatter"  >External Code Formatter</h2><p id="39b5bb63_104" ><span class="emphasis" id="39b5bb63_105" >2021.3</span></p><p id="39b5bb63_106" >Register <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/platform/code-style-api/src/com/intellij/formatting/service/AsyncDocumentFormattingService.java" id="39b5bb63_107"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_108"  >AsyncDocumentFormattingService</code></a> implementation in extension point <a href="https://jb.gg/ipe?extensions=com.intellij.formattingService" id="39b5bb63_109"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_110"  >com.intellij.formattingService</code></a> to invoke external formatter instead of IDE's builtin formatter.</p><p id="39b5bb63_111" ><span class="control" id="39b5bb63_112" >Example</span>: <a href="https://github.com/JetBrains/intellij-community/tree/idea/222.3739.54/plugins/sh/src/com/intellij/sh/formatter/ShExternalFormatter.java" id="39b5bb63_113"   data-external="true" rel="noopener noreferrer" ><code class="code " id="39b5bb63_114"  >ShExternalFormatter</code></a> from <span class="emphasis" id="39b5bb63_115" >Shell Script</span> plugin</p></section><div class="last-modified"> Last modified: 25 九月 2022</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="safe-delete-refactoring.html">Safe Delete Refactoring</a>   <a class="navigation-links__next" href="code-inspections-and-intentions.html">Code Inspections and Intentions</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/help-app/v5/app.js"></script></body></html>